<html>
<head>

<style>

  body {
    font-family: arial;
  }
 
  table, th, td {
    padding: 10px;
    border: 1px solid;
    border-collapse: collapse;
  }

</style>

</head>
</body>

<?php
  // GET VARS FROM REFERRING PAGE
  $step = $_POST['step'];
  $scenarioFilePath = $_POST['scenarioFilePath'];


?>

<h2>Edit Step <?php echo $step + 1; ?></h2>

<form method="post" action="" target="" id="save">
  <input type="hidden" name="save" value="save">
  <!-- send $step and $scenariofilePath on when form is resubmitted -->
  <input type="hidden" name="scenarioFilePath" value="<?php echo $scenarioFilePath; ?>">
  <input type="hidden" name="step" value="<?php echo $step; ?>">
  <input type="submit" name="submit" value="Save">



<?php

  // OPEN SCENARIO FILE AND READ STEP

    $scenarioFile = fopen("$scenarioFilePath", "r");
    $currentScenario = json_decode(fread($scenarioFile, filesize("../simulator/scenarios/my_scenarios/MyScenario/myscenario.json")), true);
    fclose($scenarioFile);

?>

<table>

<?php

foreach ($currentScenario[$step][data][0][sourcedata][incident] as $key => $i) {
?>
  <tr>
     <td><label for="<?php echo $key; ?>"><?php echo $key; ?></label></td>
     <td><input type="text" name="<?php echo $key; ?>" value="<?php echo $i; ?>"></td>
   </tr>

<?php
}

echo "</form></table>";


// GRAB NEW STEP DATA

$save = $_POST['save'];			// GET HTML BUTTON ACTIONS 
$cancel = $_POST['cancel'];

if ($save) {                 // ACTION WHEN SAVE BUTTON PRESSED
   echo "<p>saved</p>";

    //  DEBUG PRINT OUTPUT OF _POST TO CHECK VARS 
     echo "<p>Output of _POST</p>";
     echo "<pre>Step $step : <br>";
     print_r($_POST);
     echo "</pre>";

   // SET $CURRENTSCENARIO WITH NEW KEY => VALUE FROM _POST

   foreach ($_POST as $key => $i) {         
 //  $keyCheck = @$currentScenario[$step][data][0][sourcedata][incident][$key]; 
  // if (isset ($keyCheck)) {
     $currentScenario[$step][data][0][sourcedata][incident][$key] = $i;
   }
   
   // WRITE $CURRENTSCENARIO TO FILE
   $scenarioFileOpen = fopen("$scenarioFilePath", "w+");
   fwrite($scenarioFileOpen, json_encode($currentScenario));
   fclose($scenarioFileOpen);


} elseif ($cancel) {
   echo "<p>cancelled</p>";


}

 // FOR DEBUG
   echo "<p>Output of currentScenario</p>";
   echo "<pre>";
   print_r($currentScenario); 
   echo "</pre><br>";
   echo $scenarioFilePath; 


?>

</body>
<html>
