[
  {
    "data": [
      {
        "sleep": 0,
        "name": "Successful VPN Logon from outside my country",
        "source": "SIM-AETR",
        "demo_message": "Successful VPN Logon from outside my country\n    - SIEM detects a a successful VPN connection from another country\n    - FortiSOAR get the source IP reputation as an additional data to take an action upon, the IP is not malicious\n    - FortiSOAR fetches the user details from Active Directory and extract the user's location\n    - FortiSOAR resolves the source IP Country and compares it with the country extracted from Active directory data\n    - the two countries are the same, the alert is closed as **False Positive**  for the user belongs to the same country the VPN connection came from",
        "sourcedata": {
          "incident_data": {
            "id": "0",
            "nid": "9378",
            "index": "17",
            "custId": "2000",
            "dataStr": null,
            "eventType": "PH_RULE_VPN_LOGON_SUCCESS_OUTSIDE_COUNTRY",
            "attributes": {
              "user": "dricardo",
              "count": "16436",
              "customer": "demopack",
              "eventName": "Successful VPN Logon from outside my country",
              "eventType": "PH_RULE_VPN_LOGON_SUCCESS_OUTSIDE_COUNTRY",
              "srcGeoOrg": "MEO-RESIDENCIAL  PT",
              "srcIpAddr": "218.223.84.200",
              "bizService": "",
              "incidentId": "{{TR_RANDOM_INTEGER}}2",
              "phRecvTime": "{{TR_FORMATTED_CURRENT_TIME}}",
              "srcGeoCity": "Lisbon",
              "incidentSrc": "srcIpAddr:218.223.84.200,",
              "srcGeoState": "Lisbon",
              "incidentReso": "1 (Open)",
              "eventSeverity": "8",
              "incidentRptIp": "192.168.3.1",
              "incidentTitle": "Successful VPN login from dricardo at IP 218.223.84.200 from outside my country",
              "srcGeoCountry": "Portugal",
              "incidentDetail": "",
              "incidentStatus": "0 (Active)",
              "incidentTarget": "user:dricardo,",
              "srcGeoLatitude": "38.72225",
              "incidentExtUser": "",
              "phEventCategory": "1 (Incident)",
              "srcGeoLongitude": "-9.13934",
              "eventSeverityCat": "MEDIUM",
              "incidentComments": "compEventType not found.",
              "incidentLastSeen": "{{TR_FORMATTED_CURRENT_TIME}}",
              "incidentTicketId": "",
              "incidentFirstSeen": "TR_T-2",
              "incidentViewUsers": "",
              "phIncidentImpacts": "Network",
              "incidentNotiStatus": "",
              "incidentRptDevName": "FG240D3913800441",
              "incidentTicketUser": "",
              "incidentViewStatus": "1 (Read)",
              "phIncidentCategory": "4",
              "incidentClearedTime": "",
              "incidentClearedUser": "",
              "incidentExtTicketId": "T1589.001",
              "incidentRptDevStatus": "1 (Pending)",
              "incidentTicketStatus": "6 (None)",
              "incidentClearedReason": "",
              "incidentExtTicketType": "",
              "phSubIncidentCategory": "PH_RULE_SECURITY_INIT_ACCESS",
              "incidentExtClearedTime": "",
              "incidentExtTicketState": "",
              "incidentNotiRecipients": ""
            },
            "receiveTime": "{{TR_FORMATTED_CURRENT_TIME}}"
          },
          "associated_events": [
            {
              "id": "8908964491551210384",
              "nid": "8908964491551210384",
              "index": "1",
              "custId": "2000",
              "dataStr": null,
              "eventType": "FortiGate-ipsec-tunnel-up",
              "attributes": {
                "user": "dricardo",
                "vdom": "root",
                "count": "1",
                "usrMsg": "IPsec connection status change",
                "eventId": "8908964491551210384",
                "srcName": "HOST-218.223.84.200",
                "subtype": "vpn",
                "userGrp": "VPN Group",
                "customer": "demopack",
                "destName": "HOST-{{TR_FG_MGMT_IP}}",
                "fwAction": "tunnel-up",
                "logLevel": "notice",
                "memberID": "0101037138",
                "totFlows": "1",
                "eventName": "IPSec tunnel up",
                "eventType": "FortiGate-ipsec-tunnel-up",
                "reptModel": "FortiOS",
                "srcIpAddr": "218.223.84.200",
                "srcIpPort": "4500",
                "totPkts64": "0",
                "destIpAddr": "{{TR_FG_MGMT_IP}}",
                "destIpPort": "4500",
                "deviceTime": "{{TR_FORMATTED_CURRENT_TIME}}",
                "parserName": "FortiGateParser",
                "phRecvTime": "{{TR_FORMATTED_CURRENT_TIME}}",
                "recvPkts64": "0",
                "reptVendor": "Fortinet",
                "sentPkts64": "0",
                "srcGeoCity": "Lisbon",
                "totBytes64": "0",
                "collectorId": "10000",
                "description": "IPsec connection status changed",
                "destGeoCity": "San Francisco",
                "eventAction": "0 (Permit)",
                "rawEventMsg": "<189>Sep  2 10:45:02 172.16.255.82date=2016-02-22 time=08:26:57 devname=FG240D3913800441 devid=FG240D3913800441 logid=0101037138 type=event subtype=vpn level=notice vd=\"root\" logdesc=\"IPsec connection status changed\" msg=\"IPsec connection status change\" action=tunnel-up remip=218.223.84.200 locip={{TR_FG_MGMT_IP}} remport=4500 locport=4500 outintf=\"wan2\" cookies=\"05317f25f322f084/a6427f1dde352004\" user=\"N/A\" group=\"N/A\" xauthuser=\"dricardo\" xauthgroup=\"VPN Group\" assignip={{TR_ASSET_IP}} vpntunnel=\"NativeIPsec_0\" tunnelip={{TR_ASSET_IP}} tunnelid=2270066027 tunneltype=\"ipsec\" duration=0 sentbyte=0 rcvdbyte=0 nextstat=0",
                "reptDevName": "FG240D3913800441",
                "srcGeoState": "Lisbon",
                "srcIntfName": "wan2",
                "timeSkewSec": "8285",
                "destGeoState": "California",
                "durationMSec": "0",
                "eventParsedOk": "1",
                "eventSeverity": "3",
                "reptDevIpAddr": "192.168.3.1",
                "srcGeoCountry": "Portugal",
                "vpnTunnelName": "NativeIPsec_0",
                "destGeoCountry": "United States",
                "localVpnIpAddr": "{{TR_ASSET_IP}}",
                "relayDevIpAddr": "192.168.3.1",
                "srcGeoLatitude": "38.72225",
                "destGeoLatitude": "37.77493",
                "phEventCategory": "0 (External)",
                "srcGeoLongitude": "-9.13934",
                "destGeoLongitude": "-122.41942",
                "eventRuleTrigger": "1",
                "eventSeverityCat": "LOW",
                "postNATSrcIpAddr": "{{TR_ASSET_IP}}",
                "extEventRecvProto": "Syslog",
                "srcGeoCountryCodeStr": "PT",
                "destGeoCountryCodeStr": "US"
              },
              "receiveTime": "{{TR_FORMATTED_CURRENT_TIME}}"
            }
          ]
        }
      }
    ]
  },
  {
    "data": [
      {
        "sleep": 5,
        "name": "Successful VPN Logon from outside my country",
        "source": "SIM-AETR",
        "demo_message": "Successful VPN Logon from outside my country:\n    - SIEM detects a a successful VPN connection from another country\n    - FortiSOAR get the source IP reputation as an additional data to take an action upon, the IP is **malicious**\n    - FortiSOAR fetches the user details from Active Directory and extract the user's location\n    - FortiSOAR resolves the source IP Country and compares it with the country extracted from Active directory data\n    - the two countries are the different and the source IP is malicious, the alert is escalated as a \n**True Positive** of credentials theft, the analyst is presented with 2 automation response \nplaybooks: Disable user name from Active Directory and Block the source IP on NGFW",
        "sourcedata": {
          "incident_data": {
            "id": "0",
            "nid": "9378",
            "index": "17",
            "custId": "2000",
            "dataStr": null,
            "eventType": "PH_RULE_VPN_LOGON_SUCCESS_OUTSIDE_COUNTRY",
            "attributes": {
              "user": "jill",
              "count": "16436",
              "customer": "demopack",
              "eventName": "Successful VPN Logon from outside my country",
              "eventType": "PH_RULE_VPN_LOGON_SUCCESS_OUTSIDE_COUNTRY",
              "srcGeoOrg": "MEO-RESIDENCIAL  PT",
              "srcIpAddr": "{{TR_MALICIOUS_IP}}",
              "bizService": "",
              "incidentId": "{{TR_RANDOM_INTEGER}}2",
              "phRecvTime": "{{TR_FORMATTED_CURRENT_TIME}}",
              "srcGeoCity": "Lisbon",
              "incidentSrc": "srcIpAddr:{{TR_MALICIOUS_IP}},",
              "srcGeoState": "Lisbon",
              "incidentReso": "1 (Open)",
              "eventSeverity": "8",
              "incidentRptIp": "192.168.3.1",
              "incidentTitle": "Successful VPN login from jill at IP {{TR_MALICIOUS_IP}} from outside my country",
              "srcGeoCountry": "Portugal",
              "incidentDetail": "",
              "incidentStatus": "0 (Active)",
              "incidentTarget": "user:jill,",
              "srcGeoLatitude": "38.72225",
              "incidentExtUser": "",
              "phEventCategory": "1 (Incident)",
              "srcGeoLongitude": "-9.13934",
              "eventSeverityCat": "MEDIUM",
              "incidentComments": "compEventType not found.",
              "incidentLastSeen": "{{TR_FORMATTED_CURRENT_TIME}}",
              "incidentTicketId": "",
              "incidentFirstSeen": "{{TR_T-1}}",
              "incidentViewUsers": "",
              "phIncidentImpacts": "Network",
              "incidentNotiStatus": "",
              "incidentRptDevName": "FG240D3913800441",
              "incidentTicketUser": "",
              "incidentViewStatus": "1 (Read)",
              "phIncidentCategory": "4",
              "incidentClearedTime": "",
              "incidentClearedUser": "",
              "incidentExtTicketId": "T1589.001",
              "incidentRptDevStatus": "1 (Pending)",
              "incidentTicketStatus": "6 (None)",
              "incidentClearedReason": "",
              "incidentExtTicketType": "",
              "phSubIncidentCategory": "PH_RULE_SECURITY_INIT_ACCESS",
              "incidentExtClearedTime": "",
              "incidentExtTicketState": "",
              "incidentNotiRecipients": ""
            },
            "receiveTime": "{{TR_FORMATTED_CURRENT_TIME}}"
          },
          "associated_events": [
            {
              "id": "8908964491551210384",
              "nid": "8908964491551210384",
              "index": "1",
              "custId": "2000",
              "dataStr": null,
              "eventType": "FortiGate-ipsec-tunnel-up",
              "attributes": {
                "user": "jill",
                "vdom": "root",
                "count": "1",
                "usrMsg": "IPsec connection status change",
                "eventId": "8908964491551210384",
                "srcName": "HOST-{{TR_MALICIOUS_IP}}",
                "subtype": "vpn",
                "userGrp": "VPN Group",
                "customer": "demopack",
                "destName": "HOST-{{TR_FG_MGMT_IP}}",
                "fwAction": "tunnel-up",
                "logLevel": "notice",
                "memberID": "0101037138",
                "totFlows": "1",
                "eventName": "IPSec tunnel up",
                "eventType": "FortiGate-ipsec-tunnel-up",
                "reptModel": "FortiOS",
                "srcIpAddr": "{{TR_MALICIOUS_IP}}",
                "srcIpPort": "4500",
                "totPkts64": "0",
                "destIpAddr": "{{TR_FG_MGMT_IP}}",
                "destIpPort": "4500",
                "deviceTime": "{{TR_FORMATTED_CURRENT_TIME}}",
                "parserName": "FortiGateParser",
                "phRecvTime": "{{TR_FORMATTED_CURRENT_TIME}}",
                "recvPkts64": "0",
                "reptVendor": "Fortinet",
                "sentPkts64": "0",
                "srcGeoCity": "Lisbon",
                "totBytes64": "0",
                "collectorId": "10000",
                "description": "IPsec connection status changed",
                "destGeoCity": "San Francisco",
                "eventAction": "0 (Permit)",
                "rawEventMsg": "<189>Sep  2 10:45:02 172.16.255.82date=2016-02-22 time=08:26:57 devname=FG240D3913800441 devid=FG240D3913800441 logid=0101037138 type=event subtype=vpn level=notice vd=\"root\" logdesc=\"IPsec connection status changed\" msg=\"IPsec connection status change\" action=tunnel-up remip={{TR_MALICIOUS_IP}} locip={{TR_FG_MGMT_IP}} remport=4500 locport=4500 outintf=\"wan2\" cookies=\"05317f25f322f084/a6427f1dde352004\" user=\"N/A\" group=\"N/A\" xauthuser=\"jill\" xauthgroup=\"VPN Group\" assignip={{TR_ASSET_IP}} vpntunnel=\"NativeIPsec_0\" tunnelip={{TR_ASSET_IP}} tunnelid=2270066027 tunneltype=\"ipsec\" duration=0 sentbyte=0 rcvdbyte=0 nextstat=0",
                "reptDevName": "FG240D3913800441",
                "srcGeoState": "Lisbon",
                "srcIntfName": "wan2",
                "timeSkewSec": "8285",
                "destGeoState": "California",
                "durationMSec": "0",
                "eventParsedOk": "1",
                "eventSeverity": "3",
                "reptDevIpAddr": "192.168.3.1",
                "srcGeoCountry": "Portugal",
                "vpnTunnelName": "NativeIPsec_0",
                "destGeoCountry": "United States",
                "localVpnIpAddr": "{{TR_ASSET_IP}}",
                "relayDevIpAddr": "192.168.3.1",
                "srcGeoLatitude": "38.72225",
                "destGeoLatitude": "37.77493",
                "phEventCategory": "0 (External)",
                "srcGeoLongitude": "-9.13934",
                "destGeoLongitude": "-122.41942",
                "eventRuleTrigger": "1",
                "eventSeverityCat": "LOW",
                "postNATSrcIpAddr": "{{TR_ASSET_IP}}",
                "extEventRecvProto": "Syslog",
                "srcGeoCountryCodeStr": "PT",
                "destGeoCountryCodeStr": "US"
              },
              "receiveTime": "{{TR_FORMATTED_CURRENT_TIME}}"
            }
          ]
        }
      }
    ]
  }
]