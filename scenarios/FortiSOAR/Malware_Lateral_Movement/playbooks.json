{
  "type": "workflow_collections",
  "data": [
    {
      "@type": "WorkflowCollection",
      "name": "00 - SIM Malware Lateral Movement",
      "description": "FortiSIEM Playbooks",
      "visible": true,
      "image": null,
      "workflows": [
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "FSMSIM-Malware_Lateral_Movement",
          "aliasName": null,
          "description": "Investigate observed connection to C2",
          "collection": "/api/3/workflow_collections/5c7b8115-cf39-4e61-af73-8fd74fc5ca08",
          "tag": "VirusTotal",
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/60d34164-33e4-418c-8522-d38a48849722",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Is Malicious",
              "description": "Is Malicious",
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/0a5c0c4b-4c7f-4ff0-94fc-cbd19a015fec",
                    "condition": "{{ vars.reputation >= 1 }}"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/3fa7baf0-50ea-4685-996b-31b56d360c5a"
                  }
                ]
              },
              "status": null,
              "left": "600",
              "top": "625",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "eae69b32-a9f2-4332-a0cc-4a7009f7e0c7"
            },
            {
              "@type": "WorkflowStep",
              "name": "Escalate Alert",
              "description": null,
              "arguments": {
                "resource": {
                  "assets": "{{vars.steps.Create_Asset['@id']}}",
                  "severity": {
                    "id": 61,
                    "@id": "/api/3/picklists/7efa2220-39bb-44e4-961f-ac368776e3b0",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#e31b1d",
                    "display": "Critical",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "Critical",
                    "orderIndex": 4
                  },
                  "indicators": "{{vars.steps.Create_Indicator['@id']}}",
                  "description": "<p>{{vars.detination_ip}}&nbsp;is found to be malicious by VirusToal.com</p>",
                  "escalatedtoincident": {
                    "id": 6807,
                    "@id": "/api/3/picklists/fa12313b-66af-4a2e-864e-a5f19241b734",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#bf0a0a",
                    "display": "Yes",
                    "listName": "/api/3/picklist_names/e131cc54-9ae4-43c9-b830-af6e331fe024",
                    "itemValue": "Yes",
                    "orderIndex": 0
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.alertiri}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": [],
                "step_variables": []
              },
              "status": null,
              "left": "400",
              "top": "860",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "f78d8e4b-5cdd-4822-b468-fd53d8bc831d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Indicator",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating Indicator for Malicious IP</span></p>\n\n<p>The IP address <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.detination_ip}} ]</span> has been determined to be <span style=\"background-color:#FF0000;color:#FFFFFF;font-weight:bold\">[ Malicious ]</span>. Creating an indicator for the malicious IP address.",
                  "records": ""
                },
                "resource": {
                  "value": "{{vars.detination_ip}}",
                  "alerts": "{{vars.alertiri}}",
                  "assets": "{{vars.steps.Create_Asset['@id']}}",
                  "__replace": "",
                  "reputation": {
                    "id": 6433,
                    "@id": "/api/3/picklists/7074e547-7785-4979-be32-c6d0c863e4bd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#c42323",
                    "display": "Malicious",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "Malicious",
                    "orderIndex": 1
                  },
                  "description": "<p>{{vars.enrichment_summary}}</p>",
                  "typeofindicator": {
                    "id": 433,
                    "@id": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "IP Address",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "IP Address",
                    "orderIndex": 7
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/indicators",
                "ignore_errors": true,
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "400",
              "top": "730",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "0a5c0c4b-4c7f-4ff0-94fc-cbd19a015fec"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Variables",
              "description": null,
              "arguments": {
                "alertiri": "{{vars.input.records[0]['@id']}}",
                "source_ip": "{{vars.input.records[0].sourcedata.incident.srcIpAddr}}",
                "alert_name": "{{vars.input.records[0].name}}",
                "source_data": "{{vars.input.records[0].sourcedata}}",
                "detination_ip": "{{vars.input.records[0].sourcedata.incident.destIpAddr}}"
              },
              "status": null,
              "left": "408",
              "top": "31",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "85bcaa7e-01f0-4e93-aaff-381813156002"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Existing Indicators",
              "description": null,
              "arguments": {
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.detination_ip}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "indicators?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Finding Existing Record</span></p>\n\n<p>Determining if the destination IP address <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.detination_ip}} ]</span> has an existing record.</p>",
                  "records": ""
                },
                "step_variables": {
                  "resultRecordscount": "{{vars.result | length}}"
                }
              },
              "status": null,
              "left": "794",
              "top": "260",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "d6ca6471-db1b-449e-85cf-932c2ffb7f2a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Existing Indicator",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "Yes",
                    "step_iri": "/api/3/workflow_steps/e5e7f316-c26e-4349-ade7-a589c356f5a1",
                    "condition": "{{ vars.resultRecordscount >= 1 }}"
                  },
                  {
                    "option": "No",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/fe01bca4-05d8-44ab-9f6b-7ebfd64775ff"
                  }
                ]
              },
              "status": null,
              "left": "420",
              "top": "260",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "30e5409e-66f2-4587-ac64-ef0f73e895b1"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Incident",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating Incident</span></p>\n\n<p>Due to the internal asset <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.source_ip}} ]</span> attempting to access the malicious IP address <span style=\"background-color:#FF0000;color:#FFFFFF;font-weight:bold\">[ {{vars.detination_ip}} ]</span> the asset has been determined to be <span style=\"background-color:#FF0000;color:#FFFFFF;font-weight:bold\">[ Infected ]</span> and an incident has been created from this alert and has been escalated.</p>",
                  "records": ""
                },
                "resource": {
                  "name": "{{vars.steps.Escalate_Alert.name}}-{{vars.detination_ip}}",
                  "phase": {
                    "id": 147,
                    "@id": "/api/3/picklists/bb7407e0-f699-11e7-8c3f-9a214cf093ae",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Containment",
                    "listName": "/api/3/picklist_names/b862eb1f-b385-40ca-baa7-5a1b1f91a651",
                    "itemValue": "Containment",
                    "orderIndex": 3
                  },
                  "alerts": "{{vars.alertiri}}",
                  "assets": "{{vars.steps.Create_Asset['@id']}}",
                  "source": "{{vars.steps.Escalate_Alert.source}}",
                  "status": {
                    "id": 7210,
                    "@id": "/api/3/picklists/bb7402d6-f699-11e7-8c3f-9a214cf093ae",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "In Progress",
                    "listName": "/api/3/picklist_names/a549e41c-31ca-406d-89ae-eab3de5c06c4",
                    "itemValue": "In Progress",
                    "orderIndex": 1
                  },
                  "category": {
                    "id": 6795,
                    "@id": "/api/3/picklists/703218fc-f69a-11e7-8c3f-9a214cf093ae",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Malware",
                    "listName": "/api/3/picklist_names/f3938848-6220-4b27-af2d-a5329cf63656",
                    "itemValue": "Malware",
                    "orderIndex": 8
                  },
                  "resDueBy": "{{globalVars.Tomorrow_Date}}",
                  "severity": {
                    "id": 61,
                    "@id": "/api/3/picklists/7efa2220-39bb-44e4-961f-ac368776e3b0",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#e31b1d",
                    "display": "Critical",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "Critical",
                    "orderIndex": 4
                  },
                  "sourceIP": "{{vars.source_ip}}",
                  "__replace": "",
                  "indicators": "{{vars.steps.Create_Indicator['@id']}}",
                  "description": "<p><strong>Asset Connection to a malicious IP: <span style=\"background-color: #ff0000;\">{{vars.detination_ip}}</span></strong></p>\n<p><strong>AS Number:</strong> {{vars.enrichment_summary.asn}}</p>\n<p><strong>Country:</strong> {{vars.enrichment_summary.country}}</p>\n<p><strong>Network:</strong> {{vars.enrichment_summary.network}}</p>\n<p><strong>AS Owner: </strong>{{vars.enrichment_summary.as_owner}}</p>",
                  "discoveredOn": "{{globalVars.Current_Date}}",
                  "incidentLead": "/api/3/people/3451141c-bac6-467c-8d72-85e0fab569ce",
                  "destinationIP": "{{vars.detination_ip}}",
                  "dateOfIncident": "{{globalVars.Current_Date}}",
                  "incidentsummary": "<p>Asset {{vars.source_ip}} opened a connection to a malicious C&C IP: {{vars.detination_ip}}</p>"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/incidents",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": {
                  "relatedIncidents": "{{vars.result['@id']}}"
                }
              },
              "status": null,
              "left": "400",
              "top": "960",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "5d387091-bb08-427d-a710-1298434d2a47"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Reputation",
              "description": null,
              "arguments": {
                "reputation": "{{vars.steps.Get_IP_Reputation.data.aggregate}}",
                "enrichment_summary": "{{vars.steps.Get_IP_Reputation.data}}"
              },
              "status": null,
              "left": "600",
              "top": "506",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "410219fe-3bcc-4ba7-8503-0bda864c6d3e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Related Alerts",
              "description": null,
              "arguments": {
                "alertdata": "{{ (vars.steps.Find_Existing_Indicators[0]['@id'] + \"?$relationships=true\") | fromIRI }}"
              },
              "status": null,
              "left": "87",
              "top": "380",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "e5e7f316-c26e-4349-ade7-a589c356f5a1"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Escalated Incident",
              "description": null,
              "arguments": {
                "indicator_iri": "{{vars.alertdata['@id']}}",
                "relatedAlerts": "{{vars.alertdata.alerts | json_query('[].[\\\"@id\\\"]')}}",
                "relatedIncidents": "{{vars.alertdata.incidents[0]['@id']}}",
                "relatedIncidentsName": "{{vars.alertdata.incidents[0].name}}"
              },
              "status": null,
              "left": "87",
              "top": "500",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "826ac969-5514-44e3-bbdc-0997dab5a399"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Alert Correlation",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Attaching Alert to Existing Incident</span></p>\n\n<p>The destination IP address <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.detination_ip}} ]</span> has been seen before, it is known to be <span style=\"background-color:#FF0000;color:#FFFFFF;font-weight:bold\">[ Malicious ]</span>.</p>\n\n<p>This alert is being linked to the previous incident <span style=\"background-color:#FF8633;color:#FFFFFF;font-weight:bold\">[ {{vars.relatedIncidentsName}} ]</span>.</p>",
                  "records": ""
                },
                "resource": {
                  "alerts": "{{vars.relatedAlerts[0][0]}}",
                  "assets": "{{vars.steps.Create_Asset['@id']}}",
                  "severity": {
                    "id": 61,
                    "@id": "/api/3/picklists/7efa2220-39bb-44e4-961f-ac368776e3b0",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#e31b1d",
                    "display": "Critical",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "Critical",
                    "orderIndex": 4
                  },
                  "incidents": "{{vars.relatedIncidents}}",
                  "indicators": "{{vars.indicator_iri}}",
                  "escalatedtoincident": {
                    "id": 6807,
                    "@id": "/api/3/picklists/fa12313b-66af-4a2e-864e-a5f19241b734",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#bf0a0a",
                    "display": "Yes",
                    "listName": "/api/3/picklist_names/e131cc54-9ae4-43c9-b830-af6e331fe024",
                    "itemValue": "Yes",
                    "orderIndex": 0
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.alertiri}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "87",
              "top": "627",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "ee1c2279-a3b5-4d32-8dc0-6e0dc424bd5d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Close Alert",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Updating of Alert Record</span></p>\n\n<p>The destination IP address <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.detination_ip}} ]</span> was found by VirusTotal, at this time, to be <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[  benign ]</span>.</p>\n\n<p>Due to this no further action was necessary and the Alert was <span style=\"background-color:#1e6e23;color:white;font-weight:bold\">[ automatically ]</span> closed.</p>\n",
                  "records": ""
                },
                "resource": {
                  "state": {
                    "id": 221,
                    "@id": "/api/3/picklists/2879663c-c1dc-4ef2-84ae-8c67c9353b86",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Detail Extracted",
                    "listName": "/api/3/picklist_names/2f9ed741-25fe-475a-9f12-64336288eebf",
                    "itemValue": "Detail Extracted",
                    "orderIndex": 1
                  },
                  "status": {
                    "id": 6802,
                    "@id": "/api/3/picklists/fac53e73-8d16-4189-98d5-95fbd1555232",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Closed",
                    "listName": "/api/3/picklist_names/33e964a9-d607-49f2-813c-7ce46141815a",
                    "itemValue": "Closed",
                    "orderIndex": 4
                  },
                  "ackDate": "{{globalVars.Current_Date}}",
                  "respDate": "{{globalVars.Current_Date}}",
                  "severity": {
                    "id": 57,
                    "@id": "/api/3/picklists/0d609b08-45e0-469f-8910-41145c0b7c03",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#157DD9",
                    "display": "Minimal",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "Minimal",
                    "orderIndex": 0
                  },
                  "ackSlaStatus": "{% if globalVars.Current_Date <= vars.steps.Update_Alert_Attributes.dueBy %}{{\"SLAState\" | picklist(\"Met\", \"@id\")}}{% else %}{{\"SLAState\" | picklist(\"Missed\", \"@id\")}}{% endif %}",
                  "closureNotes": "<p>At the time of the closure of the alert, the destination IP address <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.detination_ip}} ]</span> was found by VirusTotal to not be malicious.</p>\n\n<p>Due to this no further action was necessary and the Alert was <span style=\"background-color:#1e6e23;color:white;font-weight:bold\">[ automatically ]</span> closed.</p>\n",
                  "resolveddate": "{{globalVars.Current_Date}}",
                  "closureReason": {
                    "id": 250,
                    "@id": "/api/3/picklists/2b0112f6-4746-4dab-ada6-a8cd1e675572",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "False Positive",
                    "listName": "/api/3/picklist_names/4ebacea1-88cd-4ea8-9dcc-385bea42cc59",
                    "itemValue": "False Positive",
                    "orderIndex": 2
                  },
                  "respSlaStatus": "{% if globalVars.Current_Date <= vars.steps.Update_Alert_Attributes.respDueDate %}{{\"SLAState\" | picklist(\"Met\", \"@id\")}}{% else %}{{\"SLAState\" | picklist(\"Missed\", \"@id\")}}{% endif %}",
                  "escalatedtoincident": {
                    "id": 31,
                    "@id": "/api/3/picklists/2128a09c-153d-4db3-985d-de6be33deae5",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#808080",
                    "display": "No",
                    "listName": "/api/3/picklist_names/e131cc54-9ae4-43c9-b830-af6e331fe024",
                    "itemValue": "No",
                    "orderIndex": 1
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.alertiri}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "806",
              "top": "728",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "3fa7baf0-50ea-4685-996b-31b56d360c5a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Match Local IP",
              "description": null,
              "arguments": {
                "params": {
                  "cidr": "['10.0.0.0/8','172.16.0.0/12','192.168.0.0/16']",
                  "ip_address": "{{vars.source_ip}}"
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Matching Source IP To Internal IP Ranges</span></p>\n\n<p>Determining if the source IP <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.source_ip}} ]</span> is an internal IP address.</p>",
                  "records": ""
                },
                "version": "3.0.2",
                "connector": "cyops_utilities",
                "operation": "ip_cidr_check",
                "operationTitle": "Utils: Is IP in CIDR",
                "step_variables": []
              },
              "status": null,
              "left": "1120",
              "top": "31",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "11e20ce6-b15f-4165-a745-dc70ef9d87ed"
            },
            {
              "@type": "WorkflowStep",
              "name": "Is it a Local IP",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/38d2c5e6-7833-4249-98fe-b1a33d1a35f5",
                    "condition": "{{ vars.steps.Match_Local_IP.data['matched_cidr_ip'] | length > 0 }}"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/d6ca6471-db1b-449e-85cf-932c2ffb7f2a"
                  }
                ]
              },
              "status": null,
              "left": "1120",
              "top": "152",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "deb1fc72-00bc-4e9f-8888-bbe9cb54b913"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Asset",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating Asset</span></p>\n\n<p>As IP address <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.source_ip}} ]</span> is an internal IP address and no asset already exists for it, an asset is being created for this IP address.</p>",
                  "records": ""
                },
                "resource": {
                  "ip": "{{vars.source_ip}}",
                  "alerts": "{{vars.alertiri}}",
                  "status": {
                    "id": 86,
                    "@id": "/api/3/picklists/421c20cd-e63d-4e32-9a25-774b2155cd24",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Active",
                    "listName": "/api/3/picklist_names/3c57ea34-4866-4c8f-ba74-dc51806727a9",
                    "itemValue": "Active",
                    "orderIndex": 0
                  },
                  "__replace": "false",
                  "criticality": {
                    "id": 188,
                    "@id": "/api/3/picklists/f734dfbb-fd61-425e-8a14-ebd560289fac",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#DE7A13",
                    "display": "High",
                    "listName": "/api/3/picklist_names/f8d09b4a-9e91-4096-bbdd-06a9f96ef57e",
                    "itemValue": "High",
                    "orderIndex": 3
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/assets",
                "ignore_errors": true,
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1120",
              "top": "260",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "38d2c5e6-7833-4249-98fe-b1a33d1a35f5"
            },
            {
              "@type": "WorkflowStep",
              "name": "Add Manual Remediation Task",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Adding Manual Remediation Task</span></p>\n\n<p>Due to the asset <span style=\"background-color:#FF0000;color:#FFFFFF;font-weight:bold\">[ {{vars.steps.Create_Asset.ip}} ]</span> having been determined as <span style=\"background-color:#FF0000;color:#FFFFFF;font-weight:bold\">[ Infected ]</span>, a task to manually remediate the infected asset has been created.",
                  "records": ""
                },
                "resource": {
                  "name": "Remediate Infected Host {{vars.steps.Create_Asset.ip}}",
                  "type": {
                    "id": 132,
                    "@id": "/api/3/picklists/826ad76d-e418-4928-9bc9-ea552ebcc5f9",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Incident Response",
                    "listName": "/api/3/picklist_names/b837e375-76af-4ba5-b6a1-bd1c3cd27292",
                    "itemValue": "Incident Response",
                    "orderIndex": 6
                  },
                  "dueBy": "{{globalVars.Tomorrow_Date}}",
                  "alerts": "{{vars.alertiri}}",
                  "assets": "{{vars.steps.Create_Asset['@id']}}",
                  "status": {
                    "id": 16,
                    "@id": "/api/3/picklists/ab65eb0f-e7a7-4993-8474-da5c8b52f380",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Assigned",
                    "listName": "/api/3/picklist_names/21ddbcfd-b4a3-4273-adea-c674fe47d643",
                    "itemValue": "Assigned",
                    "orderIndex": 0
                  },
                  "priority": {
                    "id": 144,
                    "@id": "/api/3/picklists/90088ebe-0a7d-4aa6-9c9c-93b937a4e4f8",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#e36c29",
                    "display": "High",
                    "listName": "/api/3/picklist_names/bea9a490-50d1-4597-8ad9-24422e10676e",
                    "itemValue": "High",
                    "orderIndex": 2
                  },
                  "tasktype": "Remediate Infected Machine",
                  "__replace": "",
                  "incidents": "{{vars.relatedIncidents}}",
                  "startDate": "{{globalVars.Current_Date}}",
                  "description": "<p>The asset <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.steps.Create_Asset.ip}} ]</span> has been determined  to be <span style=\"background-color:#FF0000;color:#FFFFFF;font-weight:bold\">[ infected ]</span>. Please manually remediate it.</p>",
                  "assignedOnDate": "{{globalVars.Current_Date}}",
                  "assignedToPerson": "{{globalVars.Current_User}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/tasks",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "87",
              "top": "960",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "d7f723d5-ed29-4699-8b94-1249bb615d0d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get IP Reputation",
              "description": null,
              "arguments": {
                "name": "VirusTotal",
                "config": "a4a7d71a-220e-4438-a10a-f952e6d03819",
                "params": {
                  "ip": "{{vars.detination_ip}}"
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Get IP Reputation From VirusTotal</span></p>\n\n<p>There was no existing indicator for the destination IP address <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.detination_ip}} ]</span>. Retrieving the IP's reputation from VirusTotal.</p>",
                  "records": ""
                },
                "version": "1.0.1",
                "connector": "virustotal",
                "operation": "query_ip",
                "operationTitle": "Get IP Reputation",
                "step_variables": []
              },
              "status": null,
              "left": "600",
              "top": "380",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "fe01bca4-05d8-44ab-9f6b-7ebfd64775ff"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Alert Attributes",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Initialize Alert Fields</span></p>",
                  "records": ""
                },
                "resource": {
                  "name": "{{vars.source_data.incident.ruleName}}-{{vars.source_data.incident.id}}",
                  "type": {
                    "id": 120,
                    "@id": "/api/3/picklists/0cbc2c31-c360-4770-b1e7-3653a8c24ead",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Malware",
                    "listName": "/api/3/picklist_names/a7087b9c-5660-495f-a8ac-c3b198ddb8c2",
                    "itemValue": "Malware",
                    "orderIndex": 6
                  },
                  "dueBy": "{{globalVars.Tomorrow_Date}}",
                  "status": "{% if vars.source_data.incident.resolution == 'Open' %}{{(\"AlertStatus\" | picklist(\"Open\"))[\"@id\"]}}{% endif %}",
                  "severity": "{% if vars.source_data.incident.severityCat == 'MEDIUM' %}{{(\"Severity\" | picklist(\"Medium\"))[\"@id\"]}}{% elif vars.source_data.incident.severityCat == 'HIGH' %}{{(\"Severity\" | picklist(\"High\"))[\"@id\"]}}{% elif vars.source_data.incident.severityCat == 'LOW' %}{{(\"Severity\" | picklist(\"Low\"))[\"@id\"]}}{% endif %}",
                  "sourceId": "{{vars.source_data.incident.id}}",
                  "sourceIp": "{{vars.source_data.incident.srcIpAddr}}",
                  "userName": "{{vars.source_data.incident.user}}",
                  "assignedTo": "/api/3/people/3451141c-bac6-467c-8d72-85e0fab569ce",
                  "sourcedata": "{{vars.source_data|toJSON}}",
                  "description": "<p>Description: {{vars.source_data.incident.ruleDesc}}</p>\n<p>Incident Category: {{vars.source_data.incident.incidentCategory}}</p>\n<p>Source IP: {{vars.source_data.incident.srcIpAddr}}</p>\n<p>Destination IP:&nbsp;{{vars.source_data.incident.destIpAddr}}</p>\n<p>&nbsp;</p>",
                  "respDueDate": "{{globalVars.Tomorrow_Date}}",
                  "targetAsset": "{{vars.source_data.incident.incidentTarget}}",
                  "destinationIp": "{{vars.source_data.incident.destIpAddr}}",
                  "recipientEmailAddress": "{{vars.source_data.incident.user}}@fortisoar.com"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "760",
              "top": "31",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "17244279-aa80-456d-9b0f-779aa1cc2ca6"
            },
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "alerts",
                "resources": [
                  "alerts"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "source",
                      "value": "%FSMSIM-Malware_LM%",
                      "operator": "like",
                      "_operator": "like"
                    }
                  ]
                }
              },
              "status": null,
              "left": "69",
              "top": "31",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "60d34164-33e4-418c-8522-d38a48849722"
            },
            {
              "@type": "WorkflowStep",
              "name": "Block Infected machines",
              "description": null,
              "arguments": {
                "name": "Fortinet FortiGate",
                "config": "33e3d45c-faba-47aa-94a0-e1bcdfd0ca79",
                "params": {
                  "vdom": "",
                  "method": "Quarantine Based",
                  "ip_addresses": "{{vars.source_ip}}",
                  "time_to_live": "12 Hour"
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Blocking IP Address on FortiGate</span></p>\n\n<p>The source IP address <span style=\"background-color:#FF0000;color:#FFFFFF;font-weight:bold\">[ {{vars.source_ip}} ]</span> has been blocked on the FortiGate.</p>",
                  "records": ""
                },
                "version": "3.0.0",
                "connector": "fortigate-firewall",
                "operation": "block_ip",
                "operationTitle": "Block IP Address",
                "step_variables": []
              },
              "status": null,
              "left": "87",
              "top": "1092",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "5d450dd7-0709-4cdf-a24d-e4f9c0cc8f46"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "0073042a-8423-4a37-9ffb-8acda75dee29",
              "name": "Create Asset -> Find Existing Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d6ca6471-db1b-449e-85cf-932c2ffb7f2a",
              "sourceStep": "/api/3/workflow_steps/38d2c5e6-7833-4249-98fe-b1a33d1a35f5"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "01ea8e90-80e3-40ce-8f94-bc766427e70a",
              "name": "Is it Malicious -> Create Indicator",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/0a5c0c4b-4c7f-4ff0-94fc-cbd19a015fec",
              "sourceStep": "/api/3/workflow_steps/eae69b32-a9f2-4332-a0cc-4a7009f7e0c7"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0dac8621-ee7f-4d7d-937e-a475ae2deddf",
              "name": "Is it a Local IP -> Find Existing Indicators",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d6ca6471-db1b-449e-85cf-932c2ffb7f2a",
              "sourceStep": "/api/3/workflow_steps/deb1fc72-00bc-4e9f-8888-bbe9cb54b913"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "2498c388-e2b3-4887-acb0-8d5b6c70676e",
              "name": "Is Malicious -> Close Alert",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3fa7baf0-50ea-4685-996b-31b56d360c5a",
              "sourceStep": "/api/3/workflow_steps/eae69b32-a9f2-4332-a0cc-4a7009f7e0c7"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "4cd1b1da-9d39-411e-a0ed-2734e37c305b",
              "name": "Create Indicator -> Escalate Alert",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/f78d8e4b-5cdd-4822-b468-fd53d8bc831d",
              "sourceStep": "/api/3/workflow_steps/0a5c0c4b-4c7f-4ff0-94fc-cbd19a015fec"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "4fa1c4f7-6699-4eae-a692-1c0abe63cf7b",
              "name": "Create Incident -> Add Manual Remediation Task",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d7f723d5-ed29-4699-8b94-1249bb615d0d",
              "sourceStep": "/api/3/workflow_steps/5d387091-bb08-427d-a710-1298434d2a47"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5159ae14-fa2f-47b7-af40-81fb4c8c9f6a",
              "name": "Get IP Reputation -> get reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/410219fe-3bcc-4ba7-8503-0bda864c6d3e",
              "sourceStep": "/api/3/workflow_steps/fe01bca4-05d8-44ab-9f6b-7ebfd64775ff"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5b98050e-3525-4614-9899-55d661ba96f3",
              "name": "Is Local IP -> Is it a Local IP",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/deb1fc72-00bc-4e9f-8888-bbe9cb54b913",
              "sourceStep": "/api/3/workflow_steps/11e20ce6-b15f-4165-a745-dc70ef9d87ed"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5c986284-ee77-4c96-b4a1-d2e816aa7175",
              "name": "get reputation -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/eae69b32-a9f2-4332-a0cc-4a7009f7e0c7",
              "sourceStep": "/api/3/workflow_steps/410219fe-3bcc-4ba7-8503-0bda864c6d3e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "636e3482-8694-48c9-9d08-9264a6dcc1fe",
              "name": "Get Escalated Incident -> Update Alert Correlation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ee1c2279-a3b5-4d32-8dc0-6e0dc424bd5d",
              "sourceStep": "/api/3/workflow_steps/826ac969-5514-44e3-bbdc-0997dab5a399"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "6a544d5a-fe85-44fe-96f5-1a4fa75afde5",
              "name": "Escalate Alert -> Create Incident",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/5d387091-bb08-427d-a710-1298434d2a47",
              "sourceStep": "/api/3/workflow_steps/f78d8e4b-5cdd-4822-b468-fd53d8bc831d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "ace9dbf2-b1c7-47f5-9fff-7f9734584178",
              "name": "Set Variables -> Update Alert Attributes",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/17244279-aa80-456d-9b0f-779aa1cc2ca6",
              "sourceStep": "/api/3/workflow_steps/85bcaa7e-01f0-4e93-aaff-381813156002"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d3dd8306-37fc-4662-bcb3-ed9a84deebba",
              "name": "Update Alert Attributes -> Match Local IP",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/11e20ce6-b15f-4165-a745-dc70ef9d87ed",
              "sourceStep": "/api/3/workflow_steps/17244279-aa80-456d-9b0f-779aa1cc2ca6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d77f6676-a3f7-4dd1-8b4a-34e1d3d74ada",
              "name": "Existing Indicator -> Get Related Alerts",
              "label": "Yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e5e7f316-c26e-4349-ade7-a589c356f5a1",
              "sourceStep": "/api/3/workflow_steps/30e5409e-66f2-4587-ac64-ef0f73e895b1"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d961d6c8-c1b7-46da-bc31-f28cfa95d4ab",
              "name": "Is it a Local IP -> Create Asset",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/38d2c5e6-7833-4249-98fe-b1a33d1a35f5",
              "sourceStep": "/api/3/workflow_steps/deb1fc72-00bc-4e9f-8888-bbe9cb54b913"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e5c9887d-98c9-48db-9a55-bc0bfb0d322d",
              "name": "Existing Indicator -> Get IP Reputation",
              "label": "No",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fe01bca4-05d8-44ab-9f6b-7ebfd64775ff",
              "sourceStep": "/api/3/workflow_steps/30e5409e-66f2-4587-ac64-ef0f73e895b1"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "eecde8cc-7b61-4aa8-b8cf-dcb8316cd508",
              "name": "Get Related Alerts -> Get Escalated Incident",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/826ac969-5514-44e3-bbdc-0997dab5a399",
              "sourceStep": "/api/3/workflow_steps/e5e7f316-c26e-4349-ade7-a589c356f5a1"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f2427141-3660-4ad4-b539-b40f8a40359e",
              "name": "Find Existing Indicators -> Existing Indicator",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/30e5409e-66f2-4587-ac64-ef0f73e895b1",
              "sourceStep": "/api/3/workflow_steps/d6ca6471-db1b-449e-85cf-932c2ffb7f2a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f357797d-3244-4966-9b83-86b5717a26ea",
              "name": "Update Alert Correlation -> Add Manual Remediation Task",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d7f723d5-ed29-4699-8b94-1249bb615d0d",
              "sourceStep": "/api/3/workflow_steps/ee1c2279-a3b5-4d32-8dc0-6e0dc424bd5d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "fa6a6c80-bbf6-4f4e-a5db-d63c1905b4ff",
              "name": "Start -> Set Variables",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/85bcaa7e-01f0-4e93-aaff-381813156002",
              "sourceStep": "/api/3/workflow_steps/60d34164-33e4-418c-8522-d38a48849722"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "80e1a1ad-6fd6-452a-998c-a5aacd96cae7",
              "name": "Add Manual Remediation Task -> Block Infected machines",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/5d450dd7-0709-4cdf-a24d-e4f9c0cc8f46",
              "sourceStep": "/api/3/workflow_steps/d7f723d5-ed29-4699-8b94-1249bb615d0d"
            }
          ],
          "versions": null,
          "lastModifyDate": 1593532499,
          "uuid": "8e400741-789a-41d6-83b4-be9603ee752b",
          "recordTags": [],
          "isPrivate": false,
          "owners": []
        }
      ],
      "uuid": "5c7b8115-cf39-4e61-af73-8fd74fc5ca08",
      "recordTags": []
    }
  ],
  "macros": [
    {
      "name": "Tomorrow_Date",
      "value": "{{arrow.utcnow().shift(hours=+24).timestamp}}",
      "default_value": null
    },
    {
      "name": "Current_Date",
      "value": "{{arrow.utcnow().timestamp}}",
      "default_value": null
    },
    {
      "name": "Current_User",
      "value": "{{vars.currentUser}}",
      "default_value": null
    }
  ],
  "exported_tags": []
}