{
  "type": "workflow_collections",
  "data": [
    {
      "@type": "WorkflowCollection",
      "name": "00 - Lazy Analyst",
      "description": null,
      "visible": true,
      "image": null,
      "uuid": "4afec611-32a5-4368-a338-4c7336d4c670",
      "recordTags": [],
      "workflows": [
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "01 - FSM CMDB Sync",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/4afec611-32a5-4368-a338-4c7336d4c670",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/fce40f64-e0da-4e30-bb79-42ea0fffb05d",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Get Device Details",
              "description": null,
              "arguments": {
                "name": "Fortinet FortiSIEM",
                "config": "8ea08a0e-458a-4d6f-be15-1dbe8feeef99",
                "params": {
                  "ip": "{{vars.input.records[0].ip}}",
                  "org": ""
                },
                "version": "4.0.0",
                "connector": "fortinet-fortisiem",
                "operation": "get_device_info",
                "operationTitle": "Get Device Information",
                "step_variables": []
              },
              "status": null,
              "left": "300",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "92a9ab2f-dd0b-4534-910f-89b211d8318e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Process Device Details",
              "description": null,
              "arguments": {
                "device_details": "{%if vars.steps.Get_Device_Details.data%}{{vars.steps.Get_Device_Details.data}}{%endif%}",
                "related_alerts": "{{((vars.input.records[0]['@id']+ \"?$relationships=true\")|fromIRI).alerts}}"
              },
              "status": null,
              "left": "300",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "8f7acb0b-350b-4bf9-8069-0432ecc7eb3d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Asset",
              "description": null,
              "arguments": {
                "when": "{{vars.device_details}}",
                "resource": {
                  "name": "{{vars.device_details.device.name}}",
                  "status": {
                    "id": 59,
                    "@id": "/api/3/picklists/421c20cd-e63d-4e32-9a25-774b2155cd24",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Active",
                    "listName": "/api/3/picklist_names/3c57ea34-4866-4c8f-ba74-dc51806727a9",
                    "itemValue": "Active",
                    "orderIndex": 0
                  },
                  "emailId": "{{vars.device_details.device.contact}}",
                  "category": "{%if \"Server\" in vars.device_details.device.deviceType.model%}{{\"AssetCategory\" | picklist(\"Server\", \"@id\")}}{%elif \"Windows\" in vars.device_details.device.deviceType.model%}{{\"AssetCategory\" | picklist(\"Desktop\", \"@id\")}}{%endif%}",
                  "hostname": "{{vars.device_details.device.name}}",
                  "managedBy": "{{vars.device_details.device.contact}}",
                  "macAddress": "{{vars.device_details.device.interfaces.networkinterface.macAddr}}",
                  "propertyOf": "{{vars.device_details.device.department}}",
                  "description": "{{vars.device_details.device.description}}",
                  "operatingSystem": "{%if \"Linux\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"Linux\", \"@id\")}}{%elif \"UNIX\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"UNIX\",\"@id\")}}{%elif \"Windows 7\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"Windows 7\",\"@id\")}}{%elif \"Windows 8\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"Windows 8\",\"@id\")}}{%elif \"Windows 10\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"Windows 10\",\"@id\")}}{%elif \"OS X\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"OS X\",\"@id\")}}{%elif \"iOS\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"iOS\",\"@id\")}}{%elif \"Android\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"Android\",\"@id\")}}{%elif \"Windows Phone\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"Windows Phone\",\"@id\")}}{%elif \"Other\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"Other\",\"@id\")}}{%elif \"Server 2003\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"Server 2003\",\"@id\")}}{%elif \"Server 2008\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"Server 2008\",\"@id\")}}{%elif \"Server 2012\" in vars.device_details.device.deviceType.model%}{{\"OperatingSystem\" | picklist(\"Server 2012\",\"@id\")}}{%endif%}"
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/assets",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": {
                  "is_critical": "{%if vars.device_details.device.department == 'Engineering'%}True{%else%}False{%endif%}"
                }
              },
              "status": null,
              "left": "300",
              "top": "432",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "7dcecd9c-0d29-4d0d-a676-26e2ad5e56b9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "assets",
                "resources": [
                  "assets"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "array",
                      "field": "recordTags",
                      "value": [
                        "/api/3/tags/malware_investigation"
                      ],
                      "module": "recordTags",
                      "display": null,
                      "operator": "in",
                      "OPERATOR_KEY": "$",
                      "previousOperator": "in"
                    }
                  ]
                }
              },
              "status": null,
              "left": "300",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "fce40f64-e0da-4e30-bb79-42ea0fffb05d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Part of Critical Infra",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/f97f11f6-e8a6-49d7-9a26-b80cf18a6da2",
                    "condition": "{{ vars.is_critical }}",
                    "step_name": "Update Alerts"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/e403b4c3-49a2-421d-8011-5e5e2c4c5055",
                    "step_name": "Stop"
                  }
                ]
              },
              "status": null,
              "left": "300",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "e4596cd9-b99b-4f41-a483-02cb1290d9fa"
            },
            {
              "@type": "WorkflowStep",
              "name": "Stop",
              "description": null,
              "arguments": {
                "params": [],
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "no_op",
                "operationTitle": "Utils: No Operation",
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "705",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "e403b4c3-49a2-421d-8011-5e5e2c4c5055"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Alerts",
              "description": null,
              "arguments": {
                "for_each": {
                  "item": "{{vars.related_alerts}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "severity": {
                    "id": 119,
                    "@id": "/api/3/picklists/7efa2220-39bb-44e4-961f-ac368776e3b0",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#e31b1d",
                    "display": "Critical",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "Critical",
                    "orderIndex": 4
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.item}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "475",
              "top": "705",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "f97f11f6-e8a6-49d7-9a26-b80cf18a6da2"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "e3d5c1fd-c8bc-44a4-87d1-bdddd5732293",
              "name": "Get Device Details -> Process Device Details",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8f7acb0b-350b-4bf9-8069-0432ecc7eb3d",
              "sourceStep": "/api/3/workflow_steps/92a9ab2f-dd0b-4534-910f-89b211d8318e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "cdd6d13d-439e-44a6-a71b-a70859efc502",
              "name": "Process Device Details -> Update Asset",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/7dcecd9c-0d29-4d0d-a676-26e2ad5e56b9",
              "sourceStep": "/api/3/workflow_steps/8f7acb0b-350b-4bf9-8069-0432ecc7eb3d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "fc2f11a0-79ee-42db-b3fd-ace11e546535",
              "name": "Start -> Get Device Details",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/92a9ab2f-dd0b-4534-910f-89b211d8318e",
              "sourceStep": "/api/3/workflow_steps/fce40f64-e0da-4e30-bb79-42ea0fffb05d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "79383d92-2d88-4326-953a-ccff97634815",
              "name": "Update Asset -> Is Critical",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e4596cd9-b99b-4f41-a483-02cb1290d9fa",
              "sourceStep": "/api/3/workflow_steps/7dcecd9c-0d29-4d0d-a676-26e2ad5e56b9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "7ddf8455-beac-4f1f-bdde-923403fab52a",
              "name": "Is Critical -> Stop",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e403b4c3-49a2-421d-8011-5e5e2c4c5055",
              "sourceStep": "/api/3/workflow_steps/e4596cd9-b99b-4f41-a483-02cb1290d9fa"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "8d38dc58-0e19-47f5-832b-c70c8824bcbd",
              "name": "Is Critical -> Update Alerts",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/f97f11f6-e8a6-49d7-9a26-b80cf18a6da2",
              "sourceStep": "/api/3/workflow_steps/e4596cd9-b99b-4f41-a483-02cb1290d9fa"
            }
          ],
          "versions": null,
          "lastModifyDate": 1597839977,
          "uuid": "1847fc20-5b9a-4df6-8f35-fa1381a015ea",
          "recordTags": [
            "Assets"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "05 - Malware Attack Remediation",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/4afec611-32a5-4368-a338-4c7336d4c670",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/9faf3224-1788-4dc9-9b10-f1a070b97dd1",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "route": "81b42631-93af-4f2a-9d7c-b935e546586d",
                "resources": [
                  "incidents"
                ],
                "inputVariables": [],
                "step_variables": {
                  "input": {
                    "records": "{{vars.input.records}}"
                  }
                },
                "displayConditions": {
                  "incidents": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": []
                  }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
              },
              "status": null,
              "left": "300",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
              "uuid": "9faf3224-1788-4dc9-9b10-f1a070b97dd1"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Incident Data",
              "description": null,
              "arguments": {
                "assets_IPs": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).assets|json_query('[*].ip[]')|join(\",\")}}",
                "indicators": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).indicators|json_query('[*].[\"value\"][]')}}",
                "related_users": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).alerts|json_query('[*].[\"userName\"][]')}}",
                "related_alerts": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).alerts|json_query('[*].[\"name\"][]')}}",
                "related_assets": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).assets|json_query('[*].[\"ip\"][]')}}"
              },
              "status": null,
              "left": "300",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "eb5a2f2d-034e-4c42-b4c1-87f5c2c029d6"
            },
            {
              "@type": "WorkflowStep",
              "name": "Block Infected Users on AD",
              "description": null,
              "arguments": {
                "name": "Active Directory",
                "config": "1b14150d-e5da-4fff-a71a-a2c18a3c7f7b",
                "params": {
                  "search_attr_name": "Email",
                  "search_attr_value": "{{vars.item}}@fortielab.com"
                },
                "version": "2.1.0",
                "for_each": {
                  "item": "{{vars.related_users}}",
                  "condition": ""
                },
                "connector": "activedirectory",
                "operation": "disable_user_account",
                "ignore_errors": true,
                "operationTitle": "Disable User Account",
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "705",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "67262f52-b682-49cd-9f0a-72cfe0dcec72"
            },
            {
              "@type": "WorkflowStep",
              "name": "Block Infected Machines on FortiGate",
              "description": null,
              "arguments": {
                "name": "Fortinet FortiGate",
                "config": "0adebb44-e36c-4901-9c3f-7daf02d26f30",
                "params": {
                  "vdom": "",
                  "method": "Quarantine Based",
                  "ip_addresses": "{{vars.assets_IPs}}",
                  "time_to_live": "1 Hour"
                },
                "version": "3.0.0",
                "connector": "fortigate-firewall",
                "operation": "block_ip",
                "operationTitle": "Block IP Address",
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "b843da61-d876-437f-89f1-929bbd25d13b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Enforce User Deactivation and IPs Quarantine",
              "description": null,
              "arguments": {
                "resource": {
                  "method": {
                    "id": 116,
                    "@id": "/api/3/picklists/7a04788b-5128-4288-a0fc-6e82d18c3b7b",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "System",
                    "listName": "/api/3/picklist_names/d7bdd0ba-d721-4324-bec5-410e23f0f485",
                    "itemValue": "System",
                    "orderIndex": 1
                  },
                  "owners": [
                    "/api/3/teams/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
                  ],
                  "status": {
                    "id": 208,
                    "@id": "/api/3/picklists/d26464e0-1df4-46c2-a032-018911ba0c40",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#bf9937",
                    "listName": "/api/3/picklist_names/ce294c1f-9318-425f-9a12-2957292f4cbf",
                    "itemValue": "Pending",
                    "orderIndex": 2
                  },
                  "playbookiri": "api/3/workflows/60b44526-f490-4592-bde3-da0af2204ee1",
                  "playbookname": "05 - Malware Attack Remediation",
                  "playbookuuid": "60b44526-f490-4592-bde3-da0af2204ee1",
                  "approvaldescription": "Disable users on AD and Quarantine infected machines on FortiGate"
                },
                "collection": "approvals",
                "step_variables": []
              },
              "status": null,
              "left": "300",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dcg",
              "uuid": "fe1dc85f-3ad6-4579-9618-782ded2dfea3"
            },
            {
              "@type": "WorkflowStep",
              "name": "Is Approved",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/a3d1a006-619c-451c-b82e-b746be5d4485",
                    "step_name": "Do Nothing"
                  },
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/b843da61-d876-437f-89f1-929bbd25d13b",
                    "condition": "{{ vars.steps.Enforce_User_Deactivation_and_IPs_Quarantine.approved }}",
                    "step_name": "Block Infected Machines on FortiGate"
                  }
                ]
              },
              "status": null,
              "left": "300",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "989af1c2-4a65-4cc4-b6d1-76fd26fe4b2a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Do Nothing",
              "description": null,
              "arguments": {
                "params": [],
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "no_op",
                "operationTitle": "Utils: No Operation",
                "step_variables": []
              },
              "status": null,
              "left": "475",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "a3d1a006-619c-451c-b82e-b746be5d4485"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "f6006bbe-5ffe-4c4f-9623-487a747c9d0f",
              "name": "Start -> Get Incident Data",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/eb5a2f2d-034e-4c42-b4c1-87f5c2c029d6",
              "sourceStep": "/api/3/workflow_steps/9faf3224-1788-4dc9-9b10-f1a070b97dd1"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b5c29f4e-f17b-428e-8c84-3fa6912d0de1",
              "name": "Get Incident Data -> Enforce User Deactivation and IPs Quarantine",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fe1dc85f-3ad6-4579-9618-782ded2dfea3",
              "sourceStep": "/api/3/workflow_steps/eb5a2f2d-034e-4c42-b4c1-87f5c2c029d6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b98b2a9a-726a-4d42-a22a-03a9f6c13110",
              "name": "Enforce User Deactivation and IPs Quarantine -> Is Approved",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/989af1c2-4a65-4cc4-b6d1-76fd26fe4b2a",
              "sourceStep": "/api/3/workflow_steps/fe1dc85f-3ad6-4579-9618-782ded2dfea3"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5eda116f-53ab-4ddc-b2f1-486af44498cc",
              "name": "Is Approved -> Do Nothing",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/a3d1a006-619c-451c-b82e-b746be5d4485",
              "sourceStep": "/api/3/workflow_steps/989af1c2-4a65-4cc4-b6d1-76fd26fe4b2a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "61da5f79-6557-46a8-b15a-6fc82095f1f0",
              "name": "Is Approved -> Block Infected Machines on FortiGate",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/b843da61-d876-437f-89f1-929bbd25d13b",
              "sourceStep": "/api/3/workflow_steps/989af1c2-4a65-4cc4-b6d1-76fd26fe4b2a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5e8325b6-451e-4a1c-b0b4-9df28af471ab",
              "name": "Block Infected Machines on FortiGate -> Block Infected Users on AD",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/67262f52-b682-49cd-9f0a-72cfe0dcec72",
              "sourceStep": "/api/3/workflow_steps/b843da61-d876-437f-89f1-929bbd25d13b"
            }
          ],
          "versions": null,
          "lastModifyDate": 1596552031,
          "uuid": "60b44526-f490-4592-bde3-da0af2204ee1",
          "recordTags": [
            "Incidents"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "Get Related Traffic patterns",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/4afec611-32a5-4368-a338-4c7336d4c670",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/1a1b5af4-b0f2-4fd7-a0e5-aad3e41532f6",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "route": "05003c27-e784-49a5-8791-6d46e7438a10",
                "resources": [
                  "incidents"
                ],
                "inputVariables": [],
                "step_variables": {
                  "input": {
                    "records": "{{vars.input.records}}"
                  }
                },
                "displayConditions": {
                  "incidents": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": []
                  }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
              },
              "status": null,
              "left": "40",
              "top": "40",
              "stepType": "/api/3/workflow_step_types/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
              "uuid": "1a1b5af4-b0f2-4fd7-a0e5-aad3e41532f6"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Related Network Traffic",
              "description": null,
              "arguments": {
                "name": "Fortinet FortiSIEM",
                "config": "8ea08a0e-458a-4d6f-be15-1dbe8feeef99",
                "params": {
                  "cond": "srcIpAddr IN ({{vars.v_Source_IP}})",
                  "start": 0,
                  "value": 1,
                  "groupby": "",
                  "orderby": "",
                  "perPage": 50,
                  "AttrList": "eventType,eventName,srcIpAddr,destIpAddr,serviceName,destIpPort,sentBytes64,recvBytes64",
                  "rel_time": "Hours",
                  "time_selection": "Relative Time"
                },
                "version": "4.0.0",
                "connector": "fortinet-fortisiem",
                "operation": "run_report",
                "operationTitle": "Run Advanced Search Query",
                "step_variables": []
              },
              "status": null,
              "left": "40",
              "top": "260",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "ce563928-ebeb-43b5-a876-e9a99437f0d6"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Source IPs List",
              "description": null,
              "arguments": {
                "source_IPs": "{{vars.input.records[0]['@id']}}"
              },
              "status": null,
              "left": "40",
              "top": "149",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "4c41d069-10e2-4a87-91d1-1d0602a62380"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "cb6428b2-8618-4b2c-afdb-0949257f82f6",
              "name": "Start -> Get Source IPs List",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/4c41d069-10e2-4a87-91d1-1d0602a62380",
              "sourceStep": "/api/3/workflow_steps/1a1b5af4-b0f2-4fd7-a0e5-aad3e41532f6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5f2d5277-ba5f-4f83-9461-d01e3230fd84",
              "name": "Get Source IPs List -> Get Related Network Traffic",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ce563928-ebeb-43b5-a876-e9a99437f0d6",
              "sourceStep": "/api/3/workflow_steps/4c41d069-10e2-4a87-91d1-1d0602a62380"
            }
          ],
          "versions": null,
          "lastModifyDate": 1596469768,
          "uuid": "6a77ab52-fd9b-4135-94f1-df107b758ce2",
          "recordTags": [
            "Incidents"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "04 - Malware Investigation - Auto",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/4afec611-32a5-4368-a338-4c7336d4c670",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/07e56d3d-06b3-4cfd-be0e-ab9f3098a87a",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Get Incident Data",
              "description": null,
              "arguments": {
                "assets_IPs": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).assets|json_query('[*].ip[]')|join(\",\")}}",
                "indicators": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).indicators|json_query('[*].[\"value\"][]')}}",
                "linked_alerts": "[]",
                "related_users": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).alerts|json_query('[*].[\"userName\"][]')}}",
                "related_alerts": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).alerts|json_query('[*].[\"name\"][]')}}",
                "related_assets": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).assets|json_query('[*].[\"ip\"][]')}}",
                "alerts_source_data": "[]",
                "related_assets_IRIs": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).assets|json_query('[*].[\"@id\"][]')}}"
              },
              "status": null,
              "left": "420",
              "top": "211",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "06765a23-808b-43a3-be19-48f73f0793f4"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Most Used Protocols",
              "description": null,
              "arguments": {
                "name": "Fortinet FortiSIEM",
                "config": "8ea08a0e-458a-4d6f-be15-1dbe8feeef99",
                "params": {
                  "cond": "srcIpAddr IN({{vars.assets_IPs}})",
                  "start": 0,
                  "value": 10,
                  "groupby": "",
                  "orderby": "totBytes64",
                  "perPage": 50,
                  "AttrList": "appName,totBytes64",
                  "rel_time": "Minutes",
                  "time_selection": "Relative Time"
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Run FortiSIEM Query: <span style=\"color:orange;font-weight:bold\">Get Most Used Protocols</span>",
                  "records": ""
                },
                "version": "4.0.0",
                "connector": "fortinet-fortisiem",
                "operation": "run_report",
                "operationTitle": "Run Advanced Search Query",
                "step_variables": {
                  "used_protocols": "{{vars.result.data.events}}"
                }
              },
              "status": null,
              "left": "600",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "fd97b2fc-f815-4df4-b8e6-5f346e75af77"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get All Dropped Files",
              "description": null,
              "arguments": {
                "name": "Fortinet FortiSIEM",
                "config": "8ea08a0e-458a-4d6f-be15-1dbe8feeef99",
                "params": {
                  "cond": "reptDevIpAddr IN ({{vars.assets_IPs}})  AND  eventType = \"Win-Sysmon-11-FileCreate\"",
                  "start": 0,
                  "value": 10,
                  "groupby": "",
                  "orderby": "reptDevIpAddr DESC",
                  "perPage": 100,
                  "AttrList": "reptDevIpAddr,fileName,hashCode,procName",
                  "rel_time": "Minutes",
                  "time_selection": "Relative Time"
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- FortiSIEM Query: <span style=\"color:orange;font-weight:bold\">Get All Dropped Files</span>",
                  "records": ""
                },
                "version": "4.0.0",
                "connector": "fortinet-fortisiem",
                "operation": "run_report",
                "operationTitle": "Run Advanced Search Query",
                "step_variables": {
                  "dropped_files": "{{vars.result.data.events}}"
                }
              },
              "status": null,
              "left": "600",
              "top": "413",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "6aa6b576-66f0-4f32-b860-6f7898a83b06"
            },
            {
              "@type": "WorkflowStep",
              "name": "Format Dropped Files Report",
              "description": null,
              "arguments": {
                "when": "{{vars.dropped_files | length > 0}}",
                "params": {
                  "data": "{{vars.dropped_files}}",
                  "display": "Horizontal",
                  "styling": false,
                  "template": "Stylized with row selection",
                  "row_fields": ""
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">List of dropped files on infected machines:</span></p>\t\n{{vars.result.data}}",
                  "records": ""
                },
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "json_to_html",
                "operationTitle": "Utils: Convert JSON into a HTML Table",
                "step_variables": []
              },
              "status": null,
              "left": "600",
              "top": "613",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "eef93a89-4f6f-4428-81ed-662111e83201"
            },
            {
              "@type": "WorkflowStep",
              "name": "Format Results",
              "description": null,
              "arguments": {
                "_tmp1": "{%for asset in vars.related_assets_IRIs%}{{vars.linked_alerts.append((asset+ \"?$relationships=true\")|fromIRI)}}{%endfor%}",
                "dropped_files": "{{vars.dropped_files|json_query(\"[].attributes\")}}",
                "used_protocols": "{{vars.used_protocols|json_query(\"[*].attributes\")}}"
              },
              "status": null,
              "left": "800",
              "top": "500",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "7dc3429f-e598-47ed-8417-92f08d43d3da"
            },
            {
              "@type": "WorkflowStep",
              "name": "Format Network Report",
              "description": null,
              "arguments": {
                "when": "{{vars.used_protocols|length > 0}}",
                "params": {
                  "data": "{{vars.used_protocols}}",
                  "display": "Horizontal",
                  "styling": false,
                  "template": "Stylized with row selection",
                  "row_fields": ""
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Used Protocols between infected assets:</span></p>\t\n{{vars.result.data}}",
                  "records": ""
                },
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "json_to_html",
                "operationTitle": "Utils: Convert JSON into a HTML Table",
                "step_variables": []
              },
              "status": null,
              "left": "990",
              "top": "613",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "bd7966f5-9a6d-4fe2-be6c-1908da0d1507"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Incident",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Update Incident Data with FortiSIEM Reports",
                  "records": ""
                },
                "resource": {
                  "phase": {
                    "id": 187,
                    "@id": "/api/3/picklists/bb7407e0-f699-11e7-8c3f-9a214cf093ae",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Containment",
                    "listName": "/api/3/picklist_names/b862eb1f-b385-40ca-baa7-5a1b1f91a651",
                    "itemValue": "Containment",
                    "orderIndex": 3
                  },
                  "__link": {
                    "mitreincidentlink": "{{(vars.alerts_source_data|json_query('[].mitrelink[].[\"@id\"]'))|flatten(levels=1)|unique}}"
                  },
                  "description": "<span style=\"background-color:yellow;color:black;font-weight:bold\">Related Alerts:</span>\n-{{vars.alerts_list|json_query(\"[*].name\")|join(\"\\n -\")}}\n\n\n<span style=\"background-color:yellow;color:black;font-weight:bold\">Related Assets:</span>\n-{{vars.related_assets|join(\"\\n-\")}}\n\n<span style=\"background-color:yellow;color:black;font-weight:bold\">Related Users:</span>\n{{vars.related_users|join(\", \")}}\n\n<span style=\"background-color:yellow;color:black;font-weight:bold\">Indicators:</span>\n<span style=\"color:red;font-weight:bold\">- {{vars.indicators|join(\"\\n-\")}}</span>\n\n<span style=\"background-color:yellow;color:black;font-weight:bold\">Suggested MITRE Remediations:</span>\n-{{((vars.alerts_source_data|json_query('[].mitrelink[]. mitigations'))|flatten(levels=1)|unique)|join(\"\\n-\")}}\n"
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/incidents",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "791",
              "top": "989",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "fc95f4f1-e221-4407-a779-8725090baca6"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute Results",
              "description": null,
              "arguments": {
                "alerts_list": "{{vars.linked_alerts|json_query('[*].alerts[]') | flatten(levels=1)}}",
                "alerts_list_IRIs": "{{vars.linked_alerts|json_query('[*].alerts[].[\"@id\"]')|flatten(levels=1)}}"
              },
              "status": null,
              "left": "791",
              "top": "760",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "15423588-0219-4baf-8837-c1e3b7e12a97"
            },
            {
              "@type": "WorkflowStep",
              "name": "Results Parser",
              "description": null,
              "arguments": {
                "_tmp2": "{%for alert in vars.alerts_list_IRIs%}{{vars.alerts_source_data.append((alert+ \"?$relationships=true\")|fromIRI)}}{%endfor%}"
              },
              "status": null,
              "left": "791",
              "top": "873",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "90bd85bc-14b1-48a1-aeab-0fcaa685d3b8"
            },
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "incidents",
                "resources": [
                  "incidents"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "name",
                      "value": "%alware%",
                      "operator": "like",
                      "_operator": "like"
                    }
                  ]
                }
              },
              "status": null,
              "left": "67",
              "top": "27",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "07e56d3d-06b3-4cfd-be0e-ab9f3098a87a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Wait for Alerts to be Linked",
              "description": null,
              "arguments": {
                "delay": {
                  "days": 0,
                  "hours": 0,
                  "weeks": 0,
                  "minutes": 0,
                  "seconds": 15
                }
              },
              "status": null,
              "left": "247",
              "top": "120",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dbf",
              "uuid": "e9606b3f-0365-4cdf-b8bf-405c4c471625"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "aafcd6de-3fac-419a-90ca-bc2c469e2095",
              "name": "Get Incident Data -> Get Most Used Protocols",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fd97b2fc-f815-4df4-b8e6-5f346e75af77",
              "sourceStep": "/api/3/workflow_steps/06765a23-808b-43a3-be19-48f73f0793f4"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "689ff70d-8ddb-435f-8aeb-6f9774e225f2",
              "name": "Get Most Used Protocols -> Get All Dropped Files",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/6aa6b576-66f0-4f32-b860-6f7898a83b06",
              "sourceStep": "/api/3/workflow_steps/fd97b2fc-f815-4df4-b8e6-5f346e75af77"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c7eedf06-175b-4a78-b14f-3be7f4e40ee5",
              "name": "Get All Dropped Files -> Format Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/7dc3429f-e598-47ed-8417-92f08d43d3da",
              "sourceStep": "/api/3/workflow_steps/6aa6b576-66f0-4f32-b860-6f7898a83b06"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "8fb577ca-e12a-405e-bd38-1eeb6e68d682",
              "name": "Format Results -> Compile results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/eef93a89-4f6f-4428-81ed-662111e83201",
              "sourceStep": "/api/3/workflow_steps/7dc3429f-e598-47ed-8417-92f08d43d3da"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "4eb178ce-b4cd-4796-b932-dc04a07c4ec2",
              "name": "Format Results -> Format Network Report",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/bd7966f5-9a6d-4fe2-be6c-1908da0d1507",
              "sourceStep": "/api/3/workflow_steps/7dc3429f-e598-47ed-8417-92f08d43d3da"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "16921ccd-d785-49e3-bf5e-ce7157af6839",
              "name": "Format Dropped Files Report -> Compute Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/15423588-0219-4baf-8837-c1e3b7e12a97",
              "sourceStep": "/api/3/workflow_steps/eef93a89-4f6f-4428-81ed-662111e83201"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "240ef45a-cd7f-40c4-a5fc-9239454d3c5f",
              "name": "Format Network Report -> Compute Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/15423588-0219-4baf-8837-c1e3b7e12a97",
              "sourceStep": "/api/3/workflow_steps/bd7966f5-9a6d-4fe2-be6c-1908da0d1507"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "70cd27de-9165-4048-a8bf-ac62a4aefa78",
              "name": "Compute Results -> Results Parser",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/90bd85bc-14b1-48a1-aeab-0fcaa685d3b8",
              "sourceStep": "/api/3/workflow_steps/15423588-0219-4baf-8837-c1e3b7e12a97"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "13aa5510-95aa-4c22-b981-7aef0efc86ca",
              "name": "Results Parser -> Update Incident",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fc95f4f1-e221-4407-a779-8725090baca6",
              "sourceStep": "/api/3/workflow_steps/90bd85bc-14b1-48a1-aeab-0fcaa685d3b8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d83f0d95-bb4f-4f6e-804d-241ba427b7a7",
              "name": "Start -> Wait for Alerts to be Linked",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e9606b3f-0365-4cdf-b8bf-405c4c471625",
              "sourceStep": "/api/3/workflow_steps/07e56d3d-06b3-4cfd-be0e-ab9f3098a87a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c44e10de-d218-4a10-8b5c-80e838353f64",
              "name": "Wait for Alerts to be Linked -> Get Incident Data",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/06765a23-808b-43a3-be19-48f73f0793f4",
              "sourceStep": "/api/3/workflow_steps/e9606b3f-0365-4cdf-b8bf-405c4c471625"
            }
          ],
          "versions": null,
          "lastModifyDate": 1596644471,
          "uuid": "737c0d50-dc4d-41c5-b4fa-10efc06d8cca",
          "recordTags": [
            "Incidents"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "06 - Phishing Investigation",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/4afec611-32a5-4368-a338-4c7336d4c670",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/91a88390-1228-4313-8646-cfa01da0285a",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "alerts",
                "resources": [
                  "alerts"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "source",
                      "value": "FSMSIM-EMAIL-FDLA",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                }
              },
              "status": null,
              "left": "808",
              "top": "20",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "91a88390-1228-4313-8646-cfa01da0285a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Local Attributes",
              "description": null,
              "arguments": {
                "my_domain": "fortielab.com",
                "my_subnet": "['10.200.0.0/24']",
                "email_body": "{%if vars.input.records[0].sourcedata.body.html %}{{vars.input.records[0].sourcedata.body.html}}{%else%}{{vars.input.records[0].sourcedata.body.text}}{%endif%}",
                "source_data": "{{vars.input.records[0].sourcedata}}",
                "has_attachement_email": "{{vars.input.records[0].sourcedata.parsed_attachment_data | length}}"
              },
              "status": null,
              "left": "808",
              "top": "127",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "5357ee19-6a76-4276-af2f-4197a502f1b2"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Alert",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Initialize Alert Fields</span></p>",
                  "records": ""
                },
                "resource": {
                  "name": "Suspicious Email:{{vars.source_data.headers.subject}}",
                  "type": {
                    "id": 121,
                    "@id": "/api/3/picklists/0b3ef6f9-eb29-4ab9-ac98-98364bd1a3aa",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Phishing",
                    "listName": "/api/3/picklist_names/a7087b9c-5660-495f-a8ac-c3b198ddb8c2",
                    "itemValue": "Phishing",
                    "orderIndex": 7
                  },
                  "dueBy": "{{globalVars.Tomorrow_Date}}",
                  "state": {
                    "id": 220,
                    "@id": "/api/3/picklists/a1bac09b-1441-45aa-ad1b-c88744e48e72",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "New",
                    "listName": "/api/3/picklist_names/2f9ed741-25fe-475a-9f12-64336288eebf",
                    "itemValue": "New",
                    "orderIndex": 0
                  },
                  "status": {
                    "id": 118,
                    "@id": "/api/3/picklists/7de816ff-7140-4ee5-bd05-93ce22002146",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Open",
                    "listName": "/api/3/picklist_names/33e964a9-d607-49f2-813c-7ce46141815a",
                    "itemValue": "Open",
                    "orderIndex": 1
                  },
                  "emailTo": "{{vars.source_data.headers.to}}",
                  "reporter": "{{vars.source_data.headers.from}}",
                  "severity": {
                    "id": 177,
                    "@id": "/api/3/picklists/b3c20a3a-ecfd-4adc-a225-0205968e6793",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#D2AC1A",
                    "display": "Medium",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "Medium",
                    "orderIndex": 2
                  },
                  "sourceId": "{{vars.source_data.headers['message-id']}}",
                  "emailBody": "{%if vars.source_data.body.html %}{{vars.source_data.body.html}}{%else%}{{vars.source_data.body.text}}{%endif%}",
                  "emailFrom": "{{vars.source_data.headers.from}}",
                  "epochTime": "{{vars.email_date}}",
                  "assignedTo": "/api/3/people/3451141c-bac6-467c-8d72-85e0fab569ce",
                  "recordTags": [
                    "/api/3/tags/Phishing"
                  ],
                  "sourceType": "Suspicious Mailbox",
                  "sourcedata": "{{vars.source_data|toJSON}}",
                  "description": "{%if 'Fw:' in vars.source_data.headers.subject or 'Fwd:' in vars.source_data.headers.subject %}\nEmail: ||**{{vars.source_data.headers.subject}}**|| Submited by  **{{vars.source_data.headers.from}}**\n{%endif%}",
                  "respDueDate": "{{globalVars.Tomorrow_Date}}",
                  "emailHeaders": "{{vars.source_data.headers|toJSON}}",
                  "emailSubject": "{{vars.source_data.headers.subject}}",
                  "senderDomain": "{{(vars.source_data.headers.from).split('@')[1]}}",
                  "killChainPhase": {
                    "id": 377,
                    "@id": "/api/3/picklists/d889ee08-9ddd-404b-a166-6e8c33414f5e",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Delivery",
                    "listName": "/api/3/picklist_names/eddbc863-c725-479a-867f-cec66206a6b4",
                    "itemValue": "Delivery",
                    "orderIndex": 3
                  },
                  "attachmentNames": "{%if vars.source_data.attachments[0].metadata.filename%}{{vars.source_data.attachments[0].metadata.filename}}{%endif%}",
                  "senderEmailAddress": "{{vars.original_email_sender}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "808",
              "top": "346",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "cbe554c0-f2f0-4a0b-8bad-c46dc56a9204"
            },
            {
              "@type": "WorkflowStep",
              "name": "Send Auto_Reply to Sender",
              "description": null,
              "arguments": {
                "name": "Exchange",
                "config": "b79754b3-d441-4854-b030-209fd26c61a2",
                "params": {
                  "body": "Your email with Subject: ||{{vars.source_data.headers.subject}}|| has been received, <br>you shall receive the investigation results as soon as available.<br>\n<br>\nSoC Team",
                  "subject": "Suspicious Email received for investigation",
                  "iri_list": "",
                  "cc_recipients": "",
                  "to_recipients": "{{vars.source_data.headers.from|regex_search(\"([\\w_.-]+\\@[\\w_.-]+\\.\\w+)\")}}",
                  "bcc_recipients": "",
                  "inline_iri_list": ""
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Sender Auto-response Notification to Sender</span></p>\n\n<p>The offending email sender <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.source_data.headers.from|regex_search(\"([\\w_.-]+\\@[\\w_.-]+\\.\\w+)\")}} ]</span> has been informed the reported email is received</p>",
                  "records": ""
                },
                "version": "3.4.1",
                "connector": "exchange",
                "operation": "send_email",
                "operationTitle": "Send Email",
                "step_variables": []
              },
              "status": null,
              "left": "808",
              "top": "232",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "4faf14c1-3233-4e5c-8c74-2afb476a6784"
            },
            {
              "@type": "WorkflowStep",
              "name": "Review Blocked Emails",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Create EIS Task</span></p>\n\nA new task has been created for EIS: Review the related alerts from <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.email_from}} ]</span>.</p>",
                  "records": ""
                },
                "resource": {
                  "name": "Review Blocked Emails",
                  "type": {
                    "id": 122,
                    "@id": "/api/3/picklists/826ad76d-e418-4928-9bc9-ea552ebcc5f9",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Incident Response",
                    "listName": "/api/3/picklist_names/b837e375-76af-4ba5-b6a1-bd1c3cd27292",
                    "itemValue": "Incident Response",
                    "orderIndex": 6
                  },
                  "dueBy": "{{globalVars.Tomorrow_Date}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "status": {
                    "id": 169,
                    "@id": "/api/3/picklists/ab65eb0f-e7a7-4993-8474-da5c8b52f380",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Assigned",
                    "listName": "/api/3/picklist_names/21ddbcfd-b4a3-4273-adea-c674fe47d643",
                    "itemValue": "Assigned",
                    "orderIndex": 0
                  },
                  "priority": {
                    "id": 139,
                    "@id": "/api/3/picklists/90088ebe-0a7d-4aa6-9c9c-93b937a4e4f8",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#e36c29",
                    "display": "High",
                    "listName": "/api/3/picklist_names/bea9a490-50d1-4597-8ad9-24422e10676e",
                    "itemValue": "High",
                    "orderIndex": 2
                  },
                  "taskdata": "Emails: {{vars.email_from}} has been blocked on FortiGate,\nreview the action and unblock it if required:\n1. Open any Alert\n2. Click Action\n3. Select FortiMail\n4. Select Unblock Email action\n5. set the email to: {{vars.email_from}}\n6. Click Execute",
                  "__replace": "",
                  "startDate": "{{globalVars.Current_Date}}",
                  "description": "<p>The email sender <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.email_from}} ]</span> has been blocked on the FortiMail,\nreview the action and unblock it if required.</p>\n<p>The steps to unblock the email sender are:<br>\n1. Open related Alerts<br>\n2. Click Action<br>\n3. Select FortiMail<br>\n4. Select Unblock Email action<br>\n5. Set the email to: <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.email_from}} ]</span><br>\n6. Click Execute<br>",
                  "assignedOnDate": "{{globalVars.Current_Date}}",
                  "assignedToPerson": "/api/3/people/3451141c-bac6-467c-8d72-85e0fab569ce"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/tasks",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "806",
              "top": "2529",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "c1dea043-f67f-4c90-af10-11abdd1c8c54"
            },
            {
              "@type": "WorkflowStep",
              "name": "Extract Indicators",
              "description": null,
              "arguments": {
                "ip_indicators": "{%if vars.headers_artifacts and vars.body_artifacts%}{{vars.headers_artifacts.IP | union(vars.body_artifacts.IP)}}{%elif not vars.headers_artifacts%}{{vars.body_artifacts.IP}}{%elif not vars.body_artifacts%}{{vars.headers_artifacts.IP}}{%endif%}",
                "url_indicators": "{%if vars.headers_artifacts and vars.body_artifacts%}{{vars.headers_artifacts.URL | union(vars.body_artifacts.URL)}}{%elif not vars.headers_artifacts%}{{vars.body_artifacts.URL}}{%elif not vars.body_artifacts%}{{vars.headers_artifacts.URL}}{%endif%}",
                "host_indicators": "{%if vars.headers_artifacts and vars.body_artifacts%}{{vars.headers_artifacts.Host | union(vars.body_artifacts.Host)}}{%elif not vars.headers_artifacts%}{{vars.body_artifacts.Host}}{%elif not vars.body_artifacts%}{{vars.headers_artifacts.Host}}{%endif%}",
                "email_indicators": "{%if vars.headers_artifacts and vars.body_artifacts%}{{vars.headers_artifacts.Email | union(vars.body_artifacts.Email)}}{%elif not vars.headers_artifacts%}{{vars.body_artifacts.Email}}{%elif not vars.body_artifacts%}{{vars.headers_artifacts.Email}}{%endif%}"
              },
              "status": null,
              "left": "808",
              "top": "1114",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "547be055-ba84-425c-be08-d556f72c9476"
            },
            {
              "@type": "WorkflowStep",
              "name": "Original Email Attached",
              "description": "Check Whether the email is forwarded inline or as an attachment",
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/3de73b79-5eae-421d-b66e-7d5f8b670f84",
                    "condition": "{{ vars.has_attachement_email > 0 }}"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/e6ea937f-3631-4bea-af54-12ad18e01a4b"
                  }
                ]
              },
              "status": null,
              "left": "808",
              "top": "454",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "2539b9b2-c601-4f27-af31-c5025726f30e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Inline Email",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Create Email Record</span></p>\n\n<p>Email was submitted via forwarding inline.</p>",
                  "records": ""
                },
                "resource": {
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "emailCc": "{{(vars.email_body|regex_search(\"CC:([^:]*)\"))|regex_findall(\"([\\w,_,.,-]+\\@[\\w,_,.,-]+\\.\\w+)\")|unique|join(\",\")}}",
                  "emailTo": "{{(vars.email_body|regex_search(\"To:([^:]*)\")|regex_findall(\"([\\w,_,.,-]+\\@[\\w,_,.,-]+\\.\\w+)\")|unique)|join(\",\")}}",
                  "__replace": "",
                  "emailBody": "<html>{{vars.email_body.split(\"<hr>\")[1]}}",
                  "emailFrom": "{{(vars.email_body|regex_search(\"From:([^>]*)\")).split('<')[1]}}",
                  "emailSubject": "{{(vars.email_body|regex_search(\"Subject:([^<]*)\")).split(':')[1]}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/emails",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "988",
              "top": "554",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "e6ea937f-3631-4bea-af54-12ad18e01a4b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Attached Email",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Create Email Record</span></p>\n\n<p>Email was submitted via forwarding as an attachment.</p>",
                  "records": ""
                },
                "resource": {
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "emailCc": "{{vars.source_data.parsed_attachment_data.0.headers.cc}}",
                  "emailTo": "{{vars.source_data.parsed_attachment_data.0.headers.to}}",
                  "sourceId": "{{vars.source_data.parsed_attachment_data.0.headers['message-id']}}",
                  "__replace": "",
                  "emailBody": "{%if vars.source_data.parsed_attachment_data.0.body.html %}{{vars.source_data.parsed_attachment_data.0.body.html}}{%else%}{{vars.source_data.parsed_attachment_data.0.body.text}}{%endif%}",
                  "emailFrom": "{{vars.source_data.parsed_attachment_data.0.headers.from}}",
                  "emailHeader": "{{vars.source_data.parsed_attachment_data.0.headers|toJSON}}",
                  "emailSubject": "{{vars.source_data.parsed_attachment_data.0.headers.subject}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/emails",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "628",
              "top": "554",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "3de73b79-5eae-421d-b66e-7d5f8b670f84"
            },
            {
              "@type": "WorkflowStep",
              "name": "Prepare File Attachments",
              "description": null,
              "arguments": {
                "file_attachements": "{%if vars.has_attachement_email == 0%}{{vars.source_data.attachments}}{%else%}{{vars.source_data.parsed_attachment_data[0].attachments}}{%endif%}"
              },
              "status": null,
              "left": "808",
              "top": "666",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "84035319-8283-4e5c-8397-3ea7afde17a3"
            },
            {
              "@type": "WorkflowStep",
              "name": "Record File Attachment",
              "description": null,
              "arguments": {
                "config": "f860463d-8a86-48f3-8ddd-bb28c122aeba",
                "params": {
                  "python_function": "import base64\nfile=\"{{vars.file_attachements.0.file}}\"\nfilename=\"{{vars.file_attachements.0.metadata.filename}}\"\ntry:\n\twith open('/tmp/'+filename, 'wb') as tmp_file:\n\t\ttmp_file.write(base64.b64decode(file))\nexcept:\n\tprint('Generic: Could not write attachment!')"
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Storing File Attachments</span></p>\n\n<p>The file attachments are saved to the local disk for further processing.</p>",
                  "records": ""
                },
                "version": "1.2.3",
                "connector": "code-snippet",
                "operation": "python_inline",
                "operationTitle": "Execute Python Code",
                "step_variables": []
              },
              "status": null,
              "left": "808",
              "top": "794",
              "stepType": "/api/3/workflow_step_types/1fdd14cc-d6b4-4335-a3af-ab49c8ed2fd8",
              "uuid": "98e04148-7f0f-4854-a8ea-b8681b8c9031"
            },
            {
              "@type": "WorkflowStep",
              "name": "Upload File IOCs",
              "description": null,
              "arguments": {
                "config": "b79754b3-d441-4854-b030-209fd26c61a2",
                "params": {
                  "filename": "{{vars.item.metadata.filename}}",
                  "file_path": "{{vars.item.metadata.filename}}",
                  "create_attachment": false
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Uploading File Indicator</span></p>\n\n<p>File attachment have been uploaded into FortiSOAR and attachments has been created.</p>",
                  "records": ""
                },
                "version": "3.0.2",
                "for_each": {
                  "item": "{{vars.file_attachements}}",
                  "condition": ""
                },
                "connector": "cyops_utilities",
                "operation": "upload_file_to_cyops",
                "operationTitle": "File: Upload a file to CyOPs and Create an Attachment",
                "step_variables": []
              },
              "status": null,
              "left": "808",
              "top": "900",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "df3d18a9-6a5f-4d2d-b222-51dd636fb542"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create File Indicators",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating File Indicator</span></p>\n\n<p>File: <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.item.data.filename}} ]</span> was created.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.steps.Upload_File_IOCs}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "file": "{{ vars.item.data['@id'] or None }}",
                  "value": "File -  {{vars.item.data.filename}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "sources": "Email",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 73,
                    "@id": "/api/3/picklists/0162241b-f5bf-4917-a150-00e920be47bd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "File",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "File",
                    "orderIndex": 3
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "808",
              "top": "1014",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "378afb83-a1a0-4b91-931d-0dd81597a6c2"
            },
            {
              "@type": "WorkflowStep",
              "name": "Parse Attached Email Attributes",
              "description": null,
              "arguments": {
                "email_cc": "{{vars.steps.Create_Attached_Email.emailCc|regex_findall(\"([\\w,_,.,-]+\\@[\\w,_,.,-]+\\.\\w+)\")|unique}}",
                "email_to": "{{vars.steps.Create_Attached_Email.emailTo|regex_findall(\"([\\w,_,.,-]+\\@[\\w,_,.,-]+\\.\\w+)\")|unique}}",
                "html_body": "{{vars.steps.Create_Attached_Email.emailBody}}",
                "source_ip": "{{vars.source_data.parsed_attachment_data.0.headers['x-originating-ip'] or ''}}",
                "email_from": "{{vars.steps.Create_Attached_Email.emailFrom|regex_search(\"([\\w,_,.,-]+\\@[\\w,_,.,-]+\\.\\w+)\")}}",
                "email_header": "{{vars.steps.Create_Attached_Email.emailHeader}}",
                "body_artifacts": "{{vars.steps.Create_Attached_Email.emailBody|extract_artifacts}}",
                "headers_artifacts": "{{vars.steps.Create_Attached_Email.emailHeader|extract_artifacts}}"
              },
              "status": null,
              "left": "448",
              "top": "666",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "369cb001-e046-45b3-adec-23c575b7b04e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Parse Inline Email Attributes",
              "description": null,
              "arguments": {
                "email_cc": "{{vars.steps.Create_Inline_Email.emailCc|regex_findall(\"([\\w_.-]+\\@[\\w_.-]+\\.\\w+)\")|unique}}",
                "email_to": "{{vars.steps.Create_Inline_Email.emailTo|regex_findall(\"([\\w_.-]+\\@[\\w_.-]+\\.\\w+)\")|unique}}",
                "html_body": "{{vars.steps.Create_Inline_Email.emailBody}}",
                "source_ip": "{{vars.source_data.headers['x-originating-ip'] or ''}}",
                "email_from": "{{vars.steps.Create_Inline_Email.emailFrom}}",
                "body_artifacts": "{{vars.steps.Create_Inline_Email.emailBody | extract_artifacts}}"
              },
              "status": null,
              "left": "1180",
              "top": "666",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "cbba9a1e-a86e-4604-9ccb-b794eab34765"
            },
            {
              "@type": "WorkflowStep",
              "name": "Whitelist local attributes",
              "description": null,
              "arguments": {
                "ip_indicators": "{%if vars.ip_indicators%}\n{{vars.ip_indicators | difference(vars.ip_indicators|ipaddr('10.200.3.0/24'))}}{%endif%}",
                "url_indicators": "{{vars.url_indicators|json_query(\"[?contains(@, 'fortielab') == `false`]\")}}",
                "host_indicators": "{{vars.host_indicators|json_query(\"[?contains(@, 'fortielab') == `false`]\")}}",
                "email_indicators": "{{vars.email_indicators|json_query(\"[?contains(@, 'fortielab.com') == `false`]\")}}"
              },
              "status": null,
              "left": "808",
              "top": "1214",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "c33f7810-72fc-414c-a648-250ff8caf83f"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create IP Indicator",
              "description": null,
              "arguments": {
                "when": "{{vars.ip_indicators_to_create|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating IP Indicator</span></p>\n\n<p>IP indicators are being created for each IP indicator found in the email.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.ip_indicators_to_create}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "value": "{{vars.item}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "sources": "Email",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 77,
                    "@id": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "IP Address",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "IP Address",
                    "orderIndex": 7
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1420",
              "top": "1870",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "69b62a04-451a-4519-ab37-37eb84b095b0"
            },
            {
              "@type": "WorkflowStep",
              "name": "Wait for URLs",
              "description": null,
              "arguments": {
                "delay": {
                  "days": 0,
                  "hours": 0,
                  "weeks": 0,
                  "minutes": 0,
                  "seconds": 46
                }
              },
              "status": null,
              "left": "1100",
              "top": "1760",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dbf",
              "uuid": "d8883237-5b4c-4ba9-9a87-d413d5ea72d1"
            },
            {
              "@type": "WorkflowStep",
              "name": "Wait for Hosts",
              "description": null,
              "arguments": {
                "delay": {
                  "days": 0,
                  "hours": 0,
                  "weeks": 0,
                  "minutes": 2,
                  "seconds": 0
                }
              },
              "status": null,
              "left": "512",
              "top": "1766",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dbf",
              "uuid": "558b7e68-c9d0-4fdc-ab33-64620c71d638"
            },
            {
              "@type": "WorkflowStep",
              "name": "Wait for Emails",
              "description": null,
              "arguments": {
                "delay": {
                  "days": 0,
                  "hours": 0,
                  "weeks": 0,
                  "minutes": 3,
                  "seconds": 0
                }
              },
              "status": null,
              "left": "192",
              "top": "1760",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dbf",
              "uuid": "386308c6-293a-4aeb-a1a5-d4bcbc736389"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find IP Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.ip_indicators | length > 0}}",
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.item}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "indicators?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Find IP Indicators</span></p>\n\n<p>Host indicators from the reported email are being processed.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.ip_indicators}}",
                  "condition": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "1420",
              "top": "1340",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "3456e02f-c591-4045-90eb-b5c2b6f7475c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Host Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.host_indicators | length > 0}}",
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.item}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "indicators?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Find Host Indicators</span></p>\n\n<p>Host indicators from the reported email are being processed.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.host_indicators}}",
                  "condition": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "512",
              "top": "1346",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "2a18748b-b7cb-4a0c-a2d3-4c16e6f926e9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find URL Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.url_indicators | length > 0}}",
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.item}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "indicators?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Find URL Indicators</span></p>\n\n<p>Host indicators from the reported email are being processed.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.url_indicators}}",
                  "condition": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "1100",
              "top": "1340",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "d0f71217-6f2b-4749-9259-9097111c33d7"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Email Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.email_indicators | length > 0}}",
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.item}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "indicators?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Find Email Indicators</span></p>\n\n<p>Email indicators from the reported email are being processed.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.email_indicators}}",
                  "condition": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "192",
              "top": "1346",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "ddd4602e-6d85-4b4f-9a86-884c17afe188"
            },
            {
              "@type": "WorkflowStep",
              "name": "Process IP Indicators",
              "description": null,
              "arguments": {
                "found_ip_indicators_iris": "{{vars.find_ip_indicators|json_query('[].[\"@id\"]') | flatten(levels=1)}}",
                "found_ip_indicators_values": "{{vars.find_ip_indicators|json_query(\"[].value\")| flatten(levels=1)}}"
              },
              "status": null,
              "left": "1420",
              "top": "1551",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "df6279b4-679e-470f-9bf2-f7965af23db4"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link IP Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.found_ip_indicators_iris|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link IP Indicators to Alert</span></p>\n\n<p>All of the created IP indicators have been linked to this alert.</p>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "indicators": "{{vars.found_ip_indicators_iris}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1420",
              "top": "1980",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "fa3cfc5f-73d6-4ad1-a91d-d45ad343dd62"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set IP Lists",
              "description": null,
              "arguments": {
                "ip_indicators_to_link": "{{vars.ip_indicators | intersect(vars.found_ip_indicators_values)}}",
                "ip_indicators_to_create": "{{vars.ip_indicators | difference(vars.found_ip_indicators_values)}}"
              },
              "status": null,
              "left": "1420",
              "top": "1650",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "158e0633-2b7c-4f44-8097-e8d7b1529fca"
            },
            {
              "@type": "WorkflowStep",
              "name": "Flatten IP lists",
              "description": null,
              "arguments": {
                "find_ip_indicators": "{{vars.steps.Find_IP_Indicators | flatten(levels=1)}}"
              },
              "status": null,
              "left": "1420",
              "top": "1440",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "46d1a7be-6398-4846-8242-52b95664b8d4"
            },
            {
              "@type": "WorkflowStep",
              "name": "Flatten URL lists",
              "description": null,
              "arguments": {
                "find_url_indicators": "{{vars.steps.Find_URL_Indicators | flatten(levels=1)}}"
              },
              "status": null,
              "left": "1100",
              "top": "1440",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "4caf38cb-5815-4ab3-a278-46691a6b3e57"
            },
            {
              "@type": "WorkflowStep",
              "name": "Process URL Indicators",
              "description": null,
              "arguments": {
                "found_url_indicators_iris": "{{vars.find_url_indicators|json_query('[].[\"@id\"]') | flatten(levels=1)}}",
                "found_url_indicators_values": "{{vars.find_url_indicators|json_query(\"[].value\")| flatten(levels=1)}}"
              },
              "status": null,
              "left": "1100",
              "top": "1550",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "5cd03b10-f265-47be-88dc-79eaba37b97c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set URL Lists",
              "description": null,
              "arguments": {
                "url_indicators_to_link": "{{vars.url_indicators | intersect(vars.found_url_indicators_values)}}",
                "url_indicators_to_create": "{{vars.url_indicators | difference(vars.found_url_indicators_values)}}"
              },
              "status": null,
              "left": "1100",
              "top": "1650",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "459e11e8-4cbb-4032-a139-9e2a8d5e9c5f"
            },
            {
              "@type": "WorkflowStep",
              "name": "Flatten Host lists",
              "description": null,
              "arguments": {
                "find_host_indicators": "{{vars.steps.Find_Host_Indicators | flatten(levels=1)}}"
              },
              "status": null,
              "left": "512",
              "top": "1446",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "d409b29f-fd68-4abf-8c2f-16c65ed21f56"
            },
            {
              "@type": "WorkflowStep",
              "name": "Process Host Indicators",
              "description": null,
              "arguments": {
                "found_host_indicators_iris": "{{vars.find_host_indicators|json_query('[].[\"@id\"]') | flatten(levels=1)}}",
                "found_host_indicators_values": "{{vars.find_host_indicators|json_query(\"[].value\")| flatten(levels=1)}}"
              },
              "status": null,
              "left": "512",
              "top": "1552",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "0f18d397-47a9-4265-a666-9ba1fa1639b9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Host Lists",
              "description": null,
              "arguments": {
                "host_indicators_to_link": "{{vars.host_indicators | intersect(vars.found_host_indicators_values)}}",
                "host_indicators_to_create": "{{vars.host_indicators | difference(vars.found_host_indicators_values)}}"
              },
              "status": null,
              "left": "512",
              "top": "1653",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "b3c3fbc2-7ff3-44bb-8c51-bdffb049f49c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Flatten Email lists",
              "description": null,
              "arguments": {
                "find_email_indicators": "{{vars.steps.Find_Email_Indicators | flatten(levels=1)}}"
              },
              "status": null,
              "left": "192",
              "top": "1446",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "523b9fca-b3dc-4d0f-b633-567edc6f4c9f"
            },
            {
              "@type": "WorkflowStep",
              "name": "Process Email Indicators",
              "description": null,
              "arguments": {
                "found_email_indicators_iris": "{{vars.find_email_indicators|json_query('[].[\"@id\"]') | flatten(levels=1)}}",
                "found_email_indicators_values": "{{vars.find_email_indicators|json_query(\"[].value\")| flatten(levels=1)}}"
              },
              "status": null,
              "left": "192",
              "top": "1553",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "54ef374b-6045-4564-b454-af752372aa03"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Email Lists",
              "description": null,
              "arguments": {
                "email_indicators_to_link": "{{vars.email_indicators | intersect(vars.found_email_indicators_values)}}",
                "email_indicators_to_create": "{{vars.email_indicators | difference(vars.found_email_indicators_values)}}"
              },
              "status": null,
              "left": "192",
              "top": "1653",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "377531ea-08a4-4ded-83f4-93260191d44a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create URL Indicator",
              "description": null,
              "arguments": {
                "when": "{{vars.url_indicators_to_create|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating URL Indicator</span></p>\n\n<p>URL indicators are being created for each URL indicator found in the email.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.url_indicators_to_create}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "value": "{{vars.item}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "sources": "Email",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 80,
                    "@id": "/api/3/picklists/353a37b4-3eeb-43ee-aac6-64806422cfec",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "URL",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "URL",
                    "orderIndex": 10
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1100",
              "top": "1870",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "3b1f02f2-31e3-4b20-8e90-97d5ebfa7480"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link URL Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.found_url_indicators_iris|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link URL Indicators to Alert</span></p>\n\n<p>All of the created URL indicators have been linked to this alert.</p>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "indicators": "{{vars.found_url_indicators_iris}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1100",
              "top": "1980",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "1c24b65b-b620-4d80-b723-d4674f6f6340"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Host Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.found_host_indicators_iris|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link Host Indicators to Alert</span></p>\n\n<p>All of the created host indicators have been linked to this alert.</p>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "indicators": "{{vars.found_host_indicators_iris}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "512",
              "top": "1986",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "49180d03-0241-40c2-b65c-ad9ac01b64b8"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Host Indicator",
              "description": null,
              "arguments": {
                "when": "{{vars.host_indicators_to_create|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating Host Indicator</span></p>\n\n<p>Host indicators are being created for each host indicator found in the email.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.host_indicators_to_create}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "value": "{{vars.item}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "sources": "Email",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 80,
                    "@id": "/api/3/picklists/353a37b4-3eeb-43ee-aac6-64806422cfec",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "URL",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "URL",
                    "orderIndex": 10
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "512",
              "top": "1873",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "111584ab-fb6e-456e-a750-4c9676fd2d43"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Email Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.found_email_indicators_iris|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link Email Indicators to Alert</span></p>\n\n<p>All of the created email indicators have been linked to this alert.</p>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "indicators": "{{vars.found_email_indicators_iris}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "192",
              "top": "1986",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "3e92f3ca-a616-4bda-af3e-43676bef8b08"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Email Indicator",
              "description": null,
              "arguments": {
                "when": "{{vars.email_indicators_to_create|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating Email Indicator</span></p>\n\n<p>Email indicators are being created for each email indicator found in the email.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.email_indicators_to_create}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "value": "{{vars.item}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "sources": "Email",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 71,
                    "@id": "/api/3/picklists/80bd55b0-6d88-4beb-bec3-97954f261c4d",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Email Address",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "Email Address",
                    "orderIndex": 1
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "192",
              "top": "1873",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "84a8b52d-dda9-46cb-b883-493ab746acad"
            },
            {
              "@type": "WorkflowStep",
              "name": "Indicators Malicious",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/6f760315-9a30-448b-870a-43fa7241a0c8"
                  }
                ]
              },
              "status": null,
              "left": "806",
              "top": "2407",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "97552f5c-49b0-43d4-b2f8-5bf1eb7d96d3"
            },
            {
              "@type": "WorkflowStep",
              "name": "False positive Alert",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Automatic Alert Closure</span></p>\n\n<p> No malicious indicators were found in the reported email. Due to this the alert was closed <span style=\"background-color:#1E6E23;color:#FFF;font-weight:bold\">[ Automatically ]</span> and no further action is required.",
                  "records": ""
                },
                "resource": {
                  "type": {
                    "id": 121,
                    "@id": "/api/3/picklists/0b3ef6f9-eb29-4ab9-ac98-98364bd1a3aa",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Phishing",
                    "listName": "/api/3/picklist_names/a7087b9c-5660-495f-a8ac-c3b198ddb8c2",
                    "itemValue": "Phishing",
                    "orderIndex": 9
                  },
                  "state": {
                    "id": 221,
                    "@id": "/api/3/picklists/2879663c-c1dc-4ef2-84ae-8c67c9353b86",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Detail Extracted",
                    "listName": "/api/3/picklist_names/2f9ed741-25fe-475a-9f12-64336288eebf",
                    "itemValue": "Detail Extracted",
                    "orderIndex": 1
                  },
                  "status": {
                    "id": 246,
                    "@id": "/api/3/picklists/fac53e73-8d16-4189-98d5-95fbd1555232",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Closed",
                    "listName": "/api/3/picklist_names/33e964a9-d607-49f2-813c-7ce46141815a",
                    "itemValue": "Closed",
                    "orderIndex": 4
                  },
                  "ackDate": "{{globalVars.Current_Date}}",
                  "respDate": "{{globalVars.Current_Date}}",
                  "severity": {
                    "id": 12,
                    "@id": "/api/3/picklists/0d609b08-45e0-469f-8910-41145c0b7c03",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#157DD9",
                    "display": "Minimal",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "Minimal",
                    "orderIndex": 0
                  },
                  "ackSlaStatus": "{% if globalVars.Current_Date <= vars.steps.Update_Alert.dueBy %}{{\"SLAState\" | picklist(\"Met\", \"@id\")}}{% else %}{{\"SLAState\" | picklist(\"Missed\", \"@id\")}}{% endif %}",
                  "closureNotes": "<p>No malicious indicators were found in the email. Due to this the alert was <span style=\"background-color:#1E6E23;color:#FFF;font-weight:bold\">[ Automatically ]</span> closed.</p>",
                  "resolveddate": "{{globalVars.Current_Date}}",
                  "closureReason": {
                    "id": 250,
                    "@id": "/api/3/picklists/2b0112f6-4746-4dab-ada6-a8cd1e675572",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "False Positive",
                    "listName": "/api/3/picklist_names/4ebacea1-88cd-4ea8-9dcc-385bea42cc59",
                    "itemValue": "False Positive",
                    "orderIndex": 2
                  },
                  "respSlaStatus": "{% if globalVars.Current_Date <= vars.steps.Update_Alert.respDueDate %}{{\"SLAState\" | picklist(\"Met\", \"@id\")}}{% else %}{{\"SLAState\" | picklist(\"Missed\", \"@id\")}}{% endif %}",
                  "escalatedtoincident": {
                    "id": 31,
                    "@id": "/api/3/picklists/2128a09c-153d-4db3-985d-de6be33deae5",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#808080",
                    "display": "No",
                    "listName": "/api/3/picklist_names/e131cc54-9ae4-43c9-b830-af6e331fe024",
                    "itemValue": "No",
                    "orderIndex": 1
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "467",
              "top": "2407",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "6f760315-9a30-448b-870a-43fa7241a0c8"
            },
            {
              "@type": "WorkflowStep",
              "name": "Wait for indicators Reputation",
              "description": null,
              "arguments": {
                "delay": {
                  "days": 0,
                  "hours": 0,
                  "weeks": 0,
                  "minutes": 2,
                  "seconds": 0
                }
              },
              "status": null,
              "left": "806",
              "top": "2090",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dbf",
              "uuid": "47641211-2fca-42c1-89e3-cb3552098414"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Indicators",
              "description": null,
              "arguments": {
                "indicators_reputation_iri": "{{ (((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).indicators)|json_query(\"[].reputation\") }}"
              },
              "status": null,
              "left": "806",
              "top": "2191",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "c075c665-da60-4a1c-9d11-9ff6405432ca"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Indicators Reputation",
              "description": null,
              "arguments": {
                "indicator_reputation": "{%for iri in vars.indicators_reputation_iri%}{{(iri|fromIRI).itemValue}}{%endfor%}"
              },
              "status": null,
              "left": "806",
              "top": "2292",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "55b78e97-ba5c-4300-b362-90ae3f4290b1"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "da059413-9186-418a-b584-cea357df9282",
              "name": "Prepare File Attachments -> Record File Attachment",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/98e04148-7f0f-4854-a8ea-b8681b8c9031",
              "sourceStep": "/api/3/workflow_steps/84035319-8283-4e5c-8397-3ea7afde17a3"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "ce39fbc6-90bf-428c-83a7-df8b173d0d8b",
              "name": "Upload File IOCs -> Create Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/378afb83-a1a0-4b91-931d-0dd81597a6c2",
              "sourceStep": "/api/3/workflow_steps/df3d18a9-6a5f-4d2d-b222-51dd636fb542"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "2e2b4797-fde7-48e3-a51f-4ba72973f6d0",
              "name": "Record File Attachment -> Upload File IOCs",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/df3d18a9-6a5f-4d2d-b222-51dd636fb542",
              "sourceStep": "/api/3/workflow_steps/98e04148-7f0f-4854-a8ea-b8681b8c9031"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "6b00a741-e99a-43e4-9050-c58dc075a089",
              "name": "Create Attached Email -> Parse Attached Email Attributes",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/369cb001-e046-45b3-adec-23c575b7b04e",
              "sourceStep": "/api/3/workflow_steps/3de73b79-5eae-421d-b66e-7d5f8b670f84"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "82da5545-850e-448f-9a15-fe27ef384dd0",
              "name": "Parse Attached Email Attributes -> Prepare File Attachments",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/84035319-8283-4e5c-8397-3ea7afde17a3",
              "sourceStep": "/api/3/workflow_steps/369cb001-e046-45b3-adec-23c575b7b04e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "3653d76c-bd89-4862-b50e-4f143d1d3fe9",
              "name": "Create Inline Email -> Parse Inline Email Attributes",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/cbba9a1e-a86e-4604-9ccb-b794eab34765",
              "sourceStep": "/api/3/workflow_steps/e6ea937f-3631-4bea-af54-12ad18e01a4b"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "1c5e9bf3-f324-4363-99ef-105cb54d20e4",
              "name": "Parse Inline Email Attributes -> Prepare File Attachments",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/84035319-8283-4e5c-8397-3ea7afde17a3",
              "sourceStep": "/api/3/workflow_steps/cbba9a1e-a86e-4604-9ccb-b794eab34765"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "59b0d694-d0a8-4218-8341-a46d650f04c6",
              "name": "Create File Indicators -> Extract Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/547be055-ba84-425c-be08-d556f72c9476",
              "sourceStep": "/api/3/workflow_steps/378afb83-a1a0-4b91-931d-0dd81597a6c2"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "380837b7-a16b-4da0-b40d-97edd43c3c27",
              "name": "Extract Indicators -> Copy  of Whitelist local attributes",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c33f7810-72fc-414c-a648-250ff8caf83f",
              "sourceStep": "/api/3/workflow_steps/547be055-ba84-425c-be08-d556f72c9476"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "54550e60-bd3d-4098-a599-874a3968cecf",
              "name": "Update Alert -> Original Email Attached",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/2539b9b2-c601-4f27-af31-c5025726f30e",
              "sourceStep": "/api/3/workflow_steps/cbe554c0-f2f0-4a0b-8bad-c46dc56a9204"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f9644af8-02e6-4936-8e90-e4e905b5f85d",
              "name": "Original Email Attached -> Create Inline Email",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e6ea937f-3631-4bea-af54-12ad18e01a4b",
              "sourceStep": "/api/3/workflow_steps/2539b9b2-c601-4f27-af31-c5025726f30e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "64e44e86-24b1-4b49-93be-8fc52f3f0014",
              "name": "Original Email Attached -> Copy  of Create Inline Email",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3de73b79-5eae-421d-b66e-7d5f8b670f84",
              "sourceStep": "/api/3/workflow_steps/2539b9b2-c601-4f27-af31-c5025726f30e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0c6d1257-aba4-4a16-ab35-84b7fb57b771",
              "name": "Start -> Set Source Data",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/5357ee19-6a76-4276-af2f-4197a502f1b2",
              "sourceStep": "/api/3/workflow_steps/91a88390-1228-4313-8646-cfa01da0285a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "6be525bc-beb0-4392-8682-3e6d78d284c3",
              "name": "Whitelist local attributes -> Find IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3456e02f-c591-4045-90eb-b5c2b6f7475c",
              "sourceStep": "/api/3/workflow_steps/c33f7810-72fc-414c-a648-250ff8caf83f"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d126ecc7-6567-4bb7-8e17-00f7c4f1fea2",
              "name": "Whitelist local attributes -> Find URL Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d0f71217-6f2b-4749-9259-9097111c33d7",
              "sourceStep": "/api/3/workflow_steps/c33f7810-72fc-414c-a648-250ff8caf83f"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "2b5a3340-5ae0-44cf-abf5-4519a528ee84",
              "name": "Whitelist local attributes -> Find Host Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/2a18748b-b7cb-4a0c-a2d3-4c16e6f926e9",
              "sourceStep": "/api/3/workflow_steps/c33f7810-72fc-414c-a648-250ff8caf83f"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "3b173100-d131-4e6d-a9db-aaf82927e801",
              "name": "Whitelist local attributes -> Find Email Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ddd4602e-6d85-4b4f-9a86-884c17afe188",
              "sourceStep": "/api/3/workflow_steps/c33f7810-72fc-414c-a648-250ff8caf83f"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "9ee0e9b6-a501-4464-8320-9cf08bfe6bd1",
              "name": "Create IP Indicator -> Link Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fa3cfc5f-73d6-4ad1-a91d-d45ad343dd62",
              "sourceStep": "/api/3/workflow_steps/69b62a04-451a-4519-ab37-37eb84b095b0"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f4cc965b-b93c-4dd7-bb8f-c6119711ec0d",
              "name": "Process IP Indicators -> Set IP Lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/158e0633-2b7c-4f44-8097-e8d7b1529fca",
              "sourceStep": "/api/3/workflow_steps/df6279b4-679e-470f-9bf2-f7965af23db4"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "4204ae3d-3626-4c2b-8e1f-ebb190c55652",
              "name": "Set IP Lists -> Create IP Indicator",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/69b62a04-451a-4519-ab37-37eb84b095b0",
              "sourceStep": "/api/3/workflow_steps/158e0633-2b7c-4f44-8097-e8d7b1529fca"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "1d315b6d-ce22-4d58-9b77-24983a37cd5d",
              "name": "Find IP Indicators -> Flatten IP lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/46d1a7be-6398-4846-8242-52b95664b8d4",
              "sourceStep": "/api/3/workflow_steps/3456e02f-c591-4045-90eb-b5c2b6f7475c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "7dd8b4fa-682e-4393-a2a9-d5f807c556ef",
              "name": "Flatten IP lists -> Process IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/df6279b4-679e-470f-9bf2-f7965af23db4",
              "sourceStep": "/api/3/workflow_steps/46d1a7be-6398-4846-8242-52b95664b8d4"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "431795b5-87da-4a19-827b-930d232f1285",
              "name": "Find URL Indicators -> Copy  of Flatten IP lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/4caf38cb-5815-4ab3-a278-46691a6b3e57",
              "sourceStep": "/api/3/workflow_steps/d0f71217-6f2b-4749-9259-9097111c33d7"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b5f17b52-b523-4d0d-b316-6c0616348100",
              "name": "Find Host Indicators -> Copy  of Copy  of Flatten IP lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d409b29f-fd68-4abf-8c2f-16c65ed21f56",
              "sourceStep": "/api/3/workflow_steps/2a18748b-b7cb-4a0c-a2d3-4c16e6f926e9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "2a5ca913-1598-4e19-bdd2-5d7578c50cd0",
              "name": "Find Email Indicators -> Copy 1 of Copy  of Flatten IP lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/523b9fca-b3dc-4d0f-b633-567edc6f4c9f",
              "sourceStep": "/api/3/workflow_steps/ddd4602e-6d85-4b4f-9a86-884c17afe188"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "7c313c1b-ccbc-48ad-82ac-cd97e809e1ce",
              "name": "Flatten URL lists -> Copy 1 of Process IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/5cd03b10-f265-47be-88dc-79eaba37b97c",
              "sourceStep": "/api/3/workflow_steps/4caf38cb-5815-4ab3-a278-46691a6b3e57"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "40158bf9-7b75-4a89-bc65-75ee157b02ec",
              "name": "Flatten Host lists -> Copy  of Copy 1 of Process IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/0f18d397-47a9-4265-a666-9ba1fa1639b9",
              "sourceStep": "/api/3/workflow_steps/d409b29f-fd68-4abf-8c2f-16c65ed21f56"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "1fbf958d-8d03-45a7-816e-072abe3b2452",
              "name": "Flatten Email lists -> Copy 1 of Copy 1 of Process IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/54ef374b-6045-4564-b454-af752372aa03",
              "sourceStep": "/api/3/workflow_steps/523b9fca-b3dc-4d0f-b633-567edc6f4c9f"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "105783f0-1c09-412c-9952-049199bbf268",
              "name": "Copy 1 of Process IP Indicators -> Copy  of Set IP Lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/459e11e8-4cbb-4032-a139-9e2a8d5e9c5f",
              "sourceStep": "/api/3/workflow_steps/5cd03b10-f265-47be-88dc-79eaba37b97c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "930a7271-3829-4d85-b727-ad0f926630c3",
              "name": "Copy  of Copy 1 of Process IP Indicators -> Copy  of Copy  of Set IP Lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/b3c3fbc2-7ff3-44bb-8c51-bdffb049f49c",
              "sourceStep": "/api/3/workflow_steps/0f18d397-47a9-4265-a666-9ba1fa1639b9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "33fe70d5-2e55-4381-a969-8bc1a69fe893",
              "name": "Copy 1 of Copy 1 of Process IP Indicators -> Copy 1 of Copy  of Set IP Lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/377531ea-08a4-4ded-83f4-93260191d44a",
              "sourceStep": "/api/3/workflow_steps/54ef374b-6045-4564-b454-af752372aa03"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "9bc1219c-6142-4a3f-ba88-e29e3a7604bc",
              "name": "Set URL Lists -> Wait for URLs",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d8883237-5b4c-4ba9-9a87-d413d5ea72d1",
              "sourceStep": "/api/3/workflow_steps/459e11e8-4cbb-4032-a139-9e2a8d5e9c5f"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "3a90cb3f-513c-42aa-9076-62bd76393fac",
              "name": "Set Host Lists -> Wait for Hosts",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/558b7e68-c9d0-4fdc-ab33-64620c71d638",
              "sourceStep": "/api/3/workflow_steps/b3c3fbc2-7ff3-44bb-8c51-bdffb049f49c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "01608a11-9cfe-49f3-9c74-128cdd20ea11",
              "name": "Set Email Lists -> Wait for Emails",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/386308c6-293a-4aeb-a1a5-d4bcbc736389",
              "sourceStep": "/api/3/workflow_steps/377531ea-08a4-4ded-83f4-93260191d44a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c0ae43fd-6b31-4359-933d-cd6d276581a0",
              "name": "Wait for URLs -> Create URL Indicator",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3b1f02f2-31e3-4b20-8e90-97d5ebfa7480",
              "sourceStep": "/api/3/workflow_steps/d8883237-5b4c-4ba9-9a87-d413d5ea72d1"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5c9cebe3-a644-4410-bf9f-5b2c72119485",
              "name": "Create URL Indicator -> Link URL Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/1c24b65b-b620-4d80-b723-d4674f6f6340",
              "sourceStep": "/api/3/workflow_steps/3b1f02f2-31e3-4b20-8e90-97d5ebfa7480"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "40709989-df72-437c-b077-3a6da08ea841",
              "name": "Wait for Hosts -> Copy  of Copy  of Create IP Indicator",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/111584ab-fb6e-456e-a750-4c9676fd2d43",
              "sourceStep": "/api/3/workflow_steps/558b7e68-c9d0-4fdc-ab33-64620c71d638"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f600c957-0cd5-4390-9ea1-a34824e3c74a",
              "name": "Copy  of Copy  of Create IP Indicator -> Copy  of Copy  of Link Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/49180d03-0241-40c2-b65c-ad9ac01b64b8",
              "sourceStep": "/api/3/workflow_steps/111584ab-fb6e-456e-a750-4c9676fd2d43"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "8c55b8c4-1d7f-4300-af5a-54dc53c6a3f6",
              "name": "Wait for Emails -> Copy 1 of Create IP Indicator",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/84a8b52d-dda9-46cb-b883-493ab746acad",
              "sourceStep": "/api/3/workflow_steps/386308c6-293a-4aeb-a1a5-d4bcbc736389"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e5e6fd59-d72b-4c43-9a69-11d75b0417ba",
              "name": "Copy 1 of Create IP Indicator -> Copy 1 of Link Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3e92f3ca-a616-4bda-af3e-43676bef8b08",
              "sourceStep": "/api/3/workflow_steps/84a8b52d-dda9-46cb-b883-493ab746acad"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "9784bf26-7648-46a7-8247-2420a17c29d7",
              "name": "Local Attributes -> Send Auto_Reply to Sender",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/4faf14c1-3233-4e5c-8c74-2afb476a6784",
              "sourceStep": "/api/3/workflow_steps/5357ee19-6a76-4276-af2f-4197a502f1b2"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "8e4089b0-dd63-4e88-a145-dcc832970ed9",
              "name": "Send Auto_Reply to Sender -> Update Alert",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/cbe554c0-f2f0-4a0b-8bad-c46dc56a9204",
              "sourceStep": "/api/3/workflow_steps/4faf14c1-3233-4e5c-8c74-2afb476a6784"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "9d90858f-5ae2-48f4-bf17-b67bc59c8311",
              "name": "Link Host Indicators -> Wait for indicators Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/47641211-2fca-42c1-89e3-cb3552098414",
              "sourceStep": "/api/3/workflow_steps/49180d03-0241-40c2-b65c-ad9ac01b64b8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5a10099b-d7cf-4266-9f2b-6932026aab55",
              "name": "Link Email Indicators -> Wait for indicators Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/47641211-2fca-42c1-89e3-cb3552098414",
              "sourceStep": "/api/3/workflow_steps/3e92f3ca-a616-4bda-af3e-43676bef8b08"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "8febebaf-7ada-41c7-b63a-ec53b2bf2d4d",
              "name": "Link URL Indicators -> Wait for indicators Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/47641211-2fca-42c1-89e3-cb3552098414",
              "sourceStep": "/api/3/workflow_steps/1c24b65b-b620-4d80-b723-d4674f6f6340"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c47aab7c-97bd-40fd-9afd-ad4cc2dc9ad0",
              "name": "Link IP Indicators -> Wait for indicators Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/47641211-2fca-42c1-89e3-cb3552098414",
              "sourceStep": "/api/3/workflow_steps/fa3cfc5f-73d6-4ad1-a91d-d45ad343dd62"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "3bd7e901-e975-4225-8baf-0ba2f863137b",
              "name": "Wait for indicators Reputation -> Get Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c075c665-da60-4a1c-9d11-9ff6405432ca",
              "sourceStep": "/api/3/workflow_steps/47641211-2fca-42c1-89e3-cb3552098414"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d17000b0-7db1-4a74-8a0f-242187f4e516",
              "name": "Get Indicators -> Get Indicators Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/55b78e97-ba5c-4300-b362-90ae3f4290b1",
              "sourceStep": "/api/3/workflow_steps/c075c665-da60-4a1c-9d11-9ff6405432ca"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c978d452-e049-4cb4-827a-1ec71588bd78",
              "name": "Get Indicators Reputation -> Indicators Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/97552f5c-49b0-43d4-b2f8-5bf1eb7d96d3",
              "sourceStep": "/api/3/workflow_steps/55b78e97-ba5c-4300-b362-90ae3f4290b1"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "7600f284-4640-44df-89c7-86de27ab8a95",
              "name": "Indicators Malicious -> False positive Alert",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/6f760315-9a30-448b-870a-43fa7241a0c8",
              "sourceStep": "/api/3/workflow_steps/97552f5c-49b0-43d4-b2f8-5bf1eb7d96d3"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f1f3868e-42ec-4601-b6df-9c5c1091bdd5",
              "name": "Indicators Malicious -> Review Blocked Emails",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c1dea043-f67f-4c90-af10-11abdd1c8c54",
              "sourceStep": "/api/3/workflow_steps/97552f5c-49b0-43d4-b2f8-5bf1eb7d96d3"
            }
          ],
          "versions": null,
          "lastModifyDate": 1596550759,
          "uuid": "95d37d35-f26b-481c-b66a-085287a3608a",
          "recordTags": [],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "00 - FSM-Mapper",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/4afec611-32a5-4368-a338-4c7336d4c670",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/63f5ab72-66d2-49a3-9aa0-b99c19349633",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "alerts",
                "resources": [
                  "alerts"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "OR",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "source",
                      "value": "%FSMSIM-FDLA%",
                      "operator": "like",
                      "_operator": "like"
                    },
                    {
                      "type": "primitive",
                      "field": "source",
                      "value": "%FortiSIEM%",
                      "operator": "like",
                      "_operator": "like"
                    }
                  ]
                }
              },
              "status": null,
              "left": "20",
              "top": "20",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "63f5ab72-66d2-49a3-9aa0-b99c19349633"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Source Data",
              "description": null,
              "arguments": {
                "source_data": "{{vars.input.records[0].sourcedata}}",
                "eventSeverity": "{%if (vars.input.records[0].sourcedata|type_debug) == \"str\"%}{{(vars.input.records[0].sourcedata|toDict).attributes.eventSeverity|int}}{%else%}{{vars.input.records[0].sourcedata.incident_data.attributes.eventSeverity|int}}{%endif%}",
                "incident_data": "{%if vars.input.records[0].sourcedata|type_debug == \"dict\"%}{{vars.input.records[0].sourcedata.incident_data}}{%else%}{{vars.input.records[0].sourcedata}}{%endif%}",
                "associated_events": "{%if vars.input.records[0].sourcedata|type_debug == \"dict\"%}{{vars.input.records[0].sourcedata.associated_events}}{%endif%}"
              },
              "status": null,
              "left": "314",
              "top": "20",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "be356e70-fd58-433d-9b90-4b63cb516bb8"
            },
            {
              "@type": "WorkflowStep",
              "name": "Fields Mapping",
              "description": null,
              "arguments": {
                "v_URL": "",
                "v_Email": "",
                "v_Domain": "",
                "v_Metrics": "",
                "v_Service": "",
                "v_Ack_Date": "",
                "v_Reporter": "{%if vars.incident_data.attributes.incidentRptDevName%}{{vars.incident_data.attributes.incidentRptDevName}}{% elif vars.incident_data.attributes.reptDevIpAddr %}{{vars.incident_data.attributes.reptDevIpAddr}}{%endif%}",
                "v_Type_Map": "{\n'PH_RULE_Availability_Application': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Database': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Domain Controller': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Environmental': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_FortiSIEM': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_HVAC': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Hardware': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_License': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Mail': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Network': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_SDN': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Server': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Storage': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Suspicious Activity': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_UPS': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Video Conferencing': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_VoIP': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_WAN': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_Availability_Windows': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_CHANGE_Audit': {{\"AlertType\" | picklist(\"Compliance\")}},\n'PH_RULE_CHANGE_Policy Violation': {{\"AlertType\" | picklist(\"Policy Violation\")}},\n'PH_RULE_CHANGE_UserAccount': {{\"AlertType\" | picklist(\"Compliance\")}},\n'PH_RULE_Other_VoIP': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_Application': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_CPU': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_Database': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_FortiSIEM': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_IPSLA': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_Interface': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_Mail': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_Memory': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_Network': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_SDN': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_Server': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_Storage': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_Suspicious': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_Virtualization': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_PERFORMANCE_VoIP': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_Airline': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_Application': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_Audit': {{\"AlertType\" | picklist(\"Compliance\")}},\n'PH_RULE_SECURITY_Authentication': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_Behavioral': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_BotNet': {{\"AlertType\" | picklist(\"Malware\")}},\n'PH_RULE_SECURITY_COLLECTION': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_COMMAND': {{\"AlertType\" | picklist(\"Beaconing\")}},\n'PH_RULE_SECURITY_CRED': {{\"AlertType\" | picklist(\"Lost / Stolen\")}},\n'PH_RULE_SECURITY_DEFENSE': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_DISCOVERY': {{\"AlertType\" | picklist(\"Reconnaissance\")}},\n'PH_RULE_SECURITY_EXECUTION': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_EXFILTRATION': {{\"AlertType\" | picklist(\"Data Exfiltration\")}},\n'PH_RULE_SECURITY_IMPACT': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_INIT': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_LATERAL': {{\"AlertType\" | picklist(\"Lateral Movement\")}},\n'PH_RULE_SECURITY_Malware': {{\"AlertType\" | picklist(\"Malware\")}},\n'PH_RULE_SECURITY_Network': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_PERSISTENCE': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_Policy': {{\"AlertType\" | picklist(\"Policy Violation\")}},\n'PH_RULE_SECURITY_PRIV': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_Suspicious': {{\"AlertType\" | picklist(\"Other / Unknown\")}},\n'PH_RULE_SECURITY_COMMAND_AND_CONTROL':{{\"AlertType\" | picklist(\"Command and Control\")}},\n'PH_RULE_Availability_FortiSIEM':{{\"AlertType\" | picklist(\"Denial of Service\")}},\n'PH_RULE_SECURITY_INIT_ACCESS': {{\"AlertType\" | picklist(\"Lateral Movement\")}}\n}",
                "v_Username": "{{vars.incident_data.attributes.user}}",
                "v_severity": "{%if 0 <= vars.eventSeverity <= 1%}{{\"Severity\" | picklist(\"Minimal\", \"@id\")}}{%elif 2 <= vars.eventSeverity <= 3%}{{\"Severity\" | picklist(\"Low\", \"@id\")}}{%elif 4 <= vars.eventSeverity <= 6%}{{\"Severity\" | picklist(\"Medium\", \"@id\")}}{%elif 7 <= vars.eventSeverity <= 8%}{{\"Severity\" | picklist(\"High\", \"@id\")}}{%elif 9 <= vars.eventSeverity <= 10%}{{\"Severity\" | picklist(\"High\", \"@id\")}}{%endif%}",
                "v_File_Hash": "",
                "v_File_Name": "{{vars.associated_events.0.attributes.fileName}}",
                "v_File_Path": "",
                "v_Source_ID": "{{vars.incident_data.nid}}",
                "v_Source_IP": "{{vars.associated_events.0.attributes.srcIpAddr}}",
                "v_eventName": "{{vars.associated_events.0.attributes.eventName}}",
                "v_Device_UID": "",
                "v_Email_Body": "",
                "v_Email_From": "",
                "v_Epoch_Time": "",
                "v_Event_Time": "{{vars.incident_data.attributes.phRecvTime}}",
                "v_File_Names": "",
                "v_Process_ID": "",
                "v_Description": "{{vars.incident_data.attributes.incidentTitle}}",
                "v_Return_Path": "",
                "v_Source_Port": "",
                "v_Source_Tool": "",
                "v_Source_Type": "{{vars.incident_data.attributes.eventType}}",
                "v_incidentSrc": "",
                "v_subcategory": "{{vars.incident_data.attributes.phSubIncidentCategory}}",
                "v_Command_Line": "",
                "v_Latest_Login": "",
                "v_Process_GUID": "",
                "v_Process_Name": "",
                "v_Process_Tree": "",
                "v_Registry_Key": "",
                "v_Response_SLA": "",
                "v_Target_Asset": "",
                "v_dlp_dlpextra": "",
                "v_Computer_Name": "{{vars.origDevName}}",
                "v_Email_Headers": "",
                "v_Email_Subject": "",
                "v_Sender_Domain": "",
                "v_Type_Picklist": "User Group Changed\nDomain User Created\nFirewall Configuration Change\nScheduled Task Created\nPassword Reset\nS3 Policy Change\nPhishing\nMalware\nDenial of Service\nLost / Stolen\nBrute Force Attempts\nCommand and Control\nPolicy Violation\nData Leakage\nCompliance\nOther / Unknown\nMITRE ATT&CK\nBeaconing\nRansomware\nData Exfiltration\nImproper disposal\nSuspicious Email\nLateral Movement\nReconnaissance",
                "v_Destination_IP": "{{vars.associated_events.0.attributes.destIpAddr}}",
                "v_Scheduled_Task": "",
                "v_Source_Process": "",
                "v_Target_Process": "",
                "v_alert_severity": "{{vars.incident_data.attributes.eventSeverityCat}}",
                "v_dlp_filtername": "",
                "v_dlp_filtertype": "",
                "v_incidentTarget": "{{vars.incident_data.attributes. incidentTarget}}",
                "v_Attachment_Names": "",
                "v_Destination_Port": "{{vars.associated_events.0.attributes.destIpPort}}",
                "v_HR_Email_Address": "hr@fortielab.com",
                "v_incidentComments": "{{vars.incident_data.attributes.incidentComments}}",
                "v_Bytes_Transferred": "",
                "v_Escalation_Reason": "",
                "v_FSR_Email_Address": "fsr@fortielab.com",
                "v_Parent_Process_ID": "",
                "v_incidentFirstSeen": "{{vars.incident_data.attributes.incidentFirstSeen}}",
                "v_Registry_Key_Value": "",
                "v_Email_Recipients_To": "",
                "v_Parent_Process_Name": "",
                "v_Reporter_Email_Body": "",
                "v_Decoded_Command_Line": "",
                "v_Sender_Email_Address": "",
                "destination_ip_location": "{%if not vars.associated_events.0.attributes.destIpAddr|ipv4(\"10.0.0.0/8\")%}public{%else%}private{%endif%}",
                "v_Recipient_Email_Address": "",
                "v_Parent_Process_Command_Line": ""
              },
              "status": null,
              "left": "620",
              "top": "20",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "70a0c4e3-f666-4c20-b015-133be367e8e9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Alert Attributes",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Initialize Alert Fields",
                  "records": ""
                },
                "resource": {
                  "name": "{{vars.input.records[0].name}}{%if vars.v_Source_IP%}-From: {{vars.v_Source_IP}}{%endif%}",
                  "type": "{{vars.v_subcategory | resolveRange(vars.v_Type_Map)}}",
                  "dueBy": "{{globalVars.Tomorrow_Date}}",
                  "state": {
                    "id": 220,
                    "@id": "/api/3/picklists/a1bac09b-1441-45aa-ad1b-c88744e48e72",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "New",
                    "listName": "/api/3/picklist_names/2f9ed741-25fe-475a-9f12-64336288eebf",
                    "itemValue": "New",
                    "orderIndex": 0
                  },
                  "domain": "{%if vars.v_Domain%}{{vars.v_Domain}}{%endif%}",
                  "status": {
                    "id": 118,
                    "@id": "/api/3/picklists/7de816ff-7140-4ee5-bd05-93ce22002146",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Open",
                    "listName": "/api/3/picklist_names/33e964a9-d607-49f2-813c-7ce46141815a",
                    "itemValue": "Open",
                    "orderIndex": 1
                  },
                  "reporter": "{{vars.v_Reporter}}",
                  "severity": "{{vars.v_severity}}",
                  "sourceId": "{{vars.v_Source_ID}}",
                  "sourceIp": "{{vars.v_Source_IP}}",
                  "userName": "{{vars.v_Username}}",
                  "eventTime": "{{arrow.get(vars.v_incidentFirstSeen).to(\"UTC\").format(\"MMM-DD HH:mm:ss\")}}",
                  "assignedTo": "/api/3/people/3451141c-bac6-467c-8d72-85e0fab569ce",
                  "recordTags": [],
                  "sourceType": "{{vars.v_Source_Type}}",
                  "sourcedata": "{{vars.source_data|toJSON}}",
                  "description": "{{vars.v_Description}}\nIncident Category: {{vars.v_Source_Type}}\n{%if vars.v_Source_IP%}Source IP:{{vars.v_Source_IP}}{%endif%}\n{%if vars.v_Destination_IP%}Destination IP:&nbsp;{{vars.v_Destination_IP}}{%endif%}\n{%if vars.v_Reporter %} Reporting Device: {{vars.v_Reporter}}{%endif%}\n{%if vars.v_Username %} Username: {{vars.v_Username}}{%endif%}",
                  "respDueDate": "{{globalVars.Tomorrow_Date}}",
                  "assigneddate": "{{globalVars.Current_Data}}",
                  "emailSubject": "None",
                  "destinationIp": "{{vars.v_Destination_IP}}",
                  "killChainPhase": {
                    "id": 373,
                    "@id": "/api/3/picklists/8dfaa4f1-cd5b-43dc-bc3f-8821261fcb69",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Actions on Objectives",
                    "listName": "/api/3/picklist_names/eddbc863-c725-479a-867f-cec66206a6b4",
                    "itemValue": "Actions on Objectives",
                    "orderIndex": 7
                  },
                  "alertDetectionDate": "{{globalVars.Current_Date}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "920",
              "top": "20",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "bbe8b88c-cefe-4202-a677-367daff4d728"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create User",
              "description": null,
              "arguments": {
                "when": "{{vars.v_Username | length > 0 and vars.steps.Find_Existing_User | length == 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- User not found in FortiSOAR, creating: <span style=\"color:orange;font-weight:bold\">{{vars.v_Username}} </span>",
                  "records": ""
                },
                "resource": {
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "assets": "{{vars.asset_iri}}",
                  "userName": "{{vars.v_Username}}",
                  "__replace": ""
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/users",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "605",
              "top": "366",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "ba868486-efcb-4ff1-9f1d-56f837ae7815"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Asset",
              "description": null,
              "arguments": {
                "when": "{{vars.v_Source_IP and vars.v_Source_IP|ipv4(\"10.0.0.0/8\")|length > 0 and vars.steps.Find_Existing_Asset | length == 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Asset <span style=\"color:orange;font-weight:bold\">{{vars.v_Source_IP}} </span>is internal, creating asset object",
                  "records": ""
                },
                "resource": {
                  "ip": "{{vars.v_Source_IP}}",
                  "users": "{%if vars.steps.Create_User['@id']%}{{vars.steps.Create_User['@id']}}{%endif%}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "__replace": "",
                  "recordTags": [
                    "/api/3/tags/malware_investigation"
                  ]
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/assets",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1220",
              "top": "248",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "e92a3d98-b221-4154-b64d-f0575961e7af"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Existing Asset",
              "description": null,
              "arguments": {
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "ip",
                      "value": "{{vars.v_Source_IP}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "assets?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Get Asset <span style=\"color:orange;font-weight:bold\">{{vars.v_Source_IP}} </span>Status",
                  "records": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "1220",
              "top": "20",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "fc32c881-2bca-4c30-a7ea-94a55546c9be"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Existing User",
              "description": null,
              "arguments": {
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "userName",
                      "value": "{{vars.v_Username}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "users?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Find user: <span style=\"color:orange;font-weight:bold\"> {{vars.v_Username}} </span>status",
                  "records": ""
                },
                "step_variables": {
                  "asset_iri": "{%if vars.steps.Create_Asset['@id']%}{{vars.steps.Create_Asset['@id']}}{%else%}{{vars.steps.Link_Asset['@id']}}{%endif%}"
                }
              },
              "status": null,
              "left": "905",
              "top": "246",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "bac3eca5-39dc-431a-b9b7-c96204855ffa"
            },
            {
              "@type": "WorkflowStep",
              "name": "Asset Exists",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/b9f965e2-af3e-4408-ad9f-b21cd50c1c7c",
                    "condition": "{{ vars.steps.Find_Existing_Asset | length > 0 }}",
                    "step_name": "Link Asset"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/e92a3d98-b221-4154-b64d-f0575961e7af",
                    "step_name": "Create Asset"
                  }
                ]
              },
              "status": null,
              "left": "1220",
              "top": "134",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "1057472e-84ac-4367-a4bc-901bdfb37d8c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Asset",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Asset exists, linking it to the current Alert",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "alerts": "{{vars.input.records[0]['@id']}}",
                    "recordTags": [
                      "/api/3/tags/malware_investigation"
                    ]
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.steps.Find_Existing_Asset[0]['@id']}}",
                "collectionType": "/api/3/assets",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "905",
              "top": "132",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "b9f965e2-af3e-4408-ad9f-b21cd50c1c7c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link User",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- User exists,  linking it to the current Alert",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "alerts": "{{vars.input.records[0]['@id']}}",
                    "assets": "{{vars.asset_iri}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.steps.Find_Existing_User[0]['@id']}}",
                "collectionType": "/api/3/users",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "300",
              "top": "306",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "80babdc3-75d4-47b2-93db-97fb5be21c64"
            },
            {
              "@type": "WorkflowStep",
              "name": "User Exists",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/80babdc3-75d4-47b2-93db-97fb5be21c64",
                    "condition": "{{ vars.steps.Find_Existing_User | length > 0 }}",
                    "step_name": "Link User"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/ba868486-efcb-4ff1-9f1d-56f837ae7815",
                    "step_name": "Create User"
                  }
                ]
              },
              "status": null,
              "left": "605",
              "top": "246",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "3269d2f8-9b55-434f-9f86-64872f7cc1d0"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Indicator",
              "description": null,
              "arguments": {
                "when": "{{vars.destination_ip_location == \"public\"}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Indicator not found in FortiSOAR, creating: <span style=\"color:red;font-weight:bold\">{{vars.v_Destination_IP}}</span>",
                  "records": ""
                },
                "resource": {
                  "value": "{{vars.v_Destination_IP}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 77,
                    "@id": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "IP Address",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "IP Address",
                    "orderIndex": 7
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "300",
              "top": "600",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "39ad1e6a-ad86-4b94-a40e-c5ccdc029f36"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Existing Indicators",
              "description": null,
              "arguments": {
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.v_Destination_IP}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "indicators?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Find Indicator <span style=\"color:orange;font-weight:bold\">{{vars.v_Destination_IP}} </span>Status",
                  "records": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "605",
              "top": "480",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "0090ea8c-0db1-4429-9fa2-00f58743ee18"
            },
            {
              "@type": "WorkflowStep",
              "name": "Indicator Exists",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/44f19270-96b1-4057-872e-564492846d5a",
                    "condition": "{{ vars.steps.Find_Existing_Indicators | length > 0 }}",
                    "step_name": "Link Indicator"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/39ad1e6a-ad86-4b94-a40e-c5ccdc029f36",
                    "step_name": "Create Indicator"
                  }
                ]
              },
              "status": null,
              "left": "300",
              "top": "480",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "abda0a2a-621e-4127-ba5e-cd10e609c1c4"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Indicator",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Indicator found, linking : <span style=\"color:red;font-weight:bold\">{{vars.v_Destination_IP}}</span></p>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "alerts": "{{vars.input.records[0]['@id']}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.steps.Find_Existing_Indicators[0]['@id']}}",
                "collectionType": "/api/3/indicators",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "7",
              "top": "600",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "44f19270-96b1-4057-872e-564492846d5a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update MITRE ATTACK ID",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Linking MITRE Technique ID(s)",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "mitrelink": "{{vars.steps.Find_MITRE_ID[0]['@id']}}"
                  },
                  "mitreattackid": "{{vars.v_incidentComments}}"
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "900",
              "top": "600",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "fd1776b7-55e9-47b9-95c3-63856d55718b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find MITRE ID",
              "description": null,
              "arguments": {
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "techniqueid",
                      "value": "%{{vars.v_incidentComments}}%",
                      "operator": "like",
                      "_operator": "like"
                    }
                  ]
                },
                "module": "mitreattack?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Lookup MITRE Technique ID",
                  "records": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "900",
              "top": "480",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "b10ba8b1-7694-4935-ac44-c1d2d4f1150d"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "625f10e4-19d7-4440-9cb2-5cca57b490a1",
              "name": "Set Source Data -> Fields Mapping",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/70a0c4e3-f666-4c20-b015-133be367e8e9",
              "sourceStep": "/api/3/workflow_steps/be356e70-fd58-433d-9b90-4b63cb516bb8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "a008f93b-ce8c-45fd-bacf-521b0afe49e3",
              "name": "Fields Mapping -> Update Alert Attributes",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/bbe8b88c-cefe-4202-a677-367daff4d728",
              "sourceStep": "/api/3/workflow_steps/70a0c4e3-f666-4c20-b015-133be367e8e9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "87f5a83b-d273-4031-b5b4-1231100ca708",
              "name": "Start -> Set Source Data",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/be356e70-fd58-433d-9b90-4b63cb516bb8",
              "sourceStep": "/api/3/workflow_steps/63f5ab72-66d2-49a3-9aa0-b99c19349633"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "636ae339-2885-4d9b-a491-d5f504fdcaec",
              "name": "Update Alert Attributes -> Find Existing Records",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fc32c881-2bca-4c30-a7ea-94a55546c9be",
              "sourceStep": "/api/3/workflow_steps/bbe8b88c-cefe-4202-a677-367daff4d728"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "ead9cd6d-a096-49c7-a00c-409ab6362906",
              "name": "Create Asset -> Find Existing User",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/bac3eca5-39dc-431a-b9b7-c96204855ffa",
              "sourceStep": "/api/3/workflow_steps/e92a3d98-b221-4154-b64d-f0575961e7af"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "44417fa6-56fc-4684-802e-f702ab6e3bd0",
              "name": "Find Existing Asset -> Asset Exists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/1057472e-84ac-4367-a4bc-901bdfb37d8c",
              "sourceStep": "/api/3/workflow_steps/fc32c881-2bca-4c30-a7ea-94a55546c9be"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "7805f5c8-a762-4515-9dfe-0cd2cf0889af",
              "name": "Asset Exists -> Create Asset",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e92a3d98-b221-4154-b64d-f0575961e7af",
              "sourceStep": "/api/3/workflow_steps/1057472e-84ac-4367-a4bc-901bdfb37d8c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "309189e2-9f85-4126-972f-344f13912de3",
              "name": "Asset Exists -> Link Asset",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/b9f965e2-af3e-4408-ad9f-b21cd50c1c7c",
              "sourceStep": "/api/3/workflow_steps/1057472e-84ac-4367-a4bc-901bdfb37d8c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "416789e0-9829-475c-9d8b-a13260ef8dde",
              "name": "Link Asset -> Create Asset",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e92a3d98-b221-4154-b64d-f0575961e7af",
              "sourceStep": "/api/3/workflow_steps/b9f965e2-af3e-4408-ad9f-b21cd50c1c7c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b81c0937-0927-49e4-a481-9301432de144",
              "name": "Find Existing User -> User Exists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3269d2f8-9b55-434f-9f86-64872f7cc1d0",
              "sourceStep": "/api/3/workflow_steps/bac3eca5-39dc-431a-b9b7-c96204855ffa"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "ad8f47b9-2c92-4025-ae90-e38bd22a49c7",
              "name": "User Exists -> Create User",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ba868486-efcb-4ff1-9f1d-56f837ae7815",
              "sourceStep": "/api/3/workflow_steps/3269d2f8-9b55-434f-9f86-64872f7cc1d0"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "166a0941-cd84-4370-9779-c5ddd640c7c6",
              "name": "User Exists -> Link User",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/80babdc3-75d4-47b2-93db-97fb5be21c64",
              "sourceStep": "/api/3/workflow_steps/3269d2f8-9b55-434f-9f86-64872f7cc1d0"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "39268711-6390-4e09-b7f6-c523522dd783",
              "name": "Link User -> Create User",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ba868486-efcb-4ff1-9f1d-56f837ae7815",
              "sourceStep": "/api/3/workflow_steps/80babdc3-75d4-47b2-93db-97fb5be21c64"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "ab6ff3a5-4f92-47d4-9726-105daeb7c35e",
              "name": "Create User -> Find Existing Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/0090ea8c-0db1-4429-9fa2-00f58743ee18",
              "sourceStep": "/api/3/workflow_steps/ba868486-efcb-4ff1-9f1d-56f837ae7815"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e6cccfa0-ee32-491d-a8e2-dca91773943f",
              "name": "Find Existing Indicators -> Copy  of User Exists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/abda0a2a-621e-4127-ba5e-cd10e609c1c4",
              "sourceStep": "/api/3/workflow_steps/0090ea8c-0db1-4429-9fa2-00f58743ee18"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "8485bc39-98a7-4896-bf2b-5010864ec4c5",
              "name": "Indicator Exists -> Create Indicator",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/39ad1e6a-ad86-4b94-a40e-c5ccdc029f36",
              "sourceStep": "/api/3/workflow_steps/abda0a2a-621e-4127-ba5e-cd10e609c1c4"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d2027e96-a908-4f41-a024-9ce7f7f71c5d",
              "name": "Indicator Exists -> Copy 1 of Link Asset",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/44f19270-96b1-4057-872e-564492846d5a",
              "sourceStep": "/api/3/workflow_steps/abda0a2a-621e-4127-ba5e-cd10e609c1c4"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d992058d-2785-44e3-883f-76eacd6384ee",
              "name": "Find Existing Indicators -> Find MITRE ID",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/b10ba8b1-7694-4935-ac44-c1d2d4f1150d",
              "sourceStep": "/api/3/workflow_steps/0090ea8c-0db1-4429-9fa2-00f58743ee18"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "db746241-d08e-4a17-9705-36faa8170739",
              "name": "Find MITRE ID -> Update MITRE ATTACK ID",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fd1776b7-55e9-47b9-95c3-63856d55718b",
              "sourceStep": "/api/3/workflow_steps/b10ba8b1-7694-4935-ac44-c1d2d4f1150d"
            }
          ],
          "versions": null,
          "lastModifyDate": 1597840298,
          "uuid": "cbb861db-5cc9-4e1c-8b8b-b622b8f702e2",
          "recordTags": [
            "Alerts"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "03 - User Group Membership Lookup",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/4afec611-32a5-4368-a338-4c7336d4c670",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/61d9556f-4fcd-4397-b2ef-e741fc6ab166",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "users",
                "resources": [
                  "users"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": []
                }
              },
              "status": null,
              "left": "125",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "61d9556f-4fcd-4397-b2ef-e741fc6ab166"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Groups Definition",
              "description": null,
              "arguments": {
                "name": "Active Directory",
                "config": "1b14150d-e5da-4fff-a71a-a2c18a3c7f7b",
                "params": {
                  "cookie": "",
                  "page_size": "",
                  "size_limit": "",
                  "search_object": "Group"
                },
                "version": "2.1.0",
                "connector": "activedirectory",
                "operation": "get_all_object_details",
                "operationTitle": "Get All Objects Details",
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "a591b300-68ad-4bd2-af29-1005b8ef400b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get User Attributes",
              "description": null,
              "arguments": {
                "name": "Active Directory",
                "config": "1b14150d-e5da-4fff-a71a-a2c18a3c7f7b",
                "params": {
                  "search_object": "User",
                  "search_attr_value": "{{vars.input.records[0].userName}}"
                },
                "version": "2.1.0",
                "connector": "activedirectory",
                "operation": "get_specific_object_details",
                "operationTitle": "Get Specific Object Details",
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "65af7ebd-031b-4134-b48f-2c13fd8722d8"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute Results",
              "description": null,
              "arguments": {
                "domain": "{%if vars.steps.Get_User_Attributes.data.entries[0].attributes.mail%}{{(vars.steps.Get_User_Attributes.data.entries[0].attributes.mail).split(\"@\")[1]}}{%endif%}",
                "group_id": "{{vars.steps.Get_User_Attributes.data.entries[0].attributes.primaryGroupID}}",
                "ad_groups": "{{vars.steps.Get_Groups_Definition.data.entries}}",
                "security_id": "{{vars.steps.Get_User_Attributes.data.entries[0].attributes.objectSid}}"
              },
              "status": null,
              "left": "125",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "14458b76-3c22-4bd2-b6c3-c17fb703c271"
            },
            {
              "@type": "WorkflowStep",
              "name": "Group Membership",
              "description": null,
              "arguments": {
                "user_primary_group": "{%for group in vars.ad_groups%}\n{%if '-'+vars.group_id|string in group.attributes.objectSid%}{{group}}{%endif%}\n{%endfor%}"
              },
              "status": null,
              "left": "125",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "651352c7-136e-47a1-8a49-df83d2bb65cb"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update User",
              "description": null,
              "arguments": {
                "resource": {
                  "__link": {
                    "recordTags": []
                  },
                  "domain": "{%if vars.domain%}{{vars.domain}}{%endif%}",
                  "securityId": "{%if vars.security_id%}{{vars.security_id}}{%endif%}",
                  "primaryGroup": "{{vars.user_primary_group.dn}}"
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/users",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "705",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "af0256b9-c840-4fbd-bd09-55da1970536b"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "dc9c99a5-4612-455e-9605-fb10efe9a0b6",
              "name": "Start -> Get Groups Definition",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/a591b300-68ad-4bd2-af29-1005b8ef400b",
              "sourceStep": "/api/3/workflow_steps/61d9556f-4fcd-4397-b2ef-e741fc6ab166"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "15445aad-b606-4840-8a37-fe48ceabe5ef",
              "name": "Get Groups Definition -> Get User Attributes",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/65af7ebd-031b-4134-b48f-2c13fd8722d8",
              "sourceStep": "/api/3/workflow_steps/a591b300-68ad-4bd2-af29-1005b8ef400b"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "975e9e88-93dd-4af3-b100-d8438d776f77",
              "name": "Get User Attributes -> Compute Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/14458b76-3c22-4bd2-b6c3-c17fb703c271",
              "sourceStep": "/api/3/workflow_steps/65af7ebd-031b-4134-b48f-2c13fd8722d8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "00f68948-0f12-4a84-b9e3-241048773b30",
              "name": "Compute Results -> Group Membership",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/651352c7-136e-47a1-8a49-df83d2bb65cb",
              "sourceStep": "/api/3/workflow_steps/14458b76-3c22-4bd2-b6c3-c17fb703c271"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "7cc3530f-7348-405e-942c-c97b7fe3109a",
              "name": "Group Membership -> Update User",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/af0256b9-c840-4fbd-bd09-55da1970536b",
              "sourceStep": "/api/3/workflow_steps/651352c7-136e-47a1-8a49-df83d2bb65cb"
            }
          ],
          "versions": null,
          "lastModifyDate": 1596558263,
          "uuid": "e1e16c4f-f501-46d9-be61-7cc68dc88009",
          "recordTags": [
            "Users"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "04 - Malware Investigation",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/4afec611-32a5-4368-a338-4c7336d4c670",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/13342c5a-c7d2-4dec-8359-4c914f36563b",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "route": "6cb9281c-4b42-4402-9b37-d3d0355fe448",
                "resources": [
                  "incidents"
                ],
                "inputVariables": [],
                "step_variables": {
                  "input": {
                    "records": "{{vars.input.records}}"
                  }
                },
                "displayConditions": {
                  "incidents": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": []
                  }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
              },
              "status": null,
              "left": "231",
              "top": "29",
              "stepType": "/api/3/workflow_step_types/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
              "uuid": "13342c5a-c7d2-4dec-8359-4c914f36563b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Incident Data",
              "description": null,
              "arguments": {
                "assets_IPs": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).assets|json_query('[*].ip[]')|join(\",\")}}",
                "indicators": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).indicators|json_query('[*].[\"value\"][]')}}",
                "linked_alerts": "[]",
                "related_users": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).alerts|json_query('[*].[\"userName\"][]')}}",
                "related_alerts": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).alerts|json_query('[*].[\"name\"][]')}}",
                "related_assets": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).assets|json_query('[*].[\"ip\"][]')}}",
                "alerts_source_data": "[]",
                "related_assets_IRIs": "{{ ((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).assets|json_query('[*].[\"@id\"][]')}}"
              },
              "status": null,
              "left": "231",
              "top": "140",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "2a5de358-5b30-49b6-a687-bf7d9dd0b385"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Most Used Protocols",
              "description": null,
              "arguments": {
                "name": "Fortinet FortiSIEM",
                "config": "8ea08a0e-458a-4d6f-be15-1dbe8feeef99",
                "params": {
                  "cond": "srcIpAddr IN({{vars.assets_IPs}})",
                  "start": 0,
                  "value": 10,
                  "groupby": "",
                  "orderby": "totBytes64",
                  "perPage": 50,
                  "AttrList": "appName,totBytes64",
                  "rel_time": "Minutes",
                  "time_selection": "Relative Time"
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Run FortiSIEM Query: <span style=\"color:orange;font-weight:bold\">Get Most Used Protocols</span>",
                  "records": ""
                },
                "version": "4.0.0",
                "connector": "fortinet-fortisiem",
                "operation": "run_report",
                "operationTitle": "Run Advanced Search Query",
                "step_variables": {
                  "used_protocols": "{{vars.result.data.events}}"
                }
              },
              "status": null,
              "left": "231",
              "top": "250",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "135a8644-a702-4946-b9c0-131e4857d9fc"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get All Dropped Files",
              "description": null,
              "arguments": {
                "name": "Fortinet FortiSIEM",
                "config": "8ea08a0e-458a-4d6f-be15-1dbe8feeef99",
                "params": {
                  "cond": "reptDevIpAddr IN ({{vars.assets_IPs}})  AND  eventType = \"Win-Sysmon-11-FileCreate\"",
                  "start": 0,
                  "value": 10,
                  "groupby": "",
                  "orderby": "reptDevIpAddr DESC",
                  "perPage": 100,
                  "AttrList": "reptDevIpAddr,fileName,hashCode,procName",
                  "rel_time": "Minutes",
                  "time_selection": "Relative Time"
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- FortiSIEM Query: <span style=\"color:orange;font-weight:bold\">Get All Dropped Files</span>",
                  "records": ""
                },
                "version": "4.0.0",
                "connector": "fortinet-fortisiem",
                "operation": "run_report",
                "operationTitle": "Run Advanced Search Query",
                "step_variables": {
                  "dropped_files": "{{vars.result.data.events}}"
                }
              },
              "status": null,
              "left": "231",
              "top": "360",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "555ea81d-f3ed-44a2-bba7-7b210fb10b04"
            },
            {
              "@type": "WorkflowStep",
              "name": "Format Dropped Files Report",
              "description": null,
              "arguments": {
                "when": "{{vars.dropped_files | length > 0}}",
                "params": {
                  "data": "{{vars.dropped_files}}",
                  "display": "Horizontal",
                  "styling": false,
                  "template": "Stylized with row selection",
                  "row_fields": ""
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">List of dropped files on infected machines:</span></p>\t\n{{vars.result.data}}",
                  "records": ""
                },
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "json_to_html",
                "operationTitle": "Utils: Convert JSON into a HTML Table",
                "step_variables": []
              },
              "status": null,
              "left": "31",
              "top": "560",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "0116fa50-c042-4b6f-bf08-6400693cce5b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Format Results",
              "description": null,
              "arguments": {
                "_tmp1": "{%for asset in vars.related_assets_IRIs%}{{vars.linked_alerts.append((asset+ \"?$relationships=true\")|fromIRI)}}{%endfor%}",
                "dropped_files": "{{vars.dropped_files|json_query(\"[].attributes\")}}",
                "used_protocols": "{{vars.used_protocols|json_query(\"[*].attributes\")}}"
              },
              "status": null,
              "left": "231",
              "top": "468",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "109699aa-d03e-4d18-95dc-baf9da27b70c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Format Network Report",
              "description": null,
              "arguments": {
                "when": "{{vars.used_protocols|length > 0}}",
                "params": {
                  "data": "{{vars.used_protocols}}",
                  "display": "Horizontal",
                  "styling": false,
                  "template": "Stylized with row selection",
                  "row_fields": ""
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Used Protocols between infected assets:</span></p>\t\n{{vars.result.data}}",
                  "records": ""
                },
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "json_to_html",
                "operationTitle": "Utils: Convert JSON into a HTML Table",
                "step_variables": []
              },
              "status": null,
              "left": "431",
              "top": "560",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "674dd4ff-5400-4419-91a2-cd5bc3f7e642"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Incident",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "- Update Incident Data with FortiSIEM Reports",
                  "records": ""
                },
                "resource": {
                  "phase": {
                    "id": 187,
                    "@id": "/api/3/picklists/bb7407e0-f699-11e7-8c3f-9a214cf093ae",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Containment",
                    "listName": "/api/3/picklist_names/b862eb1f-b385-40ca-baa7-5a1b1f91a651",
                    "itemValue": "Containment",
                    "orderIndex": 3
                  },
                  "__link": {
                    "mitreincidentlink": "{{(vars.alerts_source_data|json_query('[].mitrelink[].[\"@id\"]'))|flatten(levels=1)|unique}}"
                  },
                  "description": "<span style=\"background-color:yellow;color:black;font-weight:bold\">Related Alerts:</span>\n-{{vars.alerts_list|json_query(\"[*].name\")|join(\"\\n -\")}}\n\n\n<span style=\"background-color:yellow;color:black;font-weight:bold\">Related Assets:</span>\n-{{vars.related_assets|join(\"\\n-\")}}\n\n<span style=\"background-color:yellow;color:black;font-weight:bold\">Related Users:</span>\n{{vars.related_users|join(\", \")}}\n\n<span style=\"background-color:yellow;color:black;font-weight:bold\">Indicators:</span>\n<span style=\"color:red;font-weight:bold\">- {{vars.indicators|join(\"\\n-\")}}</span>\n\n<span style=\"background-color:yellow;color:black;font-weight:bold\">Suggested MITRE Remediations:</span>\n-{{((vars.alerts_source_data|json_query('[].mitrelink[]. mitigations'))|flatten(levels=1)|unique)|join(\"\\n-\")}}\n"
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/incidents",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "226",
              "top": "887",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "96c7c435-1f2a-4b74-8895-0ac5682b0e05"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute Results",
              "description": null,
              "arguments": {
                "alerts_list": "{{vars.linked_alerts|json_query('[*].alerts[]') | flatten(levels=1)}}",
                "alerts_list_IRIs": "{{vars.linked_alerts|json_query('[*].alerts[].[\"@id\"]')|flatten(levels=1)}}"
              },
              "status": null,
              "left": "226",
              "top": "660",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "e7e94348-8036-4a75-bf7b-7ca28013fc17"
            },
            {
              "@type": "WorkflowStep",
              "name": "Results Parser",
              "description": null,
              "arguments": {
                "_tmp2": "{%for alert in vars.alerts_list_IRIs%}{{vars.alerts_source_data.append((alert+ \"?$relationships=true\")|fromIRI)}}{%endfor%}"
              },
              "status": null,
              "left": "226",
              "top": "772",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "b5768b18-ca6e-4d1e-a3ee-cd379243dde0"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "390cbc04-b314-4993-ab32-19a210b5c2b9",
              "name": "Start -> Get Incident Data",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/2a5de358-5b30-49b6-a687-bf7d9dd0b385",
              "sourceStep": "/api/3/workflow_steps/13342c5a-c7d2-4dec-8359-4c914f36563b"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "69b70ce9-6b90-4240-86d0-a58a1b778c47",
              "name": "Get Incident Data -> Get Most Used Protocols",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/135a8644-a702-4946-b9c0-131e4857d9fc",
              "sourceStep": "/api/3/workflow_steps/2a5de358-5b30-49b6-a687-bf7d9dd0b385"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e6d6ca46-6890-4809-96c0-7c04272b069e",
              "name": "Get Most Used Protocols -> Get All Dropped Files",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/555ea81d-f3ed-44a2-bba7-7b210fb10b04",
              "sourceStep": "/api/3/workflow_steps/135a8644-a702-4946-b9c0-131e4857d9fc"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "663494c4-6fdb-4392-a744-5965d9aeb59b",
              "name": "Get All Dropped Files -> Format Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/109699aa-d03e-4d18-95dc-baf9da27b70c",
              "sourceStep": "/api/3/workflow_steps/555ea81d-f3ed-44a2-bba7-7b210fb10b04"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "516112b3-ced3-44ca-b960-f12573fd4156",
              "name": "Format Results -> Compile results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/0116fa50-c042-4b6f-bf08-6400693cce5b",
              "sourceStep": "/api/3/workflow_steps/109699aa-d03e-4d18-95dc-baf9da27b70c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d6047f72-6381-4882-962a-d8db4ddef57f",
              "name": "Format Results -> Format Network Report",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/674dd4ff-5400-4419-91a2-cd5bc3f7e642",
              "sourceStep": "/api/3/workflow_steps/109699aa-d03e-4d18-95dc-baf9da27b70c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "09a9519f-b099-422b-b473-100eceae7742",
              "name": "Format Dropped Files Report -> Compute Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e7e94348-8036-4a75-bf7b-7ca28013fc17",
              "sourceStep": "/api/3/workflow_steps/0116fa50-c042-4b6f-bf08-6400693cce5b"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b14ba086-04a7-4cba-9f0d-82cc44d8d154",
              "name": "Format Network Report -> Compute Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e7e94348-8036-4a75-bf7b-7ca28013fc17",
              "sourceStep": "/api/3/workflow_steps/674dd4ff-5400-4419-91a2-cd5bc3f7e642"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "292cc28c-d6aa-4e6f-9d32-c98df24c4b9b",
              "name": "Compute Results -> Results Parser",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/b5768b18-ca6e-4d1e-a3ee-cd379243dde0",
              "sourceStep": "/api/3/workflow_steps/e7e94348-8036-4a75-bf7b-7ca28013fc17"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "48ce0267-a6b8-4b4a-85af-648f26d654d6",
              "name": "Results Parser -> Update Incident",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/96c7c435-1f2a-4b74-8895-0ac5682b0e05",
              "sourceStep": "/api/3/workflow_steps/b5768b18-ca6e-4d1e-a3ee-cd379243dde0"
            }
          ],
          "versions": null,
          "lastModifyDate": 1596642942,
          "uuid": "ed2e5d8f-3f7a-45f9-8334-a6aa2f944fd8",
          "recordTags": [
            "Incidents"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "02 - Get Vulnerabilities Assessment Results",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/4afec611-32a5-4368-a338-4c7336d4c670",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/8d43b80b-f227-46ea-99c5-706db1f458de",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Get Vulnerabilities",
              "description": null,
              "arguments": {
                "when": "{{not vars.steps.List_Available}}",
                "resource": {
                  "name": "SMB DOUBLEPULSAR Remote Code Execution",
                  "risk": "HIGH",
                  "cveId": "CVE-2017-0144",
                  "assets": "{{vars.input.records[0]['@id']}}",
                  "status": {
                    "id": 219,
                    "@id": "/api/3/picklists/e001be1d-d050-473c-a82d-003bf14c4b1b",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#A51516",
                    "display": "Open",
                    "listName": "/api/3/picklist_names/0b2b995f-0292-43ca-be81-03904250791c",
                    "itemValue": "Open",
                    "orderIndex": 0
                  },
                  "severity": {
                    "id": 56,
                    "@id": "/api/3/picklists/40187287-89fc-4e9c-b717-e9443d57eedb",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#DE7A13",
                    "display": "High",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "High",
                    "orderIndex": 3
                  },
                  "__replace": "",
                  "riskScore": "9.3",
                  "cvssVector": "AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H",
                  "sourceData": "Nessus Scanner",
                  "description": "The SMBv1 server in Microsoft Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016 allows remote attackers to execute arbitrary code via crafted packets, aka \"Windows SMB Remote Code Execution Vulnerability.\" This vulnerability is different from those described in CVE-2017-0143, CVE-2017-0145, CVE-2017-0146, and CVE-2017-0148",
                  "cvss3BaseScore": "8.2",
                  "vulnerabilityId": "0144",
                  "cvss3TemporalVector": "3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/vulnerabilities",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "22136bb6-4b89-426e-a4b9-da6af652737f"
            },
            {
              "@type": "WorkflowStep",
              "name": "List Available",
              "description": null,
              "arguments": {
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "cveId",
                      "value": "CVE-2017-0144",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "vulnerabilities?$limit=30",
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "fe0e114d-cf10-4594-9785-d572bd431a38"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Vulnerabilities",
              "description": null,
              "arguments": {
                "when": "{{vars.steps.List_Available|length > 0}}",
                "resource": {
                  "__link": {
                    "vulnerabilities": "{{vars.steps.List_Available[0]['@id']}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/assets",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "09826ace-edda-4917-81dc-70d85a238362"
            },
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "assets",
                "resources": [
                  "assets"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "array",
                      "field": "recordTags",
                      "value": [
                        "/api/3/tags/malware_investigation"
                      ],
                      "module": "recordTags",
                      "display": null,
                      "operator": "in",
                      "OPERATOR_KEY": "$",
                      "previousOperator": "in"
                    }
                  ]
                }
              },
              "status": null,
              "left": "125",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "8d43b80b-f227-46ea-99c5-706db1f458de"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "bf06caaf-b834-436e-843f-0e03f0b2e015",
              "name": "List Available -> Link Vulnerabilities",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/09826ace-edda-4917-81dc-70d85a238362",
              "sourceStep": "/api/3/workflow_steps/fe0e114d-cf10-4594-9785-d572bd431a38"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "41a036ce-32ce-4912-ab83-6f09997130d7",
              "name": "Link Vulnerabilities -> Get Vulnerabilities",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/22136bb6-4b89-426e-a4b9-da6af652737f",
              "sourceStep": "/api/3/workflow_steps/09826ace-edda-4917-81dc-70d85a238362"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b638f4df-469c-435f-9d88-3ece3ea9300e",
              "name": "Start -> List Available",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fe0e114d-cf10-4594-9785-d572bd431a38",
              "sourceStep": "/api/3/workflow_steps/8d43b80b-f227-46ea-99c5-706db1f458de"
            }
          ],
          "versions": null,
          "lastModifyDate": 1597840230,
          "uuid": "fecdc7bf-b5e4-47f8-b495-ebfdbc8583db",
          "recordTags": [
            "Assets"
          ],
          "isPrivate": false,
          "owners": []
        }
      ]
    }
  ],
  "macros": [
    {
      "name": "Tomorrow_Date",
      "value": "{{arrow.utcnow().shift(hours=+24).timestamp}}",
      "default_value": null
    },
    {
      "name": "Current_Date",
      "value": "{{arrow.utcnow().timestamp}}",
      "default_value": null
    },
    {
      "name": "Current_Data",
      "value": "{{vars.input.records[0]}}",
      "default_value": null
    }
  ],
  "exported_tags": [
    "Assets",
    "Incidents",
    "Alerts",
    "Users"
  ]
}