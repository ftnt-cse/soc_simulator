{
  "type": "workflow_collections",
  "data": [
    {
      "@type": "WorkflowCollection",
      "name": "00 - SIM Email Phishing",
      "description": null,
      "visible": true,
      "image": null,
      "workflows": [
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "FSM-SIM-PHISHING-1",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/2dc7ea03-6317-4f3f-abc1-6ec264036418",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/a8c48939-3987-4a76-a8c3-339b088a94e9",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "alerts",
                "resources": [
                  "alerts"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "source",
                      "value": "FSMSIM-PHISHING-1",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                }
              },
              "status": null,
              "left": "808",
              "top": "20",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "a8c48939-3987-4a76-a8c3-339b088a94e9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Local Attributes",
              "description": null,
              "arguments": {
                "my_domain": "fortielab.com",
                "my_subnet": "['10.200.0.0/24']",
                "email_body": "{%if vars.input.records[0].sourcedata.body.html %}{{vars.input.records[0].sourcedata.body.html}}{%else%}{{vars.input.records[0].sourcedata.body.text}}{%endif%}",
                "source_data": "{{vars.input.records[0].sourcedata}}",
                "has_attachement_email": "{{vars.input.records[0].sourcedata.parsed_attachment_data | length}}"
              },
              "status": null,
              "left": "808",
              "top": "127",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "368cd169-84b2-43c2-be57-6c74fca017c8"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Alert",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Initialize Alert Fields</span></p>",
                  "records": ""
                },
                "resource": {
                  "name": "Suspicious Email:{{vars.source_data.headers.subject}}",
                  "type": {
                    "id": 121,
                    "@id": "/api/3/picklists/0b3ef6f9-eb29-4ab9-ac98-98364bd1a3aa",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Phishing",
                    "listName": "/api/3/picklist_names/a7087b9c-5660-495f-a8ac-c3b198ddb8c2",
                    "itemValue": "Phishing",
                    "orderIndex": 7
                  },
                  "dueBy": "{{globalVars.Tomorrow_Date}}",
                  "state": {
                    "id": 220,
                    "@id": "/api/3/picklists/a1bac09b-1441-45aa-ad1b-c88744e48e72",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "New",
                    "listName": "/api/3/picklist_names/2f9ed741-25fe-475a-9f12-64336288eebf",
                    "itemValue": "New",
                    "orderIndex": 0
                  },
                  "status": {
                    "id": 118,
                    "@id": "/api/3/picklists/7de816ff-7140-4ee5-bd05-93ce22002146",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Open",
                    "listName": "/api/3/picklist_names/33e964a9-d607-49f2-813c-7ce46141815a",
                    "itemValue": "Open",
                    "orderIndex": 1
                  },
                  "emailTo": "{{vars.source_data.headers.to}}",
                  "reporter": "{{vars.source_data.headers.from}}",
                  "severity": {
                    "id": 177,
                    "@id": "/api/3/picklists/b3c20a3a-ecfd-4adc-a225-0205968e6793",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#D2AC1A",
                    "display": "Medium",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "Medium",
                    "orderIndex": 2
                  },
                  "sourceId": "{{vars.source_data.headers['message-id']}}",
                  "emailBody": "{%if vars.source_data.body.html %}{{vars.source_data.body.html}}{%else%}{{vars.source_data.body.text}}{%endif%}",
                  "emailFrom": "{{vars.source_data.headers.from}}",
                  "epochTime": "{{vars.email_date}}",
                  "assignedTo": "/api/3/people/3451141c-bac6-467c-8d72-85e0fab569ce",
                  "recordTags": [
                    "/api/3/tags/Phishing"
                  ],
                  "sourceType": "Suspicious Mailbox",
                  "sourcedata": "{{vars.source_data|toJSON}}",
                  "description": "{%if 'Fw:' in vars.source_data.headers.subject or 'Fwd:' in vars.source_data.headers.subject %}\nEmail: ||**{{vars.source_data.headers.subject}}**|| Submited by  **{{vars.source_data.headers.from}}**\n{%endif%}",
                  "respDueDate": "{{globalVars.Tomorrow_Date}}",
                  "emailHeaders": "{{vars.source_data.headers|toJSON}}",
                  "emailSubject": "{{vars.source_data.headers.subject}}",
                  "senderDomain": "{{(vars.source_data.headers.from).split('@')[1]}}",
                  "killChainPhase": {
                    "id": 377,
                    "@id": "/api/3/picklists/d889ee08-9ddd-404b-a166-6e8c33414f5e",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Delivery",
                    "listName": "/api/3/picklist_names/eddbc863-c725-479a-867f-cec66206a6b4",
                    "itemValue": "Delivery",
                    "orderIndex": 3
                  },
                  "attachmentNames": "{%if vars.source_data.attachments[0].metadata.filename%}{{vars.source_data.attachments[0].metadata.filename}}{%endif%}",
                  "senderEmailAddress": "{{vars.original_email_sender}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "808",
              "top": "346",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "41f723c6-112e-4d53-9a92-5eb877e6f6d7"
            },
            {
              "@type": "WorkflowStep",
              "name": "Send Auto_Reply to Sender",
              "description": null,
              "arguments": {
                "name": "Exchange",
                "config": "b79754b3-d441-4854-b030-209fd26c61a2",
                "params": {
                  "body": "Your email with Subject: ||{{vars.source_data.headers.subject}}|| has been received, <br>you shall receive the investigation results as soon as available.<br>\n<br>\nSoC Team",
                  "subject": "Suspicious Email received for investigation",
                  "iri_list": "",
                  "cc_recipients": "",
                  "to_recipients": "{{vars.source_data.headers.from|regex_search(\"([\\w_.-]+\\@[\\w_.-]+\\.\\w+)\")}}",
                  "bcc_recipients": "",
                  "inline_iri_list": ""
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Sender Auto-response Notification to Sender</span></p>\n\n<p>The offending email sender <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.email_from}} ]</span> has been informed that they have been blocked.</p>",
                  "records": ""
                },
                "version": "3.4.1",
                "connector": "exchange",
                "operation": "send_email",
                "operationTitle": "Send Email",
                "step_variables": []
              },
              "status": null,
              "left": "808",
              "top": "232",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "a9760ff6-d26f-44f2-af48-e4533b94eebf"
            },
            {
              "@type": "WorkflowStep",
              "name": "Send Sender Bock Notification to All Recipients",
              "description": null,
              "arguments": {
                "name": "Exchange",
                "config": "b79754b3-d441-4854-b030-209fd26c61a2",
                "params": {
                  "body": "{{vars.email_from}} is suspected to send malicious emails, it will be blocked until the investigation is over<br>\n<br>\nSoC Team<br>",
                  "subject": "SOC Notification: email from: {{vars.email_from}}. Blocked Temporarily",
                  "iri_list": "",
                  "cc_recipients": "",
                  "to_recipients": "{{vars.email_to+vars.email_cc}}",
                  "bcc_recipients": "",
                  "inline_iri_list": ""
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Sender Auto-response Notification to Recipients</span></p>\n\n<p>All recipients have been informed that the offender email sender <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.email_from}} ]</span> has been blocked.</p>",
                  "records": ""
                },
                "version": "3.4.1",
                "connector": "exchange",
                "operation": "send_email",
                "operationTitle": "Send Email",
                "step_variables": []
              },
              "status": null,
              "left": "806",
              "top": "2740",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "47dfe8c4-5eaf-4bc6-a861-a1f6d11548d9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Block Email Sender",
              "description": null,
              "arguments": {
                "name": "Fortinet FortiMail",
                "config": "06efa263-5637-4482-8ed5-4046d51b6f2e",
                "params": {
                  "profile_name": "Inbound_Session",
                  "sender_blocklist_email_address": "{{vars.email_from}}"
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Block Email Sender on FortiMail</span></p>\n\n> At least one Indicator reputation was found to be <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ Malicious ]</span>.\n\n<p> The email sender: <span style=\"background-color:#FF0000;color:#FFFFFF;font-weight:bold\">[ {{vars.email_from}} ]</span> has been blocked on the FortiMail.</p>",
                  "records": ""
                },
                "version": "1.0.1",
                "connector": "fortinet-fortimail",
                "operation": "block_address_sender_blocklist",
                "operationTitle": "Block Address via Sender Blocklist",
                "step_variables": []
              },
              "status": null,
              "left": "806",
              "top": "2520",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "19c11527-61b5-4e0f-871a-f70bcc8e9b62"
            },
            {
              "@type": "WorkflowStep",
              "name": "EIS Notification Email",
              "description": null,
              "arguments": {
                "name": "Exchange",
                "config": "b79754b3-d441-4854-b030-209fd26c61a2",
                "params": {
                  "body": "<p>As <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.email_from}} ]</span> is suspected of sending malicious emails, it will be blocked until the investigation is over.</p>\n<br>\n<br>\nSoC Team<br>",
                  "subject": "SOC Notification: {{vars.email_from}} Blocked Temporarily",
                  "iri_list": "",
                  "cc_recipients": "",
                  "to_recipients": "eis@fortielab.com",
                  "bcc_recipients": "",
                  "inline_iri_list": ""
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">EIS Notified</span></p>\n\n<p>EIS has been notified that the alert from <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.email_from}} ]</span> requires investigation.</p>",
                  "records": ""
                },
                "version": "3.4.1",
                "connector": "exchange",
                "operation": "send_email",
                "operationTitle": "Send Email",
                "step_variables": []
              },
              "status": null,
              "left": "806",
              "top": "2847",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "fa0bde5b-d443-476a-8907-f8952e151a68"
            },
            {
              "@type": "WorkflowStep",
              "name": "Review Blocked Emails",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Create EIS Task</span></p>\n\nA new task has been created for EIS: Review the related alerts from <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.email_from}} ]</span>.</p>",
                  "records": ""
                },
                "resource": {
                  "name": "Review Blocked Emails",
                  "type": {
                    "id": 122,
                    "@id": "/api/3/picklists/826ad76d-e418-4928-9bc9-ea552ebcc5f9",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Incident Response",
                    "listName": "/api/3/picklist_names/b837e375-76af-4ba5-b6a1-bd1c3cd27292",
                    "itemValue": "Incident Response",
                    "orderIndex": 6
                  },
                  "dueBy": "{{globalVars.Tomorrow_Date}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "status": {
                    "id": 169,
                    "@id": "/api/3/picklists/ab65eb0f-e7a7-4993-8474-da5c8b52f380",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Assigned",
                    "listName": "/api/3/picklist_names/21ddbcfd-b4a3-4273-adea-c674fe47d643",
                    "itemValue": "Assigned",
                    "orderIndex": 0
                  },
                  "priority": {
                    "id": 139,
                    "@id": "/api/3/picklists/90088ebe-0a7d-4aa6-9c9c-93b937a4e4f8",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#e36c29",
                    "display": "High",
                    "listName": "/api/3/picklist_names/bea9a490-50d1-4597-8ad9-24422e10676e",
                    "itemValue": "High",
                    "orderIndex": 2
                  },
                  "taskdata": "Emails: {{vars.email_from}} has been blocked on FortiGate,\nreview the action and unblock it if required:\n1. Open any Alert\n2. Click Action\n3. Select FortiMail\n4. Select Unblock Email action\n5. set the email to: {{vars.email_from}}\n6. Click Execute",
                  "__replace": "",
                  "startDate": "{{globalVars.Current_Date}}",
                  "description": "<p>The email sender <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.email_from}} ]</span> has been blocked on the FortiMail,\nreview the action and unblock it if required.</p>\n<p>The steps to unblock the email sender are:\n1. Open related Alerts<br>\n2. Click Action<br>\n3. Select FortiMail<br>\n4. Select Unblock Email action<br>\n5. Set the email to: <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ {{vars.email_from}} ]</span><br>\n6. Click Execute<br>",
                  "assignedOnDate": "{{globalVars.Current_Date}}",
                  "assignedToPerson": "/api/3/people/3451141c-bac6-467c-8d72-85e0fab569ce"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/tasks",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "806",
              "top": "2960",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "990462b5-fbdd-4b4b-9aa3-6653eb70f16d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Extract Indicators",
              "description": null,
              "arguments": {
                "ip_indicators": "{%if vars.headers_artifacts and vars.body_artifacts%}{{vars.headers_artifacts.IP | union(vars.body_artifacts.IP)}}{%elif not vars.headers_artifacts%}{{vars.body_artifacts.IP}}{%elif not vars.body_artifacts%}{{vars.headers_artifacts.IP}}{%endif%}",
                "url_indicators": "{%if vars.headers_artifacts and vars.body_artifacts%}{{vars.headers_artifacts.URL | union(vars.body_artifacts.URL)}}{%elif not vars.headers_artifacts%}{{vars.body_artifacts.URL}}{%elif not vars.body_artifacts%}{{vars.headers_artifacts.URL}}{%endif%}",
                "host_indicators": "{%if vars.headers_artifacts and vars.body_artifacts%}{{vars.headers_artifacts.Host | union(vars.body_artifacts.Host)}}{%elif not vars.headers_artifacts%}{{vars.body_artifacts.Host}}{%elif not vars.body_artifacts%}{{vars.headers_artifacts.Host}}{%endif%}",
                "email_indicators": "{%if vars.headers_artifacts and vars.body_artifacts%}{{vars.headers_artifacts.Email | union(vars.body_artifacts.Email)}}{%elif not vars.headers_artifacts%}{{vars.body_artifacts.Email}}{%elif not vars.body_artifacts%}{{vars.headers_artifacts.Email}}{%endif%}"
              },
              "status": null,
              "left": "808",
              "top": "1114",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "94ebf138-f88f-469d-a6dd-aa766e4d0c5c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Original Email Attached",
              "description": "Check Whether the email is forwarded inline or as an attachment",
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/6521283e-586f-4abb-b61e-399eb56e8c7e",
                    "condition": "{{ vars.has_attachement_email > 0 }}"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/a9302fee-cc9a-40bf-901f-59b90ab28c03"
                  }
                ]
              },
              "status": null,
              "left": "808",
              "top": "454",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "3f2876d4-945a-480b-95d5-16554580b67d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Inline Email",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Create Email Record</span></p>\n\n<p>Email was submitted via forwarding inline.</p>",
                  "records": ""
                },
                "resource": {
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "emailCc": "{{(vars.email_body|regex_search(\"CC:([^:]*)\"))|regex_findall(\"([\\w,_,.,-]+\\@[\\w,_,.,-]+\\.\\w+)\")|unique|join(\",\")}}",
                  "emailTo": "{{(vars.email_body|regex_search(\"To:([^:]*)\")|regex_findall(\"([\\w,_,.,-]+\\@[\\w,_,.,-]+\\.\\w+)\")|unique)|join(\",\")}}",
                  "__replace": "",
                  "emailBody": "<html>{{vars.email_body.split(\"<hr>\")[1]}}",
                  "emailFrom": "{{(vars.email_body|regex_search(\"From:([^>]*)\")).split('<')[1]}}",
                  "emailSubject": "{{(vars.email_body|regex_search(\"Subject:([^<]*)\")).split(':')[1]}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/emails",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "988",
              "top": "554",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "a9302fee-cc9a-40bf-901f-59b90ab28c03"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Attached Email",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Create Email Record</span></p>\n\n<p>Email was submitted via forwarding as an attachment.</p>",
                  "records": ""
                },
                "resource": {
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "emailCc": "{{vars.source_data.parsed_attachment_data.0.headers.cc}}",
                  "emailTo": "{{vars.source_data.parsed_attachment_data.0.headers.to}}",
                  "sourceId": "{{vars.source_data.parsed_attachment_data.0.headers['message-id']}}",
                  "__replace": "",
                  "emailBody": "{%if vars.source_data.parsed_attachment_data.0.body.html %}{{vars.source_data.parsed_attachment_data.0.body.html}}{%else%}{{vars.source_data.parsed_attachment_data.0.body.text}}{%endif%}",
                  "emailFrom": "{{vars.source_data.parsed_attachment_data.0.headers.from}}",
                  "emailHeader": "{{vars.source_data.parsed_attachment_data.0.headers|toJSON}}",
                  "emailSubject": "{{vars.source_data.parsed_attachment_data.0.headers.subject}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/emails",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "628",
              "top": "554",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "6521283e-586f-4abb-b61e-399eb56e8c7e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Prepare File Attachments",
              "description": null,
              "arguments": {
                "file_attachements": "{%if vars.has_attachement_email == 0%}{{vars.source_data.attachments}}{%else%}{{vars.source_data.parsed_attachment_data[0].attachments}}{%endif%}"
              },
              "status": null,
              "left": "808",
              "top": "666",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "87e4fa3e-fad7-4610-a404-453c2b086639"
            },
            {
              "@type": "WorkflowStep",
              "name": "Record File Attachment",
              "description": null,
              "arguments": {
                "config": "f860463d-8a86-48f3-8ddd-bb28c122aeba",
                "params": {
                  "python_function": "import base64\nfile=\"{{vars.file_attachements.0.file}}\"\nfilename=\"{{vars.file_attachements.0.metadata.filename}}\"\ntry:\n\twith open('/tmp/'+filename, 'wb') as tmp_file:\n\t\ttmp_file.write(base64.b64decode(file))\nexcept:\n\tprint('Generic: Could not write attachment!')"
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Storing File Attachments</span></p>\n\n<p>The file attachments are saved to the local disk for further processing.</p>",
                  "records": ""
                },
                "version": "1.2.3",
                "connector": "code-snippet",
                "operation": "python_inline",
                "operationTitle": "Execute Python Code",
                "step_variables": []
              },
              "status": null,
              "left": "808",
              "top": "794",
              "stepType": "/api/3/workflow_step_types/1fdd14cc-d6b4-4335-a3af-ab49c8ed2fd8",
              "uuid": "dab07701-8d63-4b7b-9c79-9ad4811685ee"
            },
            {
              "@type": "WorkflowStep",
              "name": "Upload File IOCs",
              "description": null,
              "arguments": {
                "config": "b79754b3-d441-4854-b030-209fd26c61a2",
                "params": {
                  "filename": "{{vars.item.metadata.filename}}",
                  "file_path": "{{vars.item.metadata.filename}}",
                  "create_attachment": false
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Uploading File Indicator</span></p>\n\n<p>File attachment have been uploaded into FortiSOAR and attachments has been created.</p>",
                  "records": ""
                },
                "version": "3.0.2",
                "for_each": {
                  "item": "{{vars.file_attachements}}",
                  "condition": ""
                },
                "connector": "cyops_utilities",
                "operation": "upload_file_to_cyops",
                "operationTitle": "File: Upload a file to CyOPs and Create an Attachment",
                "step_variables": []
              },
              "status": null,
              "left": "808",
              "top": "900",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "8c1a4037-9ca1-4c10-b782-f73bf635d2d0"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create File Indicators",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating File Indicator</span></p>\n\n<p>File: <span style=\"background-color:#E4DBCF;color:#1B2430;font-weight:bold\">[ {{vars.item.data.filename}} ]</span> was created.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.steps.Upload_File_IOCs}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "file": "{{ vars.item.data['@id'] or None }}",
                  "value": "File -  {{vars.item.data.filename}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "sources": "Email",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 73,
                    "@id": "/api/3/picklists/0162241b-f5bf-4917-a150-00e920be47bd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "File",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "File",
                    "orderIndex": 3
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "808",
              "top": "1014",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "eeadb42c-3acb-441b-94b0-045d50ed7cee"
            },
            {
              "@type": "WorkflowStep",
              "name": "Parse Attached Email Attributes",
              "description": null,
              "arguments": {
                "email_cc": "{{vars.steps.Create_Attached_Email.emailCc|regex_findall(\"([\\w,_,.,-]+\\@[\\w,_,.,-]+\\.\\w+)\")|unique}}",
                "email_to": "{{vars.steps.Create_Attached_Email.emailTo|regex_findall(\"([\\w,_,.,-]+\\@[\\w,_,.,-]+\\.\\w+)\")|unique}}",
                "html_body": "{{vars.steps.Create_Attached_Email.emailBody}}",
                "source_ip": "{{vars.source_data.parsed_attachment_data.0.headers['x-originating-ip'] or ''}}",
                "email_from": "{{vars.steps.Create_Attached_Email.emailFrom|regex_search(\"([\\w,_,.,-]+\\@[\\w,_,.,-]+\\.\\w+)\")}}",
                "email_header": "{{vars.steps.Create_Attached_Email.emailHeader}}",
                "body_artifacts": "{{vars.steps.Create_Attached_Email.emailBody|extract_artifacts}}",
                "headers_artifacts": "{{vars.steps.Create_Attached_Email.emailHeader|extract_artifacts}}"
              },
              "status": null,
              "left": "448",
              "top": "666",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "b093b4c9-8c3d-416e-84e0-a185d643f600"
            },
            {
              "@type": "WorkflowStep",
              "name": "Parse Inline Email Attributes",
              "description": null,
              "arguments": {
                "email_cc": "{{vars.steps.Create_Inline_Email.emailCc|regex_findall(\"([\\w_.-]+\\@[\\w_.-]+\\.\\w+)\")|unique}}",
                "email_to": "{{vars.steps.Create_Inline_Email.emailTo|regex_findall(\"([\\w_.-]+\\@[\\w_.-]+\\.\\w+)\")|unique}}",
                "html_body": "{{vars.steps.Create_Inline_Email.emailBody}}",
                "source_ip": "{{vars.source_data.headers['x-originating-ip'] or ''}}",
                "email_from": "{{vars.steps.Create_Inline_Email.emailFrom}}",
                "body_artifacts": "{{vars.steps.Create_Inline_Email.emailBody | extract_artifacts}}"
              },
              "status": null,
              "left": "1180",
              "top": "666",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "783c8c11-497d-4e28-b766-5e65c8a92da9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Whitelist local attributes",
              "description": null,
              "arguments": {
                "ip_indicators": "{%if vars.ip_indicators%}\n{{vars.ip_indicators | difference(vars.ip_indicators|ipaddr('10.200.3.0/24'))}}{%endif%}",
                "url_indicators": "{{vars.url_indicators|json_query(\"[?contains(@, 'fortielab') == `false`]\")}}",
                "host_indicators": "{{vars.host_indicators|json_query(\"[?contains(@, 'fortielab') == `false`]\")}}",
                "email_indicators": "{{vars.email_indicators|json_query(\"[?contains(@, 'fortielab.com') == `false`]\")}}"
              },
              "status": null,
              "left": "808",
              "top": "1214",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "e0cf2ce8-6bca-4a28-916f-1e28929d22c9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create IP Indicator",
              "description": null,
              "arguments": {
                "when": "{{vars.ip_indicators_to_create|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating IP Indicator</span></p>\n\n<p>IP indicators are being created for each IP indicator found in the email.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.ip_indicators_to_create}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "value": "{{vars.item}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "sources": "Email",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 77,
                    "@id": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "IP Address",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "IP Address",
                    "orderIndex": 7
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1420",
              "top": "1870",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "b6b376d1-48b9-433c-a3bb-f13cc5486a62"
            },
            {
              "@type": "WorkflowStep",
              "name": "Wait for URLs",
              "description": null,
              "arguments": {
                "delay": {
                  "days": 0,
                  "hours": 0,
                  "weeks": 0,
                  "minutes": 0,
                  "seconds": 46
                }
              },
              "status": null,
              "left": "1100",
              "top": "1760",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dbf",
              "uuid": "71cb1688-4351-44d7-ab1a-ef6a62abbc0c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Wait for Hosts",
              "description": null,
              "arguments": {
                "delay": {
                  "days": 0,
                  "hours": 0,
                  "weeks": 0,
                  "minutes": 2,
                  "seconds": 0
                }
              },
              "status": null,
              "left": "512",
              "top": "1766",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dbf",
              "uuid": "917ac25e-f222-4299-95c2-0eac22f8ad24"
            },
            {
              "@type": "WorkflowStep",
              "name": "Wait for Emails",
              "description": null,
              "arguments": {
                "delay": {
                  "days": 0,
                  "hours": 0,
                  "weeks": 0,
                  "minutes": 3,
                  "seconds": 0
                }
              },
              "status": null,
              "left": "192",
              "top": "1760",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dbf",
              "uuid": "235cdf72-43bf-45d4-9a95-d14b2eafff08"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find IP Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.ip_indicators | length > 0}}",
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.item}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "indicators?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Find IP Indicators</span></p>\n\n<p>Host indicators from the reported email are being processed.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.ip_indicators}}",
                  "condition": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "1420",
              "top": "1340",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "2b2632c7-c81d-475b-ac7c-eaea0b6ad7b7"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Host Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.host_indicators | length > 0}}",
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.item}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "indicators?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Find Host Indicators</span></p>\n\n<p>Host indicators from the reported email are being processed.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.host_indicators}}",
                  "condition": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "512",
              "top": "1346",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "72ca6aba-a9e5-4c05-bda0-5ac017c88ece"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find URL Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.url_indicators | length > 0}}",
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.item}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "indicators?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Find URL Indicators</span></p>\n\n<p>Host indicators from the reported email are being processed.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.url_indicators}}",
                  "condition": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "1100",
              "top": "1340",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "0230174a-de8b-4a27-9908-292101101106"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Email Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.email_indicators | length > 0}}",
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.item}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ]
                },
                "module": "indicators?$limit=30",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Find Email Indicators</span></p>\n\n<p>Email indicators from the reported email are being processed.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.email_indicators}}",
                  "condition": ""
                },
                "step_variables": []
              },
              "status": null,
              "left": "192",
              "top": "1346",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "87a31ced-6127-4c2c-9c87-664f7754495f"
            },
            {
              "@type": "WorkflowStep",
              "name": "Process IP Indicators",
              "description": null,
              "arguments": {
                "found_ip_indicators_iris": "{{vars.find_ip_indicators|json_query('[].[\"@id\"]') | flatten(levels=1)}}",
                "found_ip_indicators_values": "{{vars.find_ip_indicators|json_query(\"[].value\")| flatten(levels=1)}}"
              },
              "status": null,
              "left": "1420",
              "top": "1551",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "633662a8-853a-4b41-bdee-51cfd0240ae6"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link IP Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.found_ip_indicators_iris|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link IP Indicators to Alert</span></p>\n\n<p>All of the created IP indicators have been linked to this alert.</p>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "indicators": "{{vars.found_ip_indicators_iris}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1420",
              "top": "1980",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "31159c31-f748-40e2-9247-967a85b871db"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set IP Lists",
              "description": null,
              "arguments": {
                "ip_indicators_to_link": "{{vars.ip_indicators | intersect(vars.found_ip_indicators_values)}}",
                "ip_indicators_to_create": "{{vars.ip_indicators | difference(vars.found_ip_indicators_values)}}"
              },
              "status": null,
              "left": "1420",
              "top": "1650",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "4313e53b-4384-4969-91b2-ca1a97f0ec38"
            },
            {
              "@type": "WorkflowStep",
              "name": "Flatten IP lists",
              "description": null,
              "arguments": {
                "find_ip_indicators": "{{vars.steps.Find_IP_Indicators | flatten(levels=1)}}"
              },
              "status": null,
              "left": "1420",
              "top": "1440",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "921bb7f6-8123-4683-a021-61c581ffce86"
            },
            {
              "@type": "WorkflowStep",
              "name": "Flatten URL lists",
              "description": null,
              "arguments": {
                "find_url_indicators": "{{vars.steps.Find_URL_Indicators | flatten(levels=1)}}"
              },
              "status": null,
              "left": "1100",
              "top": "1440",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "2236a522-2da4-4d9a-ba2a-b6a5e5e09a4d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Process URL Indicators",
              "description": null,
              "arguments": {
                "found_url_indicators_iris": "{{vars.find_url_indicators|json_query('[].[\"@id\"]') | flatten(levels=1)}}",
                "found_url_indicators_values": "{{vars.find_url_indicators|json_query(\"[].value\")| flatten(levels=1)}}"
              },
              "status": null,
              "left": "1100",
              "top": "1550",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "285e75f2-21d1-41c0-960d-25b9ff34eaf9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set URL Lists",
              "description": null,
              "arguments": {
                "url_indicators_to_link": "{{vars.url_indicators | intersect(vars.found_url_indicators_values)}}",
                "url_indicators_to_create": "{{vars.url_indicators | difference(vars.found_url_indicators_values)}}"
              },
              "status": null,
              "left": "1100",
              "top": "1650",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "e9b06d7c-536e-4670-ab12-ab192acb32fc"
            },
            {
              "@type": "WorkflowStep",
              "name": "Flatten Host lists",
              "description": null,
              "arguments": {
                "find_host_indicators": "{{vars.steps.Find_Host_Indicators | flatten(levels=1)}}"
              },
              "status": null,
              "left": "512",
              "top": "1446",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "d91e0ffb-bbfd-4584-a1f7-33ce754ef070"
            },
            {
              "@type": "WorkflowStep",
              "name": "Process Host Indicators",
              "description": null,
              "arguments": {
                "found_host_indicators_iris": "{{vars.find_host_indicators|json_query('[].[\"@id\"]') | flatten(levels=1)}}",
                "found_host_indicators_values": "{{vars.find_host_indicators|json_query(\"[].value\")| flatten(levels=1)}}"
              },
              "status": null,
              "left": "512",
              "top": "1552",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "fdff6f5e-72b4-4616-bd1d-5ab731113e38"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Host Lists",
              "description": null,
              "arguments": {
                "host_indicators_to_link": "{{vars.host_indicators | intersect(vars.found_host_indicators_values)}}",
                "host_indicators_to_create": "{{vars.host_indicators | difference(vars.found_host_indicators_values)}}"
              },
              "status": null,
              "left": "512",
              "top": "1653",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "ae8d78b0-d0ad-4692-a6c4-0d3147d2f180"
            },
            {
              "@type": "WorkflowStep",
              "name": "Flatten Email lists",
              "description": null,
              "arguments": {
                "find_email_indicators": "{{vars.steps.Find_Email_Indicators | flatten(levels=1)}}"
              },
              "status": null,
              "left": "192",
              "top": "1446",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "9e56fd9b-12b4-4441-87be-d4fec6bb925c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Process Email Indicators",
              "description": null,
              "arguments": {
                "found_email_indicators_iris": "{{vars.find_email_indicators|json_query('[].[\"@id\"]') | flatten(levels=1)}}",
                "found_email_indicators_values": "{{vars.find_email_indicators|json_query(\"[].value\")| flatten(levels=1)}}"
              },
              "status": null,
              "left": "192",
              "top": "1553",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "9cf1640e-851e-4b50-bd40-c30052323b79"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Email Lists",
              "description": null,
              "arguments": {
                "email_indicators_to_link": "{{vars.email_indicators | intersect(vars.found_email_indicators_values)}}",
                "email_indicators_to_create": "{{vars.email_indicators | difference(vars.found_email_indicators_values)}}"
              },
              "status": null,
              "left": "192",
              "top": "1653",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "2ab5fa47-0fc7-43ee-b02e-cab113683556"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create URL Indicator",
              "description": null,
              "arguments": {
                "when": "{{vars.url_indicators_to_create|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating URL Indicator</span></p>\n\n<p>URL indicators are being created for each URL indicator found in the email.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.url_indicators_to_create}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "value": "{{vars.item}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "sources": "Email",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 80,
                    "@id": "/api/3/picklists/353a37b4-3eeb-43ee-aac6-64806422cfec",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "URL",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "URL",
                    "orderIndex": 10
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1100",
              "top": "1870",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "18829875-872b-4bf1-870c-b0e0534e853b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link URL Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.found_url_indicators_iris|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link URL Indicators to Alert</span></p>\n\n<p>All of the created URL indicators have been linked to this alert.</p>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "indicators": "{{vars.found_url_indicators_iris}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1100",
              "top": "1980",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "a61ef59e-48ab-41cb-b13e-fb4d5c569ea8"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Host Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.found_host_indicators_iris|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link Host Indicators to Alert</span></p>\n\n<p>All of the created host indicators have been linked to this alert.</p>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "indicators": "{{vars.found_host_indicators_iris}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "512",
              "top": "1986",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "dc95cf7a-7b31-4506-ac90-3d2a1037c4a4"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Host Indicator",
              "description": null,
              "arguments": {
                "when": "{{vars.host_indicators_to_create|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating Host Indicator</span></p>\n\n<p>Host indicators are being created for each host indicator found in the email.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.host_indicators_to_create}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "value": "{{vars.item}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "sources": "Email",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 80,
                    "@id": "/api/3/picklists/353a37b4-3eeb-43ee-aac6-64806422cfec",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "URL",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "URL",
                    "orderIndex": 10
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "512",
              "top": "1873",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "e9dc692e-d804-41ff-8a84-b6941f132afb"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Email Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.found_email_indicators_iris|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link Email Indicators to Alert</span></p>\n\n<p>All of the created email indicators have been linked to this alert.</p>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "indicators": "{{vars.found_email_indicators_iris}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "192",
              "top": "1986",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "bab16b0d-894c-4f62-b1cd-dcf686babbd7"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Email Indicator",
              "description": null,
              "arguments": {
                "when": "{{vars.email_indicators_to_create|length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Creating Email Indicator</span></p>\n\n<p>Email indicators are being created for each email indicator found in the email.</p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.email_indicators_to_create}}",
                  "__bulk": true,
                  "condition": ""
                },
                "resource": {
                  "value": "{{vars.item}}",
                  "alerts": "{{vars.input.records[0]['@id']}}",
                  "sources": "Email",
                  "__replace": "false",
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 71,
                    "@id": "/api/3/picklists/80bd55b0-6d88-4beb-bec3-97954f261c4d",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Email Address",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "Email Address",
                    "orderIndex": 1
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/upsert/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "192",
              "top": "1873",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "97c80303-b76c-41b9-950d-0f500a4035ec"
            },
            {
              "@type": "WorkflowStep",
              "name": "Indicators Malicious",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/19c11527-61b5-4e0f-871a-f70bcc8e9b62",
                    "condition": "{{ \"Malicious\" in vars.indicator_reputation }}"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/227ce397-1ce5-45b0-8324-0c6638194c4a"
                  }
                ]
              },
              "status": null,
              "left": "806",
              "top": "2407",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "b7660deb-8727-4d65-8450-51d7a2f5b063"
            },
            {
              "@type": "WorkflowStep",
              "name": "False positive Alert",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Automatic Alert Closure</span></p>\n\n<p> No malicious indicators were found in the reported email. Due to this the alert was closed <span style=\"background-color:#1E6E23;color:#FFF;font-weight:bold\">[ Automatically ]</span> and no further action is required.",
                  "records": ""
                },
                "resource": {
                  "type": {
                    "id": 121,
                    "@id": "/api/3/picklists/0b3ef6f9-eb29-4ab9-ac98-98364bd1a3aa",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Phishing",
                    "listName": "/api/3/picklist_names/a7087b9c-5660-495f-a8ac-c3b198ddb8c2",
                    "itemValue": "Phishing",
                    "orderIndex": 9
                  },
                  "state": {
                    "id": 221,
                    "@id": "/api/3/picklists/2879663c-c1dc-4ef2-84ae-8c67c9353b86",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Detail Extracted",
                    "listName": "/api/3/picklist_names/2f9ed741-25fe-475a-9f12-64336288eebf",
                    "itemValue": "Detail Extracted",
                    "orderIndex": 1
                  },
                  "status": {
                    "id": 246,
                    "@id": "/api/3/picklists/fac53e73-8d16-4189-98d5-95fbd1555232",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Closed",
                    "listName": "/api/3/picklist_names/33e964a9-d607-49f2-813c-7ce46141815a",
                    "itemValue": "Closed",
                    "orderIndex": 4
                  },
                  "ackDate": "{{globalVars.Current_Date}}",
                  "respDate": "{{globalVars.Current_Date}}",
                  "ackSlaStatus": "{% if globalVars.Current_Date <= vars.steps.Update_Alert.dueBy %}{{\"SLAState\" | picklist(\"Met\", \"@id\")}}{% else %}{{\"SLAState\" | picklist(\"Missed\", \"@id\")}}{% endif %}",
                  "closureNotes": "<p>No malicious indicators were found in the email. Due to this the alert was <span style=\"background-color:#1E6E23;color:#FFF;font-weight:bold\">[ Automatically ]</span> closed.</p>",
                  "resolveddate": "{{globalVars.Current_Date}}",
                  "closureReason": {
                    "id": 250,
                    "@id": "/api/3/picklists/2b0112f6-4746-4dab-ada6-a8cd1e675572",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "False Positive",
                    "listName": "/api/3/picklist_names/4ebacea1-88cd-4ea8-9dcc-385bea42cc59",
                    "itemValue": "False Positive",
                    "orderIndex": 2
                  },
                  "respSlaStatus": "{% if globalVars.Current_Date <= vars.steps.Update_Alert.respDueDate %}{{\"SLAState\" | picklist(\"Met\", \"@id\")}}{% else %}{{\"SLAState\" | picklist(\"Missed\", \"@id\")}}{% endif %}",
                  "escalatedtoincident": {
                    "id": 31,
                    "@id": "/api/3/picklists/2128a09c-153d-4db3-985d-de6be33deae5",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#808080",
                    "display": "No",
                    "listName": "/api/3/picklist_names/e131cc54-9ae4-43c9-b830-af6e331fe024",
                    "itemValue": "No",
                    "orderIndex": 1
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "467",
              "top": "2407",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "227ce397-1ce5-45b0-8324-0c6638194c4a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Wait for indicators Reputation",
              "description": null,
              "arguments": {
                "delay": {
                  "days": 0,
                  "hours": 0,
                  "weeks": 0,
                  "minutes": 2,
                  "seconds": 0
                }
              },
              "status": null,
              "left": "806",
              "top": "2090",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dbf",
              "uuid": "d0a7a733-b2f6-4717-951f-4dcea575f00b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Indicators",
              "description": null,
              "arguments": {
                "indicators_reputation_iri": "{{ (((vars.input.records[0]['@id'] + \"?$relationships=true\") | fromIRI).indicators)|json_query(\"[].reputation\") }}"
              },
              "status": null,
              "left": "806",
              "top": "2191",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "007744c6-cdba-49e8-9b8a-a760efb1ae7f"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Indicators Reputation",
              "description": null,
              "arguments": {
                "indicator_reputation": "{%for iri in vars.indicators_reputation_iri%}{{(iri|fromIRI).itemValue}}{%endfor%}"
              },
              "status": null,
              "left": "806",
              "top": "2292",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "650297c3-501c-4e3b-966a-cab34ea7302f"
            },
            {
              "@type": "WorkflowStep",
              "name": "Block URLs on FortiGate",
              "description": null,
              "arguments": {
                "name": "SSH",
                "config": "6351df85-a63e-4bf6-9cc6-a23d563ecfe0",
                "params": {
                  "cmd": "echo {{vars.item}} >> /var/www/html/blocked-urls.txt",
                  "allowed_exit": "-1,0",
                  "is_super_user": false
                },
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Block Malicious URLs on FortiGate</span></p>\n\n<p>Due to the email being determined as <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ Malicious ]</span> the located URL indicators found in the email have been added to the <span style=\"background-color:#E31B1D;color:#FFF;font-weight:bold\">[ Block List ]</span> on the FortiGate.</p>",
                  "records": ""
                },
                "version": "2.1.1",
                "for_each": {
                  "item": "{{vars.url_indicators_to_create}}",
                  "condition": ""
                },
                "connector": "ssh",
                "operation": "run_remote_command",
                "operationTitle": "Execute remote command",
                "step_variables": []
              },
              "status": null,
              "left": "806",
              "top": "2630",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "fd0d3527-bb27-48af-a5aa-3f9a52045e1c"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "ded76577-0b68-4ddf-85ba-0f8ba796c007",
              "name": "Prepare File Attachments -> Record File Attachment",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/dab07701-8d63-4b7b-9c79-9ad4811685ee",
              "sourceStep": "/api/3/workflow_steps/87e4fa3e-fad7-4610-a404-453c2b086639"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "97a782c0-6880-43c2-9c32-e90c0ed3ef49",
              "name": "Upload File IOCs -> Create Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/eeadb42c-3acb-441b-94b0-045d50ed7cee",
              "sourceStep": "/api/3/workflow_steps/8c1a4037-9ca1-4c10-b782-f73bf635d2d0"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "ee97907b-5d08-4af6-b1de-26b47f627b34",
              "name": "Record File Attachment -> Upload File IOCs",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8c1a4037-9ca1-4c10-b782-f73bf635d2d0",
              "sourceStep": "/api/3/workflow_steps/dab07701-8d63-4b7b-9c79-9ad4811685ee"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "db66ff5a-cdee-48fc-85a6-44c5146740b3",
              "name": "Create Attached Email -> Parse Attached Email Attributes",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/b093b4c9-8c3d-416e-84e0-a185d643f600",
              "sourceStep": "/api/3/workflow_steps/6521283e-586f-4abb-b61e-399eb56e8c7e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "db670f80-ac93-4d73-9723-3c5f52774685",
              "name": "Parse Attached Email Attributes -> Prepare File Attachments",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/87e4fa3e-fad7-4610-a404-453c2b086639",
              "sourceStep": "/api/3/workflow_steps/b093b4c9-8c3d-416e-84e0-a185d643f600"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "aa6fbefb-f26c-4780-9bd9-4fb51fd567ba",
              "name": "Create Inline Email -> Parse Inline Email Attributes",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/783c8c11-497d-4e28-b766-5e65c8a92da9",
              "sourceStep": "/api/3/workflow_steps/a9302fee-cc9a-40bf-901f-59b90ab28c03"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "4a0efb82-bb72-4930-8986-a1d76b952e52",
              "name": "Parse Inline Email Attributes -> Prepare File Attachments",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/87e4fa3e-fad7-4610-a404-453c2b086639",
              "sourceStep": "/api/3/workflow_steps/783c8c11-497d-4e28-b766-5e65c8a92da9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c52f2b7d-32e1-4d81-9f89-e32c50a2be85",
              "name": "Create File Indicators -> Extract Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/94ebf138-f88f-469d-a6dd-aa766e4d0c5c",
              "sourceStep": "/api/3/workflow_steps/eeadb42c-3acb-441b-94b0-045d50ed7cee"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "ba2fe7df-6bab-4378-a990-48b2cf6aeba2",
              "name": "Extract Indicators -> Copy  of Whitelist local attributes",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e0cf2ce8-6bca-4a28-916f-1e28929d22c9",
              "sourceStep": "/api/3/workflow_steps/94ebf138-f88f-469d-a6dd-aa766e4d0c5c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "7853ab0e-2b0e-4061-aacb-039a6a0eaece",
              "name": "Update Alert -> Original Email Attached",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3f2876d4-945a-480b-95d5-16554580b67d",
              "sourceStep": "/api/3/workflow_steps/41f723c6-112e-4d53-9a92-5eb877e6f6d7"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e12af8c3-a231-47f8-8064-7e7be8430b77",
              "name": "Original Email Attached -> Create Inline Email",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/a9302fee-cc9a-40bf-901f-59b90ab28c03",
              "sourceStep": "/api/3/workflow_steps/3f2876d4-945a-480b-95d5-16554580b67d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "fb41786f-2043-4b12-9d6f-61b2b1ff6c79",
              "name": "Original Email Attached -> Copy  of Create Inline Email",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/6521283e-586f-4abb-b61e-399eb56e8c7e",
              "sourceStep": "/api/3/workflow_steps/3f2876d4-945a-480b-95d5-16554580b67d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "3ee21a2f-20d7-49fe-9376-21b86de3bbf1",
              "name": "Start -> Set Source Data",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/368cd169-84b2-43c2-be57-6c74fca017c8",
              "sourceStep": "/api/3/workflow_steps/a8c48939-3987-4a76-a8c3-339b088a94e9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e853797a-4195-46dc-a397-11748ef682ef",
              "name": "Whitelist local attributes -> Find IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/2b2632c7-c81d-475b-ac7c-eaea0b6ad7b7",
              "sourceStep": "/api/3/workflow_steps/e0cf2ce8-6bca-4a28-916f-1e28929d22c9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f7bd3d7d-bc13-4eec-ae63-8446226818bb",
              "name": "Whitelist local attributes -> Find URL Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/0230174a-de8b-4a27-9908-292101101106",
              "sourceStep": "/api/3/workflow_steps/e0cf2ce8-6bca-4a28-916f-1e28929d22c9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "51a8bbc9-ba42-4d2b-95b5-6628856a0540",
              "name": "Whitelist local attributes -> Find Host Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/72ca6aba-a9e5-4c05-bda0-5ac017c88ece",
              "sourceStep": "/api/3/workflow_steps/e0cf2ce8-6bca-4a28-916f-1e28929d22c9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "afb4e43f-0b41-41f9-8d01-12614338b6ba",
              "name": "Whitelist local attributes -> Find Email Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/87a31ced-6127-4c2c-9c87-664f7754495f",
              "sourceStep": "/api/3/workflow_steps/e0cf2ce8-6bca-4a28-916f-1e28929d22c9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "072dec04-7a9d-407c-bb0d-83a6150f6c50",
              "name": "Create IP Indicator -> Link Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/31159c31-f748-40e2-9247-967a85b871db",
              "sourceStep": "/api/3/workflow_steps/b6b376d1-48b9-433c-a3bb-f13cc5486a62"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e8a01e45-8a8d-4ad6-aaf1-714632a00d89",
              "name": "Process IP Indicators -> Set IP Lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/4313e53b-4384-4969-91b2-ca1a97f0ec38",
              "sourceStep": "/api/3/workflow_steps/633662a8-853a-4b41-bdee-51cfd0240ae6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "1d22cc1f-7ca7-4a07-b763-e68468c474b7",
              "name": "Set IP Lists -> Create IP Indicator",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/b6b376d1-48b9-433c-a3bb-f13cc5486a62",
              "sourceStep": "/api/3/workflow_steps/4313e53b-4384-4969-91b2-ca1a97f0ec38"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "eb9b20ba-3ef6-4d5f-9475-c00fa8f5c684",
              "name": "Find IP Indicators -> Flatten IP lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/921bb7f6-8123-4683-a021-61c581ffce86",
              "sourceStep": "/api/3/workflow_steps/2b2632c7-c81d-475b-ac7c-eaea0b6ad7b7"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "fc378977-7be4-4cd2-9b05-c148a70f714e",
              "name": "Flatten IP lists -> Process IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/633662a8-853a-4b41-bdee-51cfd0240ae6",
              "sourceStep": "/api/3/workflow_steps/921bb7f6-8123-4683-a021-61c581ffce86"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "69143f0d-b4bf-4032-a7b6-c70cafec4d69",
              "name": "Find URL Indicators -> Copy  of Flatten IP lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/2236a522-2da4-4d9a-ba2a-b6a5e5e09a4d",
              "sourceStep": "/api/3/workflow_steps/0230174a-de8b-4a27-9908-292101101106"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "a0a3c301-bd44-4785-81e3-94656e0c0dd7",
              "name": "Find Host Indicators -> Copy  of Copy  of Flatten IP lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d91e0ffb-bbfd-4584-a1f7-33ce754ef070",
              "sourceStep": "/api/3/workflow_steps/72ca6aba-a9e5-4c05-bda0-5ac017c88ece"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "04ee56c9-1bbb-450b-aaf7-a8171dce0e13",
              "name": "Find Email Indicators -> Copy 1 of Copy  of Flatten IP lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/9e56fd9b-12b4-4441-87be-d4fec6bb925c",
              "sourceStep": "/api/3/workflow_steps/87a31ced-6127-4c2c-9c87-664f7754495f"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "bcb6a1b7-6bd8-445c-8622-83c860808fa4",
              "name": "Flatten URL lists -> Copy 1 of Process IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/285e75f2-21d1-41c0-960d-25b9ff34eaf9",
              "sourceStep": "/api/3/workflow_steps/2236a522-2da4-4d9a-ba2a-b6a5e5e09a4d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "3cca82ab-ecf6-4fa9-9abe-232f22bed197",
              "name": "Flatten Host lists -> Copy  of Copy 1 of Process IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fdff6f5e-72b4-4616-bd1d-5ab731113e38",
              "sourceStep": "/api/3/workflow_steps/d91e0ffb-bbfd-4584-a1f7-33ce754ef070"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "1855c150-1e4b-4adb-bad5-69763698bbb6",
              "name": "Flatten Email lists -> Copy 1 of Copy 1 of Process IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/9cf1640e-851e-4b50-bd40-c30052323b79",
              "sourceStep": "/api/3/workflow_steps/9e56fd9b-12b4-4441-87be-d4fec6bb925c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5f21140d-677b-469d-872b-80346b1af39c",
              "name": "Copy 1 of Process IP Indicators -> Copy  of Set IP Lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e9b06d7c-536e-4670-ab12-ab192acb32fc",
              "sourceStep": "/api/3/workflow_steps/285e75f2-21d1-41c0-960d-25b9ff34eaf9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "50cf3abc-b47d-4893-8c6a-9e09c26cadfb",
              "name": "Copy  of Copy 1 of Process IP Indicators -> Copy  of Copy  of Set IP Lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ae8d78b0-d0ad-4692-a6c4-0d3147d2f180",
              "sourceStep": "/api/3/workflow_steps/fdff6f5e-72b4-4616-bd1d-5ab731113e38"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "57067b9a-f698-409d-a7b7-9ab38fb197e9",
              "name": "Copy 1 of Copy 1 of Process IP Indicators -> Copy 1 of Copy  of Set IP Lists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/2ab5fa47-0fc7-43ee-b02e-cab113683556",
              "sourceStep": "/api/3/workflow_steps/9cf1640e-851e-4b50-bd40-c30052323b79"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "92d46d5c-3ef4-4765-824f-609874e870c7",
              "name": "Set URL Lists -> Wait for URLs",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/71cb1688-4351-44d7-ab1a-ef6a62abbc0c",
              "sourceStep": "/api/3/workflow_steps/e9b06d7c-536e-4670-ab12-ab192acb32fc"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e74555c4-82f9-44c1-aec7-ca92fa6dadae",
              "name": "Set Host Lists -> Wait for Hosts",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/917ac25e-f222-4299-95c2-0eac22f8ad24",
              "sourceStep": "/api/3/workflow_steps/ae8d78b0-d0ad-4692-a6c4-0d3147d2f180"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "44e976c7-5ec0-4f96-af22-c12676267f8b",
              "name": "Set Email Lists -> Wait for Emails",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/235cdf72-43bf-45d4-9a95-d14b2eafff08",
              "sourceStep": "/api/3/workflow_steps/2ab5fa47-0fc7-43ee-b02e-cab113683556"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "182a7b2f-fa25-4d0a-bb81-4fbb9b037e7f",
              "name": "Wait for URLs -> Create URL Indicator",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/18829875-872b-4bf1-870c-b0e0534e853b",
              "sourceStep": "/api/3/workflow_steps/71cb1688-4351-44d7-ab1a-ef6a62abbc0c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "fde6d5a8-6795-409d-9bbb-82bb062d3ba5",
              "name": "Create URL Indicator -> Link URL Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/a61ef59e-48ab-41cb-b13e-fb4d5c569ea8",
              "sourceStep": "/api/3/workflow_steps/18829875-872b-4bf1-870c-b0e0534e853b"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c0e7e9e2-f5a2-4303-bc26-089ff9396b60",
              "name": "Wait for Hosts -> Copy  of Copy  of Create IP Indicator",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e9dc692e-d804-41ff-8a84-b6941f132afb",
              "sourceStep": "/api/3/workflow_steps/917ac25e-f222-4299-95c2-0eac22f8ad24"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "11de141b-ebdb-4b59-909f-6c8ad5998d39",
              "name": "Copy  of Copy  of Create IP Indicator -> Copy  of Copy  of Link Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/dc95cf7a-7b31-4506-ac90-3d2a1037c4a4",
              "sourceStep": "/api/3/workflow_steps/e9dc692e-d804-41ff-8a84-b6941f132afb"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "fb638ba0-87a5-4be9-8176-970955c8fdca",
              "name": "Wait for Emails -> Copy 1 of Create IP Indicator",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/97c80303-b76c-41b9-950d-0f500a4035ec",
              "sourceStep": "/api/3/workflow_steps/235cdf72-43bf-45d4-9a95-d14b2eafff08"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0bde211a-4468-4d67-ba0e-b840c4a08745",
              "name": "Copy 1 of Create IP Indicator -> Copy 1 of Link Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/bab16b0d-894c-4f62-b1cd-dcf686babbd7",
              "sourceStep": "/api/3/workflow_steps/97c80303-b76c-41b9-950d-0f500a4035ec"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "78b2313d-8037-4cd5-81e5-b2280f9cfdf5",
              "name": "Local Attributes -> Send Auto_Reply to Sender",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/a9760ff6-d26f-44f2-af48-e4533b94eebf",
              "sourceStep": "/api/3/workflow_steps/368cd169-84b2-43c2-be57-6c74fca017c8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "328498d9-2ccf-49b0-b8c2-dd152ced9633",
              "name": "Send Auto_Reply to Sender -> Update Alert",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/41f723c6-112e-4d53-9a92-5eb877e6f6d7",
              "sourceStep": "/api/3/workflow_steps/a9760ff6-d26f-44f2-af48-e4533b94eebf"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "3d4a6608-e424-46e0-af91-373f16533954",
              "name": "Send Sender Bock Notification to All Recipients -> EIS Notification Email",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fa0bde5b-d443-476a-8907-f8952e151a68",
              "sourceStep": "/api/3/workflow_steps/47dfe8c4-5eaf-4bc6-a861-a1f6d11548d9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "2d5a5869-5da8-4eb9-aa94-c1e5a9bd9289",
              "name": "Indicators Malicious -> Block Email Sender",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/19c11527-61b5-4e0f-871a-f70bcc8e9b62",
              "sourceStep": "/api/3/workflow_steps/b7660deb-8727-4d65-8450-51d7a2f5b063"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e9d4cb7c-7a43-4a62-ad36-e469ac8f70dd",
              "name": "Link Host Indicators -> Wait for indicators Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d0a7a733-b2f6-4717-951f-4dcea575f00b",
              "sourceStep": "/api/3/workflow_steps/dc95cf7a-7b31-4506-ac90-3d2a1037c4a4"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "daf33396-8ca0-4916-bb6a-2afe9e9492a7",
              "name": "Link Email Indicators -> Wait for indicators Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d0a7a733-b2f6-4717-951f-4dcea575f00b",
              "sourceStep": "/api/3/workflow_steps/bab16b0d-894c-4f62-b1cd-dcf686babbd7"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d2fe1f03-23c1-4d0f-83fa-394dc8add2a6",
              "name": "Link URL Indicators -> Wait for indicators Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d0a7a733-b2f6-4717-951f-4dcea575f00b",
              "sourceStep": "/api/3/workflow_steps/a61ef59e-48ab-41cb-b13e-fb4d5c569ea8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f633e5af-9927-4e8b-ac47-ecd2bdf8e607",
              "name": "Link IP Indicators -> Wait for indicators Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d0a7a733-b2f6-4717-951f-4dcea575f00b",
              "sourceStep": "/api/3/workflow_steps/31159c31-f748-40e2-9247-967a85b871db"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0c45703f-b679-4be2-8963-03391ff31854",
              "name": "Wait for indicators Reputation -> Get Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/007744c6-cdba-49e8-9b8a-a760efb1ae7f",
              "sourceStep": "/api/3/workflow_steps/d0a7a733-b2f6-4717-951f-4dcea575f00b"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e6e7d053-465e-4cd8-81ec-f6aaf263508b",
              "name": "Get Indicators -> Get Indicators Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/650297c3-501c-4e3b-966a-cab34ea7302f",
              "sourceStep": "/api/3/workflow_steps/007744c6-cdba-49e8-9b8a-a760efb1ae7f"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "a285bfc1-4a87-4ce8-8a17-2bec815960c5",
              "name": "Get Indicators Reputation -> Indicators Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/b7660deb-8727-4d65-8450-51d7a2f5b063",
              "sourceStep": "/api/3/workflow_steps/650297c3-501c-4e3b-966a-cab34ea7302f"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "118fc2b0-6533-4d18-a661-4a7b80ea2a23",
              "name": "Indicators Malicious -> False positive Alert",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/227ce397-1ce5-45b0-8324-0c6638194c4a",
              "sourceStep": "/api/3/workflow_steps/b7660deb-8727-4d65-8450-51d7a2f5b063"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "45994fbb-2f8f-4c0f-b648-b2ef1b70aeee",
              "name": "Block Email Sender -> Block URLs on FortiGate",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fd0d3527-bb27-48af-a5aa-3f9a52045e1c",
              "sourceStep": "/api/3/workflow_steps/19c11527-61b5-4e0f-871a-f70bcc8e9b62"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "242e24e9-5944-42ea-9b54-cf2e696cf2f1",
              "name": "Block URLs on FortiGate -> Send Sender Bock Notification to All Recipients",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/47dfe8c4-5eaf-4bc6-a861-a1f6d11548d9",
              "sourceStep": "/api/3/workflow_steps/fd0d3527-bb27-48af-a5aa-3f9a52045e1c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0822373f-55c4-4e7d-8d77-3ec0ab2a04c2",
              "name": "EIS Notification Email -> Review Blocked Emails",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/990462b5-fbdd-4b4b-9aa3-6653eb70f16d",
              "sourceStep": "/api/3/workflow_steps/fa0bde5b-d443-476a-8907-f8952e151a68"
            }
          ],
          "versions": null,
          "lastModifyDate": 1593549693,
          "uuid": "319f4647-79fc-429f-8c60-bdbee45b54d3",
          "recordTags": [],
          "isPrivate": false,
          "owners": []
        }
      ],
      "uuid": "2dc7ea03-6317-4f3f-abc1-6ec264036418",
      "recordTags": []
    }
  ],
  "macros": [
    {
      "name": "Tomorrow_Date",
      "value": "{{arrow.utcnow().shift(hours=+24).timestamp}}",
      "default_value": null
    },
    {
      "name": "Current_Date",
      "value": "{{arrow.utcnow().timestamp}}",
      "default_value": null
    }
  ],
  "exported_tags": []
}